2022-02-11 08:26:34.909602 (MainThread): Running with dbt=1.0.1
2022-02-11 08:26:35.063575 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt_rpc.task.server.RPCServerTask'>, debug=None, defer=None, exclude=None, fail_fast=None, host='0.0.0.0', log_cache_events=False, log_format=None, models=None, partial_parse=True, port=8580, printer_width=None, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='rpc', write_json=None)
2022-02-11 08:26:35.079206 (MainThread): Tracking: tracking
2022-02-11 08:26:35.087067 (Thread-12): 08:26:35  Partial parse save file not found. Starting full parse.
2022-02-11 08:26:35.087530 (Thread-12): 08:26:35  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6ae1c0>]}
2022-02-11 08:26:35.090082 (MainThread): 08:26:35  Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59207524c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6ae910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6ae250>]}
2022-02-11 08:26:35.090321 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=21
2022-02-11 08:26:35.090510 (MainThread): Supported methods: ['build', 'cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'list', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'source-freshness', 'status', 'test']
2022-02-11 08:26:35.090625 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-02-11 08:26:35.123751 (Thread-12): 08:26:35  Parsing macros/adapters.sql
2022-02-11 08:26:35.147359 (Thread-12): 08:26:35  Parsing macros/etc.sql
2022-02-11 08:26:35.149176 (Thread-12): 08:26:35  Parsing macros/catalog.sql
2022-02-11 08:26:35.154666 (Thread-12): 08:26:35  Parsing macros/materializations/table.sql
2022-02-11 08:26:35.158479 (Thread-12): 08:26:35  Parsing macros/materializations/seed.sql
2022-02-11 08:26:35.160938 (Thread-12): 08:26:35  Parsing macros/materializations/incremental.sql
2022-02-11 08:26:35.176000 (Thread-12): 08:26:35  Parsing macros/materializations/copy.sql
2022-02-11 08:26:35.178618 (Thread-12): 08:26:35  Parsing macros/materializations/snapshot.sql
2022-02-11 08:26:35.180256 (Thread-12): 08:26:35  Parsing macros/materializations/view.sql
2022-02-11 08:26:35.182798 (Thread-12): 08:26:35  Parsing macros/adapters/metadata.sql
2022-02-11 08:26:35.189780 (Thread-12): 08:26:35  Parsing macros/adapters/columns.sql
2022-02-11 08:26:35.199491 (Thread-12): 08:26:35  Parsing macros/adapters/freshness.sql
2022-02-11 08:26:35.202417 (Thread-12): 08:26:35  Parsing macros/adapters/persist_docs.sql
2022-02-11 08:26:35.206829 (Thread-12): 08:26:35  Parsing macros/adapters/relation.sql
2022-02-11 08:26:35.216284 (Thread-12): 08:26:35  Parsing macros/adapters/schema.sql
2022-02-11 08:26:35.218529 (Thread-12): 08:26:35  Parsing macros/adapters/indexes.sql
2022-02-11 08:26:35.221185 (Thread-12): 08:26:35  Parsing macros/get_custom_name/get_custom_schema.sql
2022-02-11 08:26:35.223656 (Thread-12): 08:26:35  Parsing macros/get_custom_name/get_custom_alias.sql
2022-02-11 08:26:35.225113 (Thread-12): 08:26:35  Parsing macros/get_custom_name/get_custom_database.sql
2022-02-11 08:26:35.226828 (Thread-12): 08:26:35  Parsing macros/etc/datetime.sql
2022-02-11 08:26:35.235184 (Thread-12): 08:26:35  Parsing macros/etc/statement.sql
2022-02-11 08:26:35.239607 (Thread-12): 08:26:35  Parsing macros/generic_test_sql/unique.sql
2022-02-11 08:26:35.240309 (Thread-12): 08:26:35  Parsing macros/generic_test_sql/not_null.sql
2022-02-11 08:26:35.240853 (Thread-12): 08:26:35  Parsing macros/generic_test_sql/accepted_values.sql
2022-02-11 08:26:35.242259 (Thread-12): 08:26:35  Parsing macros/generic_test_sql/relationships.sql
2022-02-11 08:26:35.243126 (Thread-12): 08:26:35  Parsing macros/materializations/configs.sql
2022-02-11 08:26:35.245481 (Thread-12): 08:26:35  Parsing macros/materializations/hooks.sql
2022-02-11 08:26:35.249613 (Thread-12): 08:26:35  Parsing macros/materializations/models/table/table.sql
2022-02-11 08:26:35.256867 (Thread-12): 08:26:35  Parsing macros/materializations/models/table/create_table_as.sql
2022-02-11 08:26:35.259768 (Thread-12): 08:26:35  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-02-11 08:26:35.262454 (Thread-12): 08:26:35  Parsing macros/materializations/models/view/helpers.sql
2022-02-11 08:26:35.263786 (Thread-12): 08:26:35  Parsing macros/materializations/models/view/create_view_as.sql
2022-02-11 08:26:35.266111 (Thread-12): 08:26:35  Parsing macros/materializations/models/view/view.sql
2022-02-11 08:26:35.273016 (Thread-12): 08:26:35  Parsing macros/materializations/models/incremental/incremental.sql
2022-02-11 08:26:35.283371 (Thread-12): 08:26:35  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-02-11 08:26:35.298619 (Thread-12): 08:26:35  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-02-11 08:26:35.300112 (Thread-12): 08:26:35  Parsing macros/materializations/models/incremental/merge.sql
2022-02-11 08:26:35.311160 (Thread-12): 08:26:35  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-02-11 08:26:35.315570 (Thread-12): 08:26:35  Parsing macros/materializations/seeds/helpers.sql
2022-02-11 08:26:35.331586 (Thread-12): 08:26:35  Parsing macros/materializations/seeds/seed.sql
2022-02-11 08:26:35.337549 (Thread-12): 08:26:35  Parsing macros/materializations/tests/helpers.sql
2022-02-11 08:26:35.339378 (Thread-12): 08:26:35  Parsing macros/materializations/tests/test.sql
2022-02-11 08:26:35.343861 (Thread-12): 08:26:35  Parsing macros/materializations/tests/where_subquery.sql
2022-02-11 08:26:35.345649 (Thread-12): 08:26:35  Parsing macros/materializations/snapshots/helpers.sql
2022-02-11 08:26:35.356541 (Thread-12): 08:26:35  Parsing macros/materializations/snapshots/strategies.sql
2022-02-11 08:26:35.373418 (Thread-12): 08:26:35  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-02-11 08:26:35.375110 (Thread-12): 08:26:35  Parsing macros/materializations/snapshots/snapshot.sql
2022-02-11 08:26:35.386463 (Thread-12): 08:26:35  Parsing tests/generic/builtin.sql
2022-02-11 08:26:35.462114 (Thread-13): handling status request
2022-02-11 08:26:35.467610 (Thread-13): 08:26:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5920041400>]}
2022-02-11 08:26:35.468189 (Thread-13): sending response (<Response 185 bytes [200 OK]>) to 10.0.4.196
2022-02-11 08:26:35.479639 (Thread-14): handling status request
2022-02-11 08:26:35.500327 (Thread-14): 08:26:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5920041610>]}
2022-02-11 08:26:35.505853 (Thread-14): sending response (<Response 163 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:26:35.594159 (Thread-12): 08:26:35  1699: static parser successfully parsed example/my_second_dbt_model.sql
2022-02-11 08:26:35.594659 (Thread-15): handling status request
2022-02-11 08:26:35.605521 (Thread-16): handling status request
2022-02-11 08:26:35.607644 (Thread-12): 08:26:35  1699: static parser successfully parsed example/my_first_dbt_model.sql
2022-02-11 08:26:35.607829 (Thread-15): 08:26:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59200738b0>]}
2022-02-11 08:26:35.608086 (Thread-16): 08:26:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fcfd5c40>]}
2022-02-11 08:26:35.611835 (Thread-15): sending response (<Response 185 bytes [200 OK]>) to 10.0.25.54
2022-02-11 08:26:35.612225 (Thread-16): sending response (<Response 163 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:26:35.669440 (Thread-17): handling status request
2022-02-11 08:26:35.669701 (Thread-17): 08:26:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc183c70>]}
2022-02-11 08:26:35.670107 (Thread-17): sending response (<Response 163 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:26:35.687237 (Thread-12): 08:26:35  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc1ae6a0>]}
2022-02-11 08:26:35.731839 (Thread-18): handling status request
2022-02-11 08:26:35.732060 (Thread-18): 08:26:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc1aef70>]}
2022-02-11 08:26:35.732791 (Thread-18): sending response (<Response 15763 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:26:35.744046 (Thread-19): handling list request
2022-02-11 08:26:35.744251 (Thread-19): 08:26:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc1ae4c0>]}
2022-02-11 08:26:35.772593 (Thread-19): 08:26:35  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fcff1160>]}
2022-02-11 08:26:35.772862 (Thread-19): 08:26:35  Found 2 models, 4 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:26:35.777690 (Thread-19): 08:26:35  The selection criterion '+1644567947323/__unsaved/Statement' does not match any nodes
2022-02-11 08:26:35.777917 (Thread-19): 08:26:35  The selection criterion '1.sql+' does not match any nodes
2022-02-11 08:26:35.778030 (Thread-19): 08:26:35  No nodes selected!
2022-02-11 08:26:35.779454 (Thread-19): sending response (<Response 2343 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:26:36.896652 (Thread-20): handling status request
2022-02-11 08:26:36.896994 (Thread-20): 08:26:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc1aea90>]}
2022-02-11 08:26:36.897911 (Thread-20): sending response (<Response 15785 bytes [200 OK]>) to 10.0.23.140
2022-02-11 08:26:36.999398 (Thread-21): handling status request
2022-02-11 08:26:36.999695 (Thread-21): 08:26:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc1aeaf0>]}
2022-02-11 08:26:37.000511 (Thread-21): sending response (<Response 15785 bytes [200 OK]>) to 10.0.20.67
2022-02-11 08:26:43.061920 (Thread-22): 08:26:43  Partial parsing enabled: 3 files deleted, 0 files added, 0 files changed.
2022-02-11 08:26:43.062206 (Thread-22): 08:26:43  Partial parsing: deleted file: my_new_project://models/example/my_first_dbt_model.sql
2022-02-11 08:26:43.062315 (Thread-22): 08:26:43  Partial parsing: deleted file: my_new_project://models/example/my_second_dbt_model.sql
2022-02-11 08:26:43.102766 (Thread-22): 08:26:43  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:26:43.107419 (Thread-22): 08:26:43  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc0cb970>]}
2022-02-11 08:26:43.838521 (Thread-23): handling status request
2022-02-11 08:26:43.838847 (Thread-23): 08:26:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f7070d0>]}
2022-02-11 08:26:43.839324 (Thread-23): sending response (<Response 2034 bytes [200 OK]>) to 10.0.5.250
2022-02-11 08:26:44.106456 (Thread-24): handling status request
2022-02-11 08:26:44.106772 (Thread-24): 08:26:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc0bee50>]}
2022-02-11 08:26:44.107241 (Thread-24): sending response (<Response 2034 bytes [200 OK]>) to 10.0.40.197
2022-02-11 08:26:44.128724 (Thread-25): handling status request
2022-02-11 08:26:44.128963 (Thread-25): 08:26:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc0bebb0>]}
2022-02-11 08:26:44.129356 (Thread-25): sending response (<Response 2012 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:26:44.134974 (Thread-26): handling list request
2022-02-11 08:26:44.135195 (Thread-26): 08:26:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc0bea00>]}
2022-02-11 08:26:44.156800 (Thread-26): 08:26:44  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc105b80>]}
2022-02-11 08:26:44.157043 (Thread-26): 08:26:44  Found 0 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:26:44.157584 (Thread-26): 08:26:44  The selection criterion '+1644567947323/__unsaved/Statement' does not match any nodes
2022-02-11 08:26:44.157747 (Thread-26): 08:26:44  The selection criterion '1.sql+' does not match any nodes
2022-02-11 08:26:44.157852 (Thread-26): 08:26:44  No nodes selected!
2022-02-11 08:26:44.159316 (Thread-26): sending response (<Response 2343 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:26:59.872350 (Thread-27): 08:26:59  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-02-11 08:26:59.874609 (Thread-27): 08:26:59  Partial parsing: added file: my_new_project://models/legacy/customer_orders.sql
2022-02-11 08:26:59.878204 (Thread-27): 08:26:59  1699: static parser successfully parsed legacy/customer_orders.sql
2022-02-11 08:26:59.919778 (Thread-27): 08:26:59  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:26:59.924384 (Thread-27): 08:26:59  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc053fd0>]}
2022-02-11 08:27:00.566696 (Thread-28): handling status request
2022-02-11 08:27:00.567032 (Thread-28): 08:27:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc0468e0>]}
2022-02-11 08:27:00.567569 (Thread-28): sending response (<Response 1986 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:00.571160 (Thread-29): handling status request
2022-02-11 08:27:00.571382 (Thread-29): 08:27:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc046b20>]}
2022-02-11 08:27:00.571761 (Thread-29): sending response (<Response 1986 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:00.572710 (Thread-30): handling list request
2022-02-11 08:27:00.572985 (Thread-30): 08:27:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f71eb80>]}
2022-02-11 08:27:00.598334 (Thread-31): sending response (<Response 214 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:00.758458 (Thread-32): handling status request
2022-02-11 08:27:00.758783 (Thread-32): 08:27:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc06f1c0>]}
2022-02-11 08:27:00.759264 (Thread-32): sending response (<Response 2008 bytes [200 OK]>) to 10.0.42.195
2022-02-11 08:27:00.860193 (Thread-33): handling status request
2022-02-11 08:27:00.860533 (Thread-33): 08:27:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc06f880>]}
2022-02-11 08:27:00.861004 (Thread-33): sending response (<Response 2008 bytes [200 OK]>) to 10.0.43.208
2022-02-11 08:27:00.933899 (Thread-34): handling status request
2022-02-11 08:27:00.934147 (Thread-34): 08:27:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc06fa00>]}
2022-02-11 08:27:00.934567 (Thread-34): sending response (<Response 1986 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:00.940618 (Thread-35): handling list request
2022-02-11 08:27:00.940824 (Thread-35): 08:27:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc06fbb0>]}
2022-02-11 08:27:00.981348 (Thread-35): 08:27:00  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc084220>]}
2022-02-11 08:27:00.981936 (Thread-35): 08:27:00  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:27:00.982665 (Thread-35): 08:27:00  The selection criterion '+models/legacy/customer_orders.sql+' does not match any nodes
2022-02-11 08:27:00.982786 (Thread-35): 08:27:00  No nodes selected!
2022-02-11 08:27:00.983918 (Thread-35): sending response (<Response 1941 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:04.989938 (Thread-36): 08:27:04  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 08:27:04.990271 (Thread-36): 08:27:04  Partial parsing: updated file: my_new_project://models/legacy/customer_orders.sql
2022-02-11 08:27:04.994454 (Thread-36): 08:27:04  1699: static parser successfully parsed legacy/customer_orders.sql
2022-02-11 08:27:05.033090 (Thread-36): 08:27:05  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:27:05.037513 (Thread-36): 08:27:05  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc04c7f0>]}
2022-02-11 08:27:05.393234 (Thread-37): handling status request
2022-02-11 08:27:05.393559 (Thread-37): 08:27:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccfa0b20>]}
2022-02-11 08:27:05.394069 (Thread-37): sending response (<Response 1988 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:05.400339 (Thread-38): handling list request
2022-02-11 08:27:05.400549 (Thread-38): 08:27:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccfa0280>]}
2022-02-11 08:27:05.420687 (Thread-38): 08:27:05  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc0691c0>]}
2022-02-11 08:27:05.420947 (Thread-38): 08:27:05  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:27:05.422758 (Thread-38): sending response (<Response 1695 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:05.733970 (Thread-39): handling status request
2022-02-11 08:27:05.734302 (Thread-39): 08:27:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccfd1160>]}
2022-02-11 08:27:05.734781 (Thread-39): sending response (<Response 2010 bytes [200 OK]>) to 10.0.42.195
2022-02-11 08:27:05.890205 (Thread-40): handling status request
2022-02-11 08:27:05.890518 (Thread-40): 08:27:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc04cc40>]}
2022-02-11 08:27:05.890979 (Thread-40): sending response (<Response 2010 bytes [200 OK]>) to 10.0.38.77
2022-02-11 08:27:05.970897 (Thread-41): handling status request
2022-02-11 08:27:05.971204 (Thread-41): 08:27:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc04cfd0>]}
2022-02-11 08:27:05.971648 (Thread-41): sending response (<Response 1988 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:05.978449 (Thread-42): handling list request
2022-02-11 08:27:05.978678 (Thread-42): 08:27:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc04ca90>]}
2022-02-11 08:27:05.996901 (Thread-42): 08:27:05  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc06daf0>]}
2022-02-11 08:27:05.997169 (Thread-42): 08:27:05  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:27:05.999297 (Thread-42): sending response (<Response 1695 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:11.881783 (Thread-43): handling status request
2022-02-11 08:27:11.882127 (Thread-43): 08:27:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc0d5dc0>]}
2022-02-11 08:27:11.882634 (Thread-43): sending response (<Response 2010 bytes [200 OK]>) to 10.0.4.196
2022-02-11 08:27:11.973855 (Thread-44): handling status request
2022-02-11 08:27:11.974108 (Thread-44): 08:27:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccfa0b20>]}
2022-02-11 08:27:11.974555 (Thread-44): sending response (<Response 2010 bytes [200 OK]>) to 10.0.4.243
2022-02-11 08:27:12.415175 (Thread-45): handling cli_args request
2022-02-11 08:27:12.415504 (Thread-45): 08:27:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccfa0d60>]}
2022-02-11 08:27:14.515168 (Thread-45): sending response (<Response 138 bytes [200 OK]>) to 10.0.9.33
2022-02-11 08:27:14.594532 (MainThread): 08:27:14  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 08:27:14.594925 (MainThread): 08:27:14  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 08:27:14.595348 (MainThread): 08:27:14  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:27:14.600465 (MainThread): 08:27:14  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '597ec9d2-80a0-4d21-a9a7-40ff96ef745e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b69d08310>]}
2022-02-11 08:27:14.616766 (MainThread): 08:27:14  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '597ec9d2-80a0-4d21-a9a7-40ff96ef745e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b6a5a9ac0>]}
2022-02-11 08:27:14.616991 (MainThread): 08:27:14  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:27:14.617839 (MainThread): 08:27:14  
2022-02-11 08:27:14.618106 (MainThread): 08:27:14  Acquiring new bigquery connection "master"
2022-02-11 08:27:14.618802 (ThreadPoolExecutor-0_0): 08:27:14  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 08:27:14.618950 (ThreadPoolExecutor-0_0): 08:27:14  Opening a new connection, currently in state init
2022-02-11 08:27:14.892938 (Thread-46): handling poll request
2022-02-11 08:27:14.893318 (Thread-46): 08:27:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccfb38e0>]}
2022-02-11 08:27:14.894240 (Thread-46): sending response (<Response 3780 bytes [200 OK]>) to 10.0.4.165
2022-02-11 08:27:14.931075 (ThreadPoolExecutor-0_0): 08:27:14  Acquiring new bigquery connection "create_dbtmodularity_dbt_luisscabral"
2022-02-11 08:27:14.931330 (ThreadPoolExecutor-0_0): 08:27:14  Acquiring new bigquery connection "create_dbtmodularity_dbt_luisscabral"
2022-02-11 08:27:14.931448 (ThreadPoolExecutor-0_0): 08:27:14  BigQuery adapter: Creating schema "dbtmodularity.dbt_luisscabral".
2022-02-11 08:27:14.931541 (ThreadPoolExecutor-0_0): 08:27:14  Opening a new connection, currently in state closed
2022-02-11 08:27:15.464808 (ThreadPoolExecutor-1_0): 08:27:15  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 08:27:15.464992 (ThreadPoolExecutor-1_0): 08:27:15  Opening a new connection, currently in state closed
2022-02-11 08:27:15.785563 (MainThread): 08:27:15  Concurrency: 4 threads (target='default')
2022-02-11 08:27:15.785779 (MainThread): 08:27:15  
2022-02-11 08:27:15.788394 (Thread-1): 08:27:15  Began running node model.my_new_project.customer_orders
2022-02-11 08:27:15.788705 (Thread-1): 08:27:15  1 of 1 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 08:27:15.788975 (Thread-1): 08:27:15  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 08:27:15.789073 (Thread-1): 08:27:15  Began compiling node model.my_new_project.customer_orders
2022-02-11 08:27:15.789169 (Thread-1): 08:27:15  Compiling model.my_new_project.customer_orders
2022-02-11 08:27:15.793921 (Thread-1): 08:27:15  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 08:27:15.807229 (Thread-47): handling status request
2022-02-11 08:27:15.807477 (Thread-47): 08:27:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc04c9d0>]}
2022-02-11 08:27:15.807949 (Thread-47): sending response (<Response 1988 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:15.813485 (Thread-48): handling list request
2022-02-11 08:27:15.813723 (Thread-48): 08:27:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccfb0460>]}
2022-02-11 08:27:15.833967 (Thread-48): 08:27:15  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf36ca0>]}
2022-02-11 08:27:15.834233 (Thread-48): 08:27:15  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:27:15.836112 (Thread-48): sending response (<Response 1695 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:15.833919 (Thread-1): 08:27:15  finished collecting timing info
2022-02-11 08:27:15.834085 (Thread-1): 08:27:15  Began executing node model.my_new_project.customer_orders
2022-02-11 08:27:15.862290 (Thread-1): 08:27:15  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 08:27:15.897765 (Thread-1): 08:27:15  Opening a new connection, currently in state closed
2022-02-11 08:27:15.902161 (Thread-1): 08:27:15  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from raw.jaffle_shop.orders as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from raw.jaffle_shop.customers
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from raw.jaffle_shop.orders
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from raw.jaffle_shop.customers
    ) b
    on a.user_id = b.id

    left outer join raw.stripe.payment c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join raw.stripe.payment payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 08:27:16.280321 (Thread-1): 08:27:16  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('The project raw has not enabled BigQuery.')
2022-02-11 08:27:16.383290 (Thread-49): handling poll request
2022-02-11 08:27:16.383617 (Thread-49): 08:27:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf579a0>]}
2022-02-11 08:27:16.384594 (Thread-49): sending response (<Response 10198 bytes [200 OK]>) to 10.0.42.195
2022-02-11 08:27:17.462982 (Thread-1): 08:27:17  finished collecting timing info
2022-02-11 08:27:17.463419 (Thread-1): 08:27:17  Database Error in model customer_orders (models/legacy/customer_orders.sql)
  The project raw has not enabled BigQuery.
  compiled SQL at target/run/my_new_project/models/legacy/customer_orders.sql
2022-02-11 08:27:17.463777 (Thread-1): 08:27:17  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '597ec9d2-80a0-4d21-a9a7-40ff96ef745e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b683cf7f0>]}
2022-02-11 08:27:17.464240 (Thread-1): 08:27:17  1 of 1 ERROR creating view model dbt_luisscabral.customer_orders................ [ERROR in 1.67s]
2022-02-11 08:27:17.464371 (Thread-1): 08:27:17  Finished running node model.my_new_project.customer_orders
2022-02-11 08:27:17.465800 (MainThread): 08:27:17  Acquiring new bigquery connection "master"
2022-02-11 08:27:17.466116 (MainThread): 08:27:17  
2022-02-11 08:27:17.466217 (MainThread): 08:27:17  Finished running 1 view model in 2.85s.
2022-02-11 08:27:17.466298 (MainThread): 08:27:17  Connection 'master' was properly closed.
2022-02-11 08:27:17.466364 (MainThread): 08:27:17  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 08:27:17.512073 (MainThread): 08:27:17  
2022-02-11 08:27:17.512229 (MainThread): 08:27:17  Completed with 1 error and 0 warnings:
2022-02-11 08:27:17.512316 (MainThread): 08:27:17  
2022-02-11 08:27:17.512402 (MainThread): 08:27:17  Database Error in model customer_orders (models/legacy/customer_orders.sql)
2022-02-11 08:27:17.512476 (MainThread): 08:27:17    The project raw has not enabled BigQuery.
2022-02-11 08:27:17.512542 (MainThread): 08:27:17    compiled SQL at target/run/my_new_project/models/legacy/customer_orders.sql
2022-02-11 08:27:17.512615 (MainThread): 08:27:17  
2022-02-11 08:27:17.512693 (MainThread): 08:27:17  Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
2022-02-11 08:27:17.781943 (Thread-50): handling poll request
2022-02-11 08:27:17.782280 (Thread-50): 08:27:17  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf3c970>]}
2022-02-11 08:27:17.783198 (Thread-50): sending response (<Response 14442 bytes [200 OK]>) to 10.0.23.140
2022-02-11 08:27:18.681749 (Thread-51): handling status request
2022-02-11 08:27:18.682080 (Thread-51): 08:27:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf3cd30>]}
2022-02-11 08:27:18.682548 (Thread-51): sending response (<Response 2010 bytes [200 OK]>) to 10.0.38.149
2022-02-11 08:27:18.757493 (Thread-52): handling status request
2022-02-11 08:27:18.757819 (Thread-52): 08:27:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf579a0>]}
2022-02-11 08:27:18.758277 (Thread-52): sending response (<Response 2010 bytes [200 OK]>) to 10.0.25.40
2022-02-11 08:27:19.367191 (Thread-53): handling status request
2022-02-11 08:27:19.367535 (Thread-53): 08:27:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf57b50>]}
2022-02-11 08:27:19.368002 (Thread-53): sending response (<Response 1988 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:19.374071 (Thread-54): handling list request
2022-02-11 08:27:19.374287 (Thread-54): 08:27:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf57310>]}
2022-02-11 08:27:19.393250 (Thread-54): 08:27:19  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf6e760>]}
2022-02-11 08:27:19.393487 (Thread-54): 08:27:19  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:27:19.395190 (Thread-54): sending response (<Response 1695 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:39.808323 (Thread-55): handling status request
2022-02-11 08:27:39.808664 (Thread-55): 08:27:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf731f0>]}
2022-02-11 08:27:39.809144 (Thread-55): sending response (<Response 1988 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:39.815186 (Thread-56): handling list request
2022-02-11 08:27:39.815397 (Thread-56): 08:27:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf73520>]}
2022-02-11 08:27:39.831891 (Thread-56): 08:27:39  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf739a0>]}
2022-02-11 08:27:39.832130 (Thread-56): 08:27:39  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:27:39.835412 (Thread-56): sending response (<Response 1695 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:45.726617 (Thread-57): handling status request
2022-02-11 08:27:45.726941 (Thread-57): 08:27:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf3c7c0>]}
2022-02-11 08:27:45.727426 (Thread-57): sending response (<Response 1988 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:27:45.733750 (Thread-58): handling list request
2022-02-11 08:27:45.733971 (Thread-58): 08:27:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf3c6a0>]}
2022-02-11 08:27:45.751632 (Thread-58): 08:27:45  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6fc910>]}
2022-02-11 08:27:45.777032 (Thread-58): 08:27:45  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:27:45.778940 (Thread-58): sending response (<Response 1695 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:28:30.151172 (Thread-59): 08:28:30  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 08:28:30.153045 (Thread-59): 08:28:30  Partial parsing: updated file: my_new_project://models/legacy/customer_orders.sql
2022-02-11 08:28:30.156850 (Thread-59): 08:28:30  1699: static parser successfully parsed legacy/customer_orders.sql
2022-02-11 08:28:30.196196 (Thread-59): 08:28:30  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:28:30.200722 (Thread-59): 08:28:30  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6b0fa0>]}
2022-02-11 08:28:30.615155 (Thread-60): handling status request
2022-02-11 08:28:30.615499 (Thread-60): 08:28:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc719250>]}
2022-02-11 08:28:30.616008 (Thread-60): sending response (<Response 1988 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:28:30.625588 (Thread-61): handling list request
2022-02-11 08:28:30.625845 (Thread-61): 08:28:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccf36550>]}
2022-02-11 08:28:30.642590 (Thread-61): 08:28:30  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccfa0fa0>]}
2022-02-11 08:28:30.643083 (Thread-61): 08:28:30  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:28:30.644770 (Thread-61): sending response (<Response 1695 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:28:31.023145 (Thread-62): handling status request
2022-02-11 08:28:31.023477 (Thread-62): 08:28:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6b17f0>]}
2022-02-11 08:28:31.023965 (Thread-62): sending response (<Response 2010 bytes [200 OK]>) to 10.0.25.54
2022-02-11 08:28:31.043198 (Thread-63): handling status request
2022-02-11 08:28:31.043436 (Thread-63): 08:28:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6b1cd0>]}
2022-02-11 08:28:31.043824 (Thread-63): sending response (<Response 2010 bytes [200 OK]>) to 10.0.4.243
2022-02-11 08:28:31.259790 (Thread-64): handling status request
2022-02-11 08:28:31.260114 (Thread-64): 08:28:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6b1e50>]}
2022-02-11 08:28:31.260580 (Thread-64): sending response (<Response 1988 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:28:31.268063 (Thread-65): handling list request
2022-02-11 08:28:31.268283 (Thread-65): 08:28:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6b1b20>]}
2022-02-11 08:28:31.284742 (Thread-65): 08:28:31  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6af7f0>]}
2022-02-11 08:28:31.284984 (Thread-65): 08:28:31  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:28:31.286642 (Thread-65): sending response (<Response 1695 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:28:35.217860 (Thread-66): handling status request
2022-02-11 08:28:35.218592 (Thread-66): 08:28:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6afb50>]}
2022-02-11 08:28:35.219081 (Thread-66): sending response (<Response 2010 bytes [200 OK]>) to 10.0.26.197
2022-02-11 08:28:35.528646 (Thread-67): handling status request
2022-02-11 08:28:35.528964 (Thread-67): 08:28:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccfd1610>]}
2022-02-11 08:28:35.529436 (Thread-67): sending response (<Response 2010 bytes [200 OK]>) to 10.0.42.195
2022-02-11 08:28:35.569387 (Thread-68): handling cli_args request
2022-02-11 08:28:35.569632 (Thread-68): 08:28:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6fcd60>]}
2022-02-11 08:28:37.676418 (Thread-68): sending response (<Response 138 bytes [200 OK]>) to 10.0.42.195
2022-02-11 08:28:37.752540 (MainThread): 08:28:37  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 08:28:37.752948 (MainThread): 08:28:37  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 08:28:37.753379 (MainThread): 08:28:37  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:28:37.758613 (MainThread): 08:28:37  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd41515c7-9ac5-480c-be7c-2faf9fae1d1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9baf08e340>]}
2022-02-11 08:28:37.773373 (MainThread): 08:28:37  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd41515c7-9ac5-480c-be7c-2faf9fae1d1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9baf92fb50>]}
2022-02-11 08:28:37.773854 (MainThread): 08:28:37  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:28:37.774672 (MainThread): 08:28:37  
2022-02-11 08:28:37.774938 (MainThread): 08:28:37  Acquiring new bigquery connection "master"
2022-02-11 08:28:37.775652 (ThreadPoolExecutor-0_0): 08:28:37  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 08:28:37.775798 (ThreadPoolExecutor-0_0): 08:28:37  Opening a new connection, currently in state init
2022-02-11 08:28:38.035077 (Thread-69): handling poll request
2022-02-11 08:28:38.035454 (Thread-69): 08:28:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6a6340>]}
2022-02-11 08:28:38.036309 (Thread-69): sending response (<Response 3779 bytes [200 OK]>) to 10.0.38.149
2022-02-11 08:28:38.112955 (ThreadPoolExecutor-1_0): 08:28:38  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 08:28:38.113137 (ThreadPoolExecutor-1_0): 08:28:38  Opening a new connection, currently in state closed
2022-02-11 08:28:38.473340 (MainThread): 08:28:38  Concurrency: 4 threads (target='default')
2022-02-11 08:28:38.473502 (MainThread): 08:28:38  
2022-02-11 08:28:38.476072 (Thread-1): 08:28:38  Began running node model.my_new_project.customer_orders
2022-02-11 08:28:38.476388 (Thread-1): 08:28:38  1 of 1 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 08:28:38.476658 (Thread-1): 08:28:38  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 08:28:38.476765 (Thread-1): 08:28:38  Began compiling node model.my_new_project.customer_orders
2022-02-11 08:28:38.476861 (Thread-1): 08:28:38  Compiling model.my_new_project.customer_orders
2022-02-11 08:28:38.478366 (Thread-1): 08:28:38  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 08:28:38.493356 (Thread-1): 08:28:38  finished collecting timing info
2022-02-11 08:28:38.493512 (Thread-1): 08:28:38  Began executing node model.my_new_project.customer_orders
2022-02-11 08:28:38.522353 (Thread-1): 08:28:38  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 08:28:38.536511 (Thread-1): 08:28:38  Opening a new connection, currently in state closed
2022-02-11 08:28:38.540962 (Thread-1): 08:28:38  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.jaffle_shop.orders as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.jaffle_shop.customers
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.jaffle_shop.orders
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.jaffle_shop.customers
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.stripe.payment c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.stripe.payment payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 08:28:39.540845 (Thread-1): 08:28:39  finished collecting timing info
2022-02-11 08:28:39.541435 (Thread-1): 08:28:39  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd41515c7-9ac5-480c-be7c-2faf9fae1d1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9bae80ee80>]}
2022-02-11 08:28:39.541820 (Thread-1): 08:28:39  1 of 1 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.06s]
2022-02-11 08:28:39.541950 (Thread-1): 08:28:39  Finished running node model.my_new_project.customer_orders
2022-02-11 08:28:39.543406 (MainThread): 08:28:39  Acquiring new bigquery connection "master"
2022-02-11 08:28:39.543701 (MainThread): 08:28:39  
2022-02-11 08:28:39.543798 (MainThread): 08:28:39  Finished running 1 view model in 1.77s.
2022-02-11 08:28:39.543879 (MainThread): 08:28:39  Connection 'master' was properly closed.
2022-02-11 08:28:39.543947 (MainThread): 08:28:39  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 08:28:39.612199 (MainThread): 08:28:39  
2022-02-11 08:28:39.612359 (MainThread): 08:28:39  Completed successfully
2022-02-11 08:28:39.612457 (MainThread): 08:28:39  
2022-02-11 08:28:39.612544 (MainThread): 08:28:39  Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2022-02-11 08:28:39.643202 (Thread-70): handling poll request
2022-02-11 08:28:39.643494 (Thread-70): 08:28:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6adf70>]}
2022-02-11 08:28:39.644254 (Thread-70): sending response (<Response 13445 bytes [200 OK]>) to 10.0.4.196
2022-02-11 08:28:41.031359 (Thread-71): handling poll request
2022-02-11 08:28:41.031699 (Thread-71): 08:28:41  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6a9580>]}
2022-02-11 08:28:41.032492 (Thread-71): sending response (<Response 7310 bytes [200 OK]>) to 10.0.38.149
2022-02-11 08:28:42.154814 (Thread-72): handling status request
2022-02-11 08:28:42.155134 (Thread-72): 08:28:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6a9b20>]}
2022-02-11 08:28:42.155692 (Thread-72): sending response (<Response 1988 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:28:42.161677 (Thread-73): handling list request
2022-02-11 08:28:42.161946 (Thread-73): 08:28:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc651580>]}
2022-02-11 08:28:42.181931 (Thread-73): 08:28:42  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc651f70>]}
2022-02-11 08:28:42.182250 (Thread-73): 08:28:42  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:28:42.184351 (Thread-73): sending response (<Response 1695 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:28:42.193136 (Thread-74): handling status request
2022-02-11 08:28:42.193355 (Thread-74): 08:28:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc64a400>]}
2022-02-11 08:28:42.193813 (Thread-74): sending response (<Response 2010 bytes [200 OK]>) to 10.0.4.165
2022-02-11 08:28:42.262834 (Thread-75): handling status request
2022-02-11 08:28:42.263159 (Thread-75): 08:28:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc64ad90>]}
2022-02-11 08:28:42.263620 (Thread-75): sending response (<Response 2010 bytes [200 OK]>) to 10.0.38.77
2022-02-11 08:29:02.591880 (Thread-76): handling status request
2022-02-11 08:29:02.592230 (Thread-76): 08:29:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc64afd0>]}
2022-02-11 08:29:02.592698 (Thread-76): sending response (<Response 1988 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:29:02.600250 (Thread-77): handling list request
2022-02-11 08:29:02.600509 (Thread-77): 08:29:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc64a340>]}
2022-02-11 08:29:02.618551 (Thread-77): 08:29:02  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6a6520>]}
2022-02-11 08:29:02.618832 (Thread-77): 08:29:02  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:29:02.622363 (Thread-77): sending response (<Response 1695 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:29:14.785584 (Thread-78): 08:29:14  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 08:29:14.785826 (Thread-78): 08:29:14  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 08:29:14.786115 (Thread-78): 08:29:14  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:29:14.790835 (Thread-78): 08:29:14  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc5c48b0>]}
2022-02-11 08:29:15.823471 (Thread-79): handling status request
2022-02-11 08:29:15.823795 (Thread-79): 08:29:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc5bfee0>]}
2022-02-11 08:29:15.824276 (Thread-79): sending response (<Response 1681 bytes [200 OK]>) to 10.0.20.67
2022-02-11 08:29:16.278806 (Thread-80): handling status request
2022-02-11 08:29:16.279131 (Thread-80): 08:29:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc5bfc10>]}
2022-02-11 08:29:16.279591 (Thread-80): sending response (<Response 1681 bytes [200 OK]>) to 10.0.42.195
2022-02-11 08:29:25.569006 (Thread-81): 08:29:25  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 08:29:25.569185 (Thread-81): 08:29:25  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 08:29:25.569413 (Thread-81): 08:29:25  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:29:25.574153 (Thread-81): 08:29:25  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc535d60>]}
2022-02-11 08:29:26.410758 (Thread-82): handling status request
2022-02-11 08:29:26.411106 (Thread-82): 08:29:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc655640>]}
2022-02-11 08:29:26.411587 (Thread-82): sending response (<Response 1659 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:29:26.417927 (Thread-83): handling list request
2022-02-11 08:29:26.418156 (Thread-83): 08:29:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6551c0>]}
2022-02-11 08:29:26.437117 (Thread-83): 08:29:26  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc691e50>]}
2022-02-11 08:29:26.460613 (Thread-83): 08:29:26  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:29:26.461300 (Thread-83): 08:29:26  The selection criterion '+models/staging/jaffle_shop+' does not match any nodes
2022-02-11 08:29:26.461431 (Thread-83): 08:29:26  No nodes selected!
2022-02-11 08:29:26.462776 (Thread-83): sending response (<Response 1934 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:29:26.660099 (Thread-84): handling status request
2022-02-11 08:29:26.660438 (Thread-84): 08:29:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc696130>]}
2022-02-11 08:29:26.660922 (Thread-84): sending response (<Response 1681 bytes [200 OK]>) to 10.0.38.149
2022-02-11 08:29:26.761890 (Thread-85): handling status request
2022-02-11 08:29:26.762205 (Thread-85): 08:29:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc6963d0>]}
2022-02-11 08:29:26.762660 (Thread-85): sending response (<Response 1681 bytes [200 OK]>) to 10.0.38.149
2022-02-11 08:29:30.836818 (Thread-86): 08:29:30  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 08:29:30.837002 (Thread-86): 08:29:30  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 08:29:30.837242 (Thread-86): 08:29:30  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:29:30.841769 (Thread-86): 08:29:30  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc5486d0>]}
2022-02-11 08:29:32.065672 (Thread-87): handling status request
2022-02-11 08:29:32.066041 (Thread-87): 08:29:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc655cd0>]}
2022-02-11 08:29:32.066532 (Thread-87): sending response (<Response 1681 bytes [200 OK]>) to 10.0.43.197
2022-02-11 08:29:32.079791 (Thread-88): handling status request
2022-02-11 08:29:32.080010 (Thread-88): 08:29:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc540b80>]}
2022-02-11 08:29:32.080361 (Thread-88): sending response (<Response 1681 bytes [200 OK]>) to 10.0.4.196
2022-02-11 08:29:32.785581 (Thread-89): handling status request
2022-02-11 08:29:32.785934 (Thread-89): 08:29:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc540a00>]}
2022-02-11 08:29:32.786402 (Thread-89): sending response (<Response 1659 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:29:32.792069 (Thread-90): handling list request
2022-02-11 08:29:32.792284 (Thread-90): 08:29:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc540400>]}
2022-02-11 08:29:32.813280 (Thread-90): 08:29:32  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc69b640>]}
2022-02-11 08:29:32.813520 (Thread-90): 08:29:32  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:29:32.815221 (Thread-90): sending response (<Response 1695 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:29:42.198025 (Thread-91): 08:29:42  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 08:29:42.198207 (Thread-91): 08:29:42  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 08:29:42.198443 (Thread-91): 08:29:42  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:29:42.203175 (Thread-91): 08:29:42  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc4cb580>]}
2022-02-11 08:29:43.118509 (Thread-92): handling status request
2022-02-11 08:29:43.118836 (Thread-92): 08:29:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc4c8dc0>]}
2022-02-11 08:29:43.119301 (Thread-92): sending response (<Response 1681 bytes [200 OK]>) to 10.0.26.197
2022-02-11 08:29:43.161391 (Thread-93): handling status request
2022-02-11 08:29:43.161685 (Thread-93): 08:29:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc4c8ac0>]}
2022-02-11 08:29:43.162171 (Thread-93): sending response (<Response 1681 bytes [200 OK]>) to 10.0.38.149
2022-02-11 08:29:59.172373 (Thread-94): 08:29:59  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-02-11 08:29:59.172737 (Thread-94): 08:29:59  Partial parsing: added file: my_new_project://models/staging/stripe/sources.yml
2022-02-11 08:29:59.211888 (Thread-94): 08:29:59  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:29:59.216498 (Thread-94): 08:29:59  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc461580>]}
2022-02-11 08:30:00.224055 (Thread-95): handling status request
2022-02-11 08:30:00.224371 (Thread-95): 08:30:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc4bc460>]}
2022-02-11 08:30:00.224834 (Thread-95): sending response (<Response 1679 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:30:00.231026 (Thread-96): handling list request
2022-02-11 08:30:00.231245 (Thread-96): 08:30:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc4bc160>]}
2022-02-11 08:30:00.248615 (Thread-96): 08:30:00  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc43b610>]}
2022-02-11 08:30:00.248862 (Thread-96): 08:30:00  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-02-11 08:30:00.250655 (Thread-96): sending response (<Response 1695 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:30:00.941925 (Thread-97): handling status request
2022-02-11 08:30:00.942256 (Thread-97): 08:30:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc475070>]}
2022-02-11 08:30:00.942729 (Thread-97): sending response (<Response 1701 bytes [200 OK]>) to 10.0.9.33
2022-02-11 08:30:01.084283 (Thread-98): handling status request
2022-02-11 08:30:01.084568 (Thread-98): 08:30:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc475190>]}
2022-02-11 08:30:01.085015 (Thread-98): sending response (<Response 1701 bytes [200 OK]>) to 10.0.23.140
2022-02-11 08:30:17.699074 (Thread-99): 08:30:17  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-02-11 08:30:17.699365 (Thread-99): 08:30:17  Partial parsing: added file: my_new_project://models/staging/jaffle_shop/_sources.yml
2022-02-11 08:30:17.743280 (Thread-99): 08:30:17  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:30:17.747793 (Thread-99): 08:30:17  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc444c40>]}
2022-02-11 08:30:18.869290 (Thread-100): handling status request
2022-02-11 08:30:18.869612 (Thread-100): 08:30:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc432c10>]}
2022-02-11 08:30:18.870120 (Thread-100): sending response (<Response 1707 bytes [200 OK]>) to 10.0.38.77
2022-02-11 08:30:19.369359 (Thread-101): handling status request
2022-02-11 08:30:19.369680 (Thread-101): 08:30:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc432460>]}
2022-02-11 08:30:19.370173 (Thread-101): sending response (<Response 1707 bytes [200 OK]>) to 10.0.43.208
2022-02-11 08:30:23.568211 (Thread-102): 08:30:23  Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
2022-02-11 08:30:23.568517 (Thread-102): 08:30:23  Partial parsing: added file: my_new_project://models/staging/stripe/_sources.yml
2022-02-11 08:30:23.606641 (Thread-102): 08:30:23  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:30:23.611443 (Thread-102): 08:30:23  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc33a220>]}
2022-02-11 08:30:24.151919 (Thread-103): handling status request
2022-02-11 08:30:24.152242 (Thread-103): 08:30:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc42fb50>]}
2022-02-11 08:30:24.152725 (Thread-103): sending response (<Response 1706 bytes [200 OK]>) to 10.0.23.140
2022-02-11 08:30:24.453158 (Thread-104): handling status request
2022-02-11 08:30:24.453508 (Thread-104): 08:30:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc42f340>]}
2022-02-11 08:30:24.454042 (Thread-104): sending response (<Response 1706 bytes [200 OK]>) to 10.0.25.124
2022-02-11 08:30:40.910384 (Thread-105): 08:30:40  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 08:30:40.910714 (Thread-105): 08:30:40  Partial parsing: update schema file: my_new_project://models/staging/jaffle_shop/_sources.yml
2022-02-11 08:30:40.965630 (Thread-105): 08:30:40  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:30:40.971769 (Thread-105): 08:30:40  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc691d90>]}
2022-02-11 08:30:41.622605 (Thread-106): handling status request
2022-02-11 08:30:41.622938 (Thread-106): 08:30:41  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc3af0d0>]}
2022-02-11 08:30:41.623415 (Thread-106): sending response (<Response 1719 bytes [200 OK]>) to 10.0.26.197
2022-02-11 08:30:42.269191 (Thread-107): handling status request
2022-02-11 08:30:42.269537 (Thread-107): 08:30:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc3a6d00>]}
2022-02-11 08:30:42.270047 (Thread-107): sending response (<Response 1719 bytes [200 OK]>) to 10.0.20.67
2022-02-11 08:31:04.456431 (Thread-108): 08:31:04  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 08:31:04.456820 (Thread-108): 08:31:04  Partial parsing: update schema file: my_new_project://models/staging/stripe/_sources.yml
2022-02-11 08:31:04.503472 (Thread-108): 08:31:04  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:31:04.508492 (Thread-108): 08:31:04  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc105f70>]}
2022-02-11 08:31:05.829637 (Thread-109): handling status request
2022-02-11 08:31:05.829999 (Thread-109): 08:31:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f593501f9a0>]}
2022-02-11 08:31:05.830483 (Thread-109): sending response (<Response 1714 bytes [200 OK]>) to 10.0.4.196
2022-02-11 08:31:06.010328 (Thread-110): handling status request
2022-02-11 08:31:06.010618 (Thread-110): 08:31:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6da220>]}
2022-02-11 08:31:06.011067 (Thread-110): sending response (<Response 1714 bytes [200 OK]>) to 10.0.25.40
2022-02-11 08:31:09.257568 (Thread-111): handling status request
2022-02-11 08:31:09.257937 (Thread-111): 08:31:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6d2190>]}
2022-02-11 08:31:09.278718 (Thread-111): sending response (<Response 1692 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:31:09.284722 (Thread-112): handling list request
2022-02-11 08:31:09.284948 (Thread-112): 08:31:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6d2b20>]}
2022-02-11 08:31:09.311154 (Thread-112): 08:31:09  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6e50a0>]}
2022-02-11 08:31:09.311408 (Thread-112): 08:31:09  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 08:31:09.313234 (Thread-112): sending response (<Response 1697 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:33:37.125134 (Thread-113): 08:33:37  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 08:33:37.127146 (Thread-113): 08:33:37  Partial parsing: updated file: my_new_project://models/legacy/customer_orders.sql
2022-02-11 08:33:37.131714 (Thread-113): 08:33:37  1699: static parser successfully parsed legacy/customer_orders.sql
2022-02-11 08:33:37.640059 (Thread-114): handling status request
2022-02-11 08:33:37.640393 (Thread-114): 08:33:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc4461f0>]}
2022-02-11 08:33:37.640859 (Thread-114): sending response (<Response 1340 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:33:37.968899 (Thread-115): handling status request
2022-02-11 08:33:37.969218 (Thread-115): 08:33:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc446ee0>]}
2022-02-11 08:33:37.969676 (Thread-115): sending response (<Response 1362 bytes [200 OK]>) to 10.0.43.197
2022-02-11 08:33:38.896804 (Thread-116): handling status request
2022-02-11 08:33:38.897142 (Thread-116): 08:33:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc446c10>]}
2022-02-11 08:33:38.897604 (Thread-116): sending response (<Response 1362 bytes [200 OK]>) to 10.0.25.124
2022-02-11 08:33:38.932667 (Thread-117): handling status request
2022-02-11 08:33:38.932993 (Thread-117): 08:33:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc446bb0>]}
2022-02-11 08:33:38.933449 (Thread-117): sending response (<Response 1340 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:33:40.226715 (Thread-118): handling status request
2022-02-11 08:33:40.227056 (Thread-118): 08:33:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6d2190>]}
2022-02-11 08:33:40.227555 (Thread-118): sending response (<Response 1340 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:33:40.552431 (Thread-119): handling status request
2022-02-11 08:33:40.552740 (Thread-119): 08:33:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc45e880>]}
2022-02-11 08:33:40.553204 (Thread-119): sending response (<Response 1362 bytes [200 OK]>) to 10.0.25.54
2022-02-11 08:33:40.890990 (Thread-120): handling cli_args request
2022-02-11 08:33:40.891316 (Thread-120): 08:33:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc45e6d0>]}
2022-02-11 08:33:40.891699 (Thread-120): sending response (<Response 795 bytes [200 OK]>) to 10.0.4.196
2022-02-11 08:33:40.919168 (Thread-121): handling status request
2022-02-11 08:33:40.919439 (Thread-121): 08:33:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc45e3d0>]}
2022-02-11 08:33:40.919869 (Thread-121): sending response (<Response 1362 bytes [200 OK]>) to 10.0.25.54
2022-02-11 08:33:45.961145 (Thread-122): handling status request
2022-02-11 08:33:45.961499 (Thread-122): 08:33:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc45ee20>]}
2022-02-11 08:33:45.962009 (Thread-122): sending response (<Response 1340 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:33:51.043274 (Thread-123): handling status request
2022-02-11 08:33:51.043601 (Thread-123): 08:33:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f7e9be0>]}
2022-02-11 08:33:51.044072 (Thread-123): sending response (<Response 1340 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:33:53.899413 (Thread-124): 08:33:53  Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
2022-02-11 08:33:53.899748 (Thread-124): 08:33:53  Partial parsing: deleted source source.my_new_project.jaffle_shop.customers
2022-02-11 08:33:53.899849 (Thread-124): 08:33:53  Partial parsing: deleted source source.my_new_project.jaffle_shop.orders
2022-02-11 08:33:53.899950 (Thread-124): 08:33:53  Partial parsing: update schema file: my_new_project://models/staging/jaffle_shop/_sources.yml
2022-02-11 08:33:53.900145 (Thread-124): 08:33:53  Partial parsing: updated file: my_new_project://models/legacy/customer_orders.sql
2022-02-11 08:33:53.904890 (Thread-124): 08:33:53  1699: static parser successfully parsed legacy/customer_orders.sql
2022-02-11 08:33:55.269556 (Thread-125): handling status request
2022-02-11 08:33:55.269915 (Thread-125): 08:33:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc41eb20>]}
2022-02-11 08:33:55.270408 (Thread-125): sending response (<Response 2328 bytes [200 OK]>) to 10.0.40.197
2022-02-11 08:33:55.368180 (Thread-126): handling status request
2022-02-11 08:33:55.368422 (Thread-126): 08:33:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc41e760>]}
2022-02-11 08:33:55.368839 (Thread-126): sending response (<Response 2328 bytes [200 OK]>) to 10.0.13.54
2022-02-11 08:33:59.289353 (Thread-127): handling status request
2022-02-11 08:33:59.289685 (Thread-127): 08:33:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc41e580>]}
2022-02-11 08:33:59.290193 (Thread-127): sending response (<Response 2328 bytes [200 OK]>) to 10.0.25.124
2022-02-11 08:33:59.373239 (Thread-128): handling status request
2022-02-11 08:33:59.373499 (Thread-128): 08:33:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc41e310>]}
2022-02-11 08:33:59.373996 (Thread-128): sending response (<Response 2328 bytes [200 OK]>) to 10.0.42.195
2022-02-11 08:33:59.709049 (Thread-129): handling cli_args request
2022-02-11 08:33:59.709369 (Thread-129): 08:33:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc41e070>]}
2022-02-11 08:33:59.709752 (Thread-129): sending response (<Response 795 bytes [200 OK]>) to 10.0.13.54
2022-02-11 08:34:11.450571 (Thread-130): handling status request
2022-02-11 08:34:11.450894 (Thread-130): 08:34:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc30afa0>]}
2022-02-11 08:34:11.451381 (Thread-130): sending response (<Response 2328 bytes [200 OK]>) to 10.0.26.197
2022-02-11 08:34:12.332958 (Thread-131): handling status request
2022-02-11 08:34:12.333277 (Thread-131): 08:34:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc30adf0>]}
2022-02-11 08:34:12.333796 (Thread-131): sending response (<Response 2328 bytes [200 OK]>) to 10.0.9.33
2022-02-11 08:34:13.185507 (Thread-132): handling status request
2022-02-11 08:34:13.185868 (Thread-132): 08:34:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc198160>]}
2022-02-11 08:34:13.186357 (Thread-132): sending response (<Response 2306 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:34:14.466977 (Thread-133): handling status request
2022-02-11 08:34:14.467309 (Thread-133): 08:34:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc45e400>]}
2022-02-11 08:34:14.467787 (Thread-133): sending response (<Response 2306 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:34:17.107491 (Thread-134): handling status request
2022-02-11 08:34:17.107809 (Thread-134): 08:34:17  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc45e790>]}
2022-02-11 08:34:17.108302 (Thread-134): sending response (<Response 2306 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:34:18.768308 (Thread-135): 08:34:18  Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
2022-02-11 08:34:18.768638 (Thread-135): 08:34:18  Partial parsing: deleted source source.my_new_project.jaffle_shop.customers
2022-02-11 08:34:18.768736 (Thread-135): 08:34:18  Partial parsing: deleted source source.my_new_project.jaffle_shop.orders
2022-02-11 08:34:18.768834 (Thread-135): 08:34:18  Partial parsing: update schema file: my_new_project://models/staging/jaffle_shop/_sources.yml
2022-02-11 08:34:18.769029 (Thread-135): 08:34:18  Partial parsing: updated file: my_new_project://models/legacy/customer_orders.sql
2022-02-11 08:34:18.773950 (Thread-135): 08:34:18  1699: static parser successfully parsed legacy/customer_orders.sql
2022-02-11 08:34:18.821252 (Thread-135): 08:34:18  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:34:18.825892 (Thread-135): 08:34:18  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc25f070>]}
2022-02-11 08:34:19.263268 (Thread-136): handling status request
2022-02-11 08:34:19.263676 (Thread-136): 08:34:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc45efa0>]}
2022-02-11 08:34:19.264222 (Thread-136): sending response (<Response 2959 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:34:19.270083 (Thread-137): handling list request
2022-02-11 08:34:19.270297 (Thread-137): 08:34:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc057d00>]}
2022-02-11 08:34:19.301561 (Thread-137): 08:34:19  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc239880>]}
2022-02-11 08:34:19.301845 (Thread-137): 08:34:19  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 08:34:19.303921 (Thread-137): sending response (<Response 2641 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:34:20.042549 (Thread-138): handling status request
2022-02-11 08:34:20.042871 (Thread-138): 08:34:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc2f0220>]}
2022-02-11 08:34:20.043394 (Thread-138): sending response (<Response 2959 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:34:20.049492 (Thread-139): handling list request
2022-02-11 08:34:20.049730 (Thread-139): 08:34:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc446490>]}
2022-02-11 08:34:20.078700 (Thread-139): 08:34:20  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc25fe50>]}
2022-02-11 08:34:20.078939 (Thread-139): 08:34:20  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 08:34:20.081248 (Thread-139): sending response (<Response 2641 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:34:20.195344 (Thread-140): handling status request
2022-02-11 08:34:20.195622 (Thread-140): 08:34:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc239100>]}
2022-02-11 08:34:20.217186 (Thread-140): sending response (<Response 2981 bytes [200 OK]>) to 10.0.4.196
2022-02-11 08:34:20.235405 (Thread-141): handling status request
2022-02-11 08:34:20.235618 (Thread-141): 08:34:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc04c4c0>]}
2022-02-11 08:34:20.235990 (Thread-141): sending response (<Response 2981 bytes [200 OK]>) to 10.0.13.54
2022-02-11 08:34:21.173305 (Thread-142): handling status request
2022-02-11 08:34:21.173638 (Thread-142): 08:34:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc45edc0>]}
2022-02-11 08:34:21.174194 (Thread-142): sending response (<Response 2981 bytes [200 OK]>) to 10.0.43.208
2022-02-11 08:34:21.513624 (Thread-143): handling cli_args request
2022-02-11 08:34:21.513946 (Thread-143): 08:34:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc41e190>]}
2022-02-11 08:34:21.519454 (Thread-144): handling status request
2022-02-11 08:34:21.519976 (Thread-144): 08:34:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc45d760>]}
2022-02-11 08:34:21.520452 (Thread-144): sending response (<Response 2981 bytes [200 OK]>) to 10.0.23.140
2022-02-11 08:34:23.653024 (Thread-143): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.197
2022-02-11 08:34:23.730020 (MainThread): 08:34:23  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 08:34:23.730415 (MainThread): 08:34:23  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 08:34:23.730901 (MainThread): 08:34:23  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:34:23.736161 (MainThread): 08:34:23  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '68f2b798-bc88-41bf-bdd4-dce254107661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9664a50b50>]}
2022-02-11 08:34:23.761851 (MainThread): 08:34:23  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '68f2b798-bc88-41bf-bdd4-dce254107661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9664ac7bb0>]}
2022-02-11 08:34:23.762078 (MainThread): 08:34:23  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 08:34:23.762992 (MainThread): 08:34:23  
2022-02-11 08:34:23.763261 (MainThread): 08:34:23  Acquiring new bigquery connection "master"
2022-02-11 08:34:23.763974 (ThreadPoolExecutor-0_0): 08:34:23  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 08:34:23.764119 (ThreadPoolExecutor-0_0): 08:34:23  Opening a new connection, currently in state init
2022-02-11 08:34:23.978943 (ThreadPoolExecutor-1_0): 08:34:23  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 08:34:23.979109 (ThreadPoolExecutor-1_0): 08:34:23  Opening a new connection, currently in state closed
2022-02-11 08:34:24.036234 (Thread-145): handling poll request
2022-02-11 08:34:24.036598 (Thread-145): 08:34:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc3af070>]}
2022-02-11 08:34:24.037507 (Thread-145): sending response (<Response 4413 bytes [200 OK]>) to 10.0.42.195
2022-02-11 08:34:24.294008 (MainThread): 08:34:24  Concurrency: 4 threads (target='default')
2022-02-11 08:34:24.294205 (MainThread): 08:34:24  
2022-02-11 08:34:24.296900 (Thread-1): 08:34:24  Began running node model.my_new_project.customer_orders
2022-02-11 08:34:24.297208 (Thread-1): 08:34:24  1 of 1 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 08:34:24.297474 (Thread-1): 08:34:24  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 08:34:24.297578 (Thread-1): 08:34:24  Began compiling node model.my_new_project.customer_orders
2022-02-11 08:34:24.297669 (Thread-1): 08:34:24  Compiling model.my_new_project.customer_orders
2022-02-11 08:34:24.302377 (Thread-1): 08:34:24  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 08:34:24.316570 (Thread-1): 08:34:24  finished collecting timing info
2022-02-11 08:34:24.316714 (Thread-1): 08:34:24  Began executing node model.my_new_project.customer_orders
2022-02-11 08:34:24.345299 (Thread-1): 08:34:24  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 08:34:24.358822 (Thread-1): 08:34:24  Opening a new connection, currently in state closed
2022-02-11 08:34:24.363071 (Thread-1): 08:34:24  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment`
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 08:34:24.578161 (Thread-1): 08:34:24  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword ON at [24:1]')
2022-02-11 08:34:25.377334 (Thread-146): handling poll request
2022-02-11 08:34:25.377669 (Thread-146): 08:34:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc256fa0>]}
2022-02-11 08:34:25.378339 (Thread-146): sending response (<Response 8355 bytes [200 OK]>) to 10.0.13.54
2022-02-11 08:34:25.738412 (Thread-1): 08:34:25  finished collecting timing info
2022-02-11 08:34:25.738873 (Thread-1): 08:34:25  Database Error in model customer_orders (models/legacy/customer_orders.sql)
  Syntax error: Expected ")" but got keyword ON at [24:1]
  compiled SQL at target/run/my_new_project/models/legacy/customer_orders.sql
2022-02-11 08:34:25.739244 (Thread-1): 08:34:25  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68f2b798-bc88-41bf-bdd4-dce254107661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96641197c0>]}
2022-02-11 08:34:25.739587 (Thread-1): 08:34:25  1 of 1 ERROR creating view model dbt_luisscabral.customer_orders................ [ERROR in 1.44s]
2022-02-11 08:34:25.739703 (Thread-1): 08:34:25  Finished running node model.my_new_project.customer_orders
2022-02-11 08:34:25.741188 (MainThread): 08:34:25  Acquiring new bigquery connection "master"
2022-02-11 08:34:25.741482 (MainThread): 08:34:25  
2022-02-11 08:34:25.741578 (MainThread): 08:34:25  Finished running 1 view model in 1.98s.
2022-02-11 08:34:25.741657 (MainThread): 08:34:25  Connection 'master' was properly closed.
2022-02-11 08:34:25.741757 (MainThread): 08:34:25  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 08:34:25.791042 (MainThread): 08:34:25  
2022-02-11 08:34:25.791196 (MainThread): 08:34:25  Completed with 1 error and 0 warnings:
2022-02-11 08:34:25.791285 (MainThread): 08:34:25  
2022-02-11 08:34:25.791371 (MainThread): 08:34:25  Database Error in model customer_orders (models/legacy/customer_orders.sql)
2022-02-11 08:34:25.791448 (MainThread): 08:34:25    Syntax error: Expected ")" but got keyword ON at [24:1]
2022-02-11 08:34:25.791515 (MainThread): 08:34:25    compiled SQL at target/run/my_new_project/models/legacy/customer_orders.sql
2022-02-11 08:34:25.791589 (MainThread): 08:34:25  
2022-02-11 08:34:25.791667 (MainThread): 08:34:25  Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
2022-02-11 08:34:26.796580 (Thread-147): handling poll request
2022-02-11 08:34:26.796907 (Thread-147): 08:34:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc242340>]}
2022-02-11 08:34:26.797962 (Thread-147): sending response (<Response 14710 bytes [200 OK]>) to 10.0.26.197
2022-02-11 08:34:28.137137 (Thread-148): handling status request
2022-02-11 08:34:28.137474 (Thread-148): 08:34:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc242100>]}
2022-02-11 08:34:28.138023 (Thread-148): sending response (<Response 2981 bytes [200 OK]>) to 10.0.9.33
2022-02-11 08:34:28.216122 (Thread-149): handling status request
2022-02-11 08:34:28.216380 (Thread-149): 08:34:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc242ee0>]}
2022-02-11 08:34:28.216826 (Thread-149): sending response (<Response 2959 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:34:28.222827 (Thread-150): handling list request
2022-02-11 08:34:28.223050 (Thread-150): 08:34:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1f30d0>]}
2022-02-11 08:34:28.255126 (Thread-150): 08:34:28  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1f3cd0>]}
2022-02-11 08:34:28.255410 (Thread-150): 08:34:28  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 08:34:28.257653 (Thread-150): sending response (<Response 2641 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:34:28.563029 (Thread-151): handling status request
2022-02-11 08:34:28.563334 (Thread-151): 08:34:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1f30a0>]}
2022-02-11 08:34:28.563826 (Thread-151): sending response (<Response 2981 bytes [200 OK]>) to 10.0.38.149
2022-02-11 08:34:31.912488 (Thread-152): handling status request
2022-02-11 08:34:31.912819 (Thread-152): 08:34:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc45d9d0>]}
2022-02-11 08:34:31.913320 (Thread-152): sending response (<Response 2959 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:34:31.919015 (Thread-153): handling list request
2022-02-11 08:34:31.919239 (Thread-153): 08:34:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc25f2e0>]}
2022-02-11 08:34:31.947243 (Thread-153): 08:34:31  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1fc430>]}
2022-02-11 08:34:31.947505 (Thread-153): 08:34:31  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 08:34:31.949532 (Thread-153): sending response (<Response 2641 bytes [200 OK]>) to 10.0.32.67
2022-02-11 08:34:50.879585 (Thread-154): handling status request
2022-02-11 08:34:50.879911 (Thread-154): 08:34:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1fcf10>]}
2022-02-11 08:34:50.880411 (Thread-154): sending response (<Response 2981 bytes [200 OK]>) to 10.0.42.195
2022-02-11 08:34:51.286021 (Thread-155): handling compile_sql request
2022-02-11 08:34:51.286352 (Thread-155): 08:34:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc208190>]}
2022-02-11 08:34:53.414630 (Thread-155): sending response (<Response 138 bytes [200 OK]>) to 10.0.25.124
2022-02-11 08:34:53.440857 (MainThread): 08:34:53  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '25b51dd7-cf1e-4ab8-aae0-ae667c337869', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1715c4fa0>]}
2022-02-11 08:34:53.441424 (MainThread): 08:34:53  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 08:34:53.442167 (Thread-1): 08:34:53  Acquiring new bigquery connection "rpc.my_new_project.request"
2022-02-11 08:34:53.442304 (Thread-1): 08:34:53  Began compiling node rpc.my_new_project.request
2022-02-11 08:34:53.442397 (Thread-1): 08:34:53  Compiling rpc.my_new_project.request
2022-02-11 08:34:53.446270 (Thread-1): 08:34:53  finished collecting timing info
2022-02-11 08:34:53.446401 (Thread-1): 08:34:53  Began executing node rpc.my_new_project.request
2022-02-11 08:34:53.446500 (Thread-1): 08:34:53  finished collecting timing info
2022-02-11 08:34:53.772198 (Thread-156): handling poll request
2022-02-11 08:34:53.772592 (Thread-156): 08:34:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1fcd90>]}
2022-02-11 08:34:53.773748 (Thread-156): sending response (<Response 15162 bytes [200 OK]>) to 10.0.25.40
2022-02-11 08:36:47.365045 (Thread-157): 08:36:47  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 08:36:47.367711 (Thread-157): 08:36:47  Partial parsing: updated file: my_new_project://models/legacy/customer_orders.sql
2022-02-11 08:36:47.372358 (Thread-157): 08:36:47  1699: static parser successfully parsed legacy/customer_orders.sql
2022-02-11 08:36:47.410900 (Thread-157): 08:36:47  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:36:47.415545 (Thread-157): 08:36:47  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1f0fd0>]}
2022-02-11 08:36:48.020840 (Thread-158): handling status request
2022-02-11 08:36:48.021172 (Thread-158): 08:36:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1b5a90>]}
2022-02-11 08:36:48.021685 (Thread-158): sending response (<Response 2015 bytes [200 OK]>) to 10.0.4.243
2022-02-11 08:36:48.500509 (Thread-159): handling status request
2022-02-11 08:36:48.500834 (Thread-159): 08:36:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1b58e0>]}
2022-02-11 08:36:48.501307 (Thread-159): sending response (<Response 2015 bytes [200 OK]>) to 10.0.42.195
2022-02-11 08:36:50.223851 (Thread-160): handling status request
2022-02-11 08:36:50.224178 (Thread-160): 08:36:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1b5520>]}
2022-02-11 08:36:50.224654 (Thread-160): sending response (<Response 2015 bytes [200 OK]>) to 10.0.43.197
2022-02-11 08:36:51.065608 (Thread-161): handling cli_args request
2022-02-11 08:36:51.065953 (Thread-161): 08:36:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1b5340>]}
2022-02-11 08:36:51.202493 (Thread-162): handling status request
2022-02-11 08:36:51.203214 (Thread-162): 08:36:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1f0e50>]}
2022-02-11 08:36:51.204069 (Thread-162): sending response (<Response 2015 bytes [200 OK]>) to 10.0.23.140
2022-02-11 08:36:53.163751 (Thread-161): sending response (<Response 138 bytes [200 OK]>) to 10.0.23.140
2022-02-11 08:36:53.246628 (MainThread): 08:36:53  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 08:36:53.247025 (MainThread): 08:36:53  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 08:36:53.247507 (MainThread): 08:36:53  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:36:53.252584 (MainThread): 08:36:53  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '650386d9-6a03-4ed5-8fb7-cbb7b45ec486', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facd3433b80>]}
2022-02-11 08:36:53.284524 (MainThread): 08:36:53  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '650386d9-6a03-4ed5-8fb7-cbb7b45ec486', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facd34adbe0>]}
2022-02-11 08:36:53.284755 (MainThread): 08:36:53  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 08:36:53.285661 (MainThread): 08:36:53  
2022-02-11 08:36:53.286015 (MainThread): 08:36:53  Acquiring new bigquery connection "master"
2022-02-11 08:36:53.286716 (ThreadPoolExecutor-0_0): 08:36:53  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 08:36:53.286868 (ThreadPoolExecutor-0_0): 08:36:53  Opening a new connection, currently in state init
2022-02-11 08:36:53.508821 (ThreadPoolExecutor-1_0): 08:36:53  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 08:36:53.508970 (ThreadPoolExecutor-1_0): 08:36:53  Opening a new connection, currently in state closed
2022-02-11 08:36:53.519763 (Thread-163): handling poll request
2022-02-11 08:36:53.520036 (Thread-163): 08:36:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc52bb20>]}
2022-02-11 08:36:53.520703 (Thread-163): sending response (<Response 4415 bytes [200 OK]>) to 10.0.4.243
2022-02-11 08:36:53.810373 (MainThread): 08:36:53  Concurrency: 4 threads (target='default')
2022-02-11 08:36:53.810521 (MainThread): 08:36:53  
2022-02-11 08:36:53.813003 (Thread-1): 08:36:53  Began running node model.my_new_project.customer_orders
2022-02-11 08:36:53.813288 (Thread-1): 08:36:53  1 of 1 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 08:36:53.813531 (Thread-1): 08:36:53  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 08:36:53.813633 (Thread-1): 08:36:53  Began compiling node model.my_new_project.customer_orders
2022-02-11 08:36:53.813754 (Thread-1): 08:36:53  Compiling model.my_new_project.customer_orders
2022-02-11 08:36:53.817877 (Thread-1): 08:36:53  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 08:36:53.833246 (Thread-1): 08:36:53  finished collecting timing info
2022-02-11 08:36:53.833388 (Thread-1): 08:36:53  Began executing node model.my_new_project.customer_orders
2022-02-11 08:36:53.861613 (Thread-1): 08:36:53  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 08:36:53.877938 (Thread-1): 08:36:53  Opening a new connection, currently in state closed
2022-02-11 08:36:53.882212 (Thread-1): 08:36:53  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment`
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 08:36:54.887888 (Thread-164): handling poll request
2022-02-11 08:36:54.888218 (Thread-164): 08:36:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc17df10>]}
2022-02-11 08:36:54.888868 (Thread-164): sending response (<Response 7951 bytes [200 OK]>) to 10.0.23.140
2022-02-11 08:36:55.001781 (Thread-1): 08:36:55  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: payments; Did you mean payment? at [69:16]')
2022-02-11 08:36:55.760651 (Thread-1): 08:36:55  finished collecting timing info
2022-02-11 08:36:55.761086 (Thread-1): 08:36:55  Database Error in model customer_orders (models/legacy/customer_orders.sql)
  Unrecognized name: payments; Did you mean payment? at [69:16]
  compiled SQL at target/run/my_new_project/models/legacy/customer_orders.sql
2022-02-11 08:36:55.761442 (Thread-1): 08:36:55  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '650386d9-6a03-4ed5-8fb7-cbb7b45ec486', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facd02f69a0>]}
2022-02-11 08:36:55.761805 (Thread-1): 08:36:55  1 of 1 ERROR creating view model dbt_luisscabral.customer_orders................ [ERROR in 1.95s]
2022-02-11 08:36:55.761942 (Thread-1): 08:36:55  Finished running node model.my_new_project.customer_orders
2022-02-11 08:36:55.763599 (MainThread): 08:36:55  Acquiring new bigquery connection "master"
2022-02-11 08:36:55.763888 (MainThread): 08:36:55  
2022-02-11 08:36:55.763985 (MainThread): 08:36:55  Finished running 1 view model in 2.48s.
2022-02-11 08:36:55.764066 (MainThread): 08:36:55  Connection 'master' was properly closed.
2022-02-11 08:36:55.764134 (MainThread): 08:36:55  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 08:36:55.818668 (MainThread): 08:36:55  
2022-02-11 08:36:55.818830 (MainThread): 08:36:55  Completed with 1 error and 0 warnings:
2022-02-11 08:36:55.818919 (MainThread): 08:36:55  
2022-02-11 08:36:55.819006 (MainThread): 08:36:55  Database Error in model customer_orders (models/legacy/customer_orders.sql)
2022-02-11 08:36:55.819081 (MainThread): 08:36:55    Unrecognized name: payments; Did you mean payment? at [69:16]
2022-02-11 08:36:55.819148 (MainThread): 08:36:55    compiled SQL at target/run/my_new_project/models/legacy/customer_orders.sql
2022-02-11 08:36:55.819221 (MainThread): 08:36:55  
2022-02-11 08:36:55.819299 (MainThread): 08:36:55  Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
2022-02-11 08:36:56.377183 (Thread-165): handling poll request
2022-02-11 08:36:56.377521 (Thread-165): 08:36:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1e9250>]}
2022-02-11 08:36:56.378595 (Thread-165): sending response (<Response 15174 bytes [200 OK]>) to 10.0.43.208
2022-02-11 08:36:58.182603 (Thread-166): handling status request
2022-02-11 08:36:58.182942 (Thread-166): 08:36:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1e9e20>]}
2022-02-11 08:36:58.183423 (Thread-166): sending response (<Response 2015 bytes [200 OK]>) to 10.0.9.33
2022-02-11 08:36:58.402987 (Thread-167): handling status request
2022-02-11 08:36:58.403292 (Thread-167): 08:36:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc18b220>]}
2022-02-11 08:36:58.403744 (Thread-167): sending response (<Response 2015 bytes [200 OK]>) to 10.0.4.196
2022-02-11 08:37:41.747127 (Thread-168): 08:37:41  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 08:37:41.747534 (Thread-168): 08:37:41  Partial parsing: updated file: my_new_project://models/legacy/customer_orders.sql
2022-02-11 08:37:41.753256 (Thread-168): 08:37:41  1699: static parser successfully parsed legacy/customer_orders.sql
2022-02-11 08:37:41.794503 (Thread-168): 08:37:41  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:37:41.799431 (Thread-168): 08:37:41  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc12a820>]}
2022-02-11 08:37:42.457340 (Thread-169): handling status request
2022-02-11 08:37:42.457670 (Thread-169): 08:37:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc123fa0>]}
2022-02-11 08:37:42.458345 (Thread-169): sending response (<Response 2015 bytes [200 OK]>) to 10.0.43.208
2022-02-11 08:37:43.299358 (Thread-170): handling status request
2022-02-11 08:37:43.299685 (Thread-170): 08:37:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc123df0>]}
2022-02-11 08:37:43.300159 (Thread-170): sending response (<Response 2015 bytes [200 OK]>) to 10.0.43.197
2022-02-11 08:37:46.489151 (Thread-171): handling status request
2022-02-11 08:37:46.489477 (Thread-171): 08:37:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc437e80>]}
2022-02-11 08:37:46.489989 (Thread-171): sending response (<Response 2015 bytes [200 OK]>) to 10.0.25.124
2022-02-11 08:37:46.654537 (Thread-172): handling status request
2022-02-11 08:37:46.654856 (Thread-172): 08:37:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1284f0>]}
2022-02-11 08:37:46.655332 (Thread-172): sending response (<Response 2015 bytes [200 OK]>) to 10.0.25.124
2022-02-11 08:37:46.812099 (Thread-173): handling cli_args request
2022-02-11 08:37:46.812422 (Thread-173): 08:37:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc159970>]}
2022-02-11 08:37:48.917106 (Thread-173): sending response (<Response 138 bytes [200 OK]>) to 10.0.5.250
2022-02-11 08:37:48.993472 (MainThread): 08:37:48  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 08:37:48.993893 (MainThread): 08:37:48  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 08:37:48.994366 (MainThread): 08:37:48  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:37:48.999505 (MainThread): 08:37:48  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bf611317-f2bc-45c0-b2c6-ee25c48405f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc50c50b20>]}
2022-02-11 08:37:49.025484 (MainThread): 08:37:49  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bf611317-f2bc-45c0-b2c6-ee25c48405f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc50cc9b80>]}
2022-02-11 08:37:49.025746 (MainThread): 08:37:49  Found 1 model, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 08:37:49.026662 (MainThread): 08:37:49  
2022-02-11 08:37:49.026934 (MainThread): 08:37:49  Acquiring new bigquery connection "master"
2022-02-11 08:37:49.027672 (ThreadPoolExecutor-0_0): 08:37:49  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 08:37:49.027829 (ThreadPoolExecutor-0_0): 08:37:49  Opening a new connection, currently in state init
2022-02-11 08:37:49.269165 (Thread-174): handling poll request
2022-02-11 08:37:49.269588 (Thread-174): 08:37:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc25fa00>]}
2022-02-11 08:37:49.270544 (Thread-174): sending response (<Response 3790 bytes [200 OK]>) to 10.0.25.40
2022-02-11 08:37:49.351510 (ThreadPoolExecutor-1_0): 08:37:49  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 08:37:49.351683 (ThreadPoolExecutor-1_0): 08:37:49  Opening a new connection, currently in state closed
2022-02-11 08:37:49.669398 (MainThread): 08:37:49  Concurrency: 4 threads (target='default')
2022-02-11 08:37:49.669571 (MainThread): 08:37:49  
2022-02-11 08:37:49.672148 (Thread-1): 08:37:49  Began running node model.my_new_project.customer_orders
2022-02-11 08:37:49.672454 (Thread-1): 08:37:49  1 of 1 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 08:37:49.672706 (Thread-1): 08:37:49  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 08:37:49.672806 (Thread-1): 08:37:49  Began compiling node model.my_new_project.customer_orders
2022-02-11 08:37:49.672905 (Thread-1): 08:37:49  Compiling model.my_new_project.customer_orders
2022-02-11 08:37:49.676964 (Thread-1): 08:37:49  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 08:37:49.692921 (Thread-1): 08:37:49  finished collecting timing info
2022-02-11 08:37:49.693073 (Thread-1): 08:37:49  Began executing node model.my_new_project.customer_orders
2022-02-11 08:37:49.721810 (Thread-1): 08:37:49  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 08:37:49.737896 (Thread-1): 08:37:49  Opening a new connection, currently in state closed
2022-02-11 08:37:49.742274 (Thread-1): 08:37:49  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 08:37:50.620508 (Thread-175): handling poll request
2022-02-11 08:37:50.620873 (Thread-175): 08:37:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc18b160>]}
2022-02-11 08:37:50.621663 (Thread-175): sending response (<Response 8610 bytes [200 OK]>) to 10.0.25.40
2022-02-11 08:37:50.781485 (Thread-1): 08:37:50  finished collecting timing info
2022-02-11 08:37:50.782108 (Thread-1): 08:37:50  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf611317-f2bc-45c0-b2c6-ee25c48405f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc5035ea60>]}
2022-02-11 08:37:50.782456 (Thread-1): 08:37:50  1 of 1 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.11s]
2022-02-11 08:37:50.782576 (Thread-1): 08:37:50  Finished running node model.my_new_project.customer_orders
2022-02-11 08:37:50.783925 (MainThread): 08:37:50  Acquiring new bigquery connection "master"
2022-02-11 08:37:50.784207 (MainThread): 08:37:50  
2022-02-11 08:37:50.784321 (MainThread): 08:37:50  Finished running 1 view model in 1.76s.
2022-02-11 08:37:50.784418 (MainThread): 08:37:50  Connection 'master' was properly closed.
2022-02-11 08:37:50.784487 (MainThread): 08:37:50  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 08:37:50.840215 (MainThread): 08:37:50  
2022-02-11 08:37:50.840397 (MainThread): 08:37:50  Completed successfully
2022-02-11 08:37:50.840497 (MainThread): 08:37:50  
2022-02-11 08:37:50.840588 (MainThread): 08:37:50  Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2022-02-11 08:37:51.986797 (Thread-176): handling poll request
2022-02-11 08:37:51.987126 (Thread-176): 08:37:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1310d0>]}
2022-02-11 08:37:51.988156 (Thread-176): sending response (<Response 12311 bytes [200 OK]>) to 10.0.20.67
2022-02-11 08:37:52.810058 (Thread-177): handling status request
2022-02-11 08:37:52.810384 (Thread-177): 08:37:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc131730>]}
2022-02-11 08:37:52.810888 (Thread-177): sending response (<Response 2015 bytes [200 OK]>) to 10.0.43.197
2022-02-11 08:37:53.059095 (Thread-178): handling status request
2022-02-11 08:37:53.059423 (Thread-178): 08:37:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc131b20>]}
2022-02-11 08:37:53.059896 (Thread-178): sending response (<Response 2015 bytes [200 OK]>) to 10.0.4.243
2022-02-11 08:38:34.318937 (Thread-179): 08:38:34  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-02-11 08:38:34.319264 (Thread-179): 08:38:34  Partial parsing: added file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 08:38:34.323306 (Thread-179): 08:38:34  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 08:38:34.361028 (Thread-179): 08:38:34  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:38:34.365670 (Thread-179): 08:38:34  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc04d9a0>]}
2022-02-11 08:38:35.872897 (Thread-180): handling status request
2022-02-11 08:38:35.873224 (Thread-180): 08:38:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc0a0e80>]}
2022-02-11 08:38:35.873733 (Thread-180): sending response (<Response 2021 bytes [200 OK]>) to 10.0.38.149
2022-02-11 08:38:35.925763 (Thread-181): handling status request
2022-02-11 08:38:35.925992 (Thread-181): 08:38:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc0a0a60>]}
2022-02-11 08:38:35.926393 (Thread-181): sending response (<Response 2021 bytes [200 OK]>) to 10.0.42.195
2022-02-11 08:38:41.189511 (Thread-182): 08:38:41  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 08:38:41.189894 (Thread-182): 08:38:41  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 08:38:41.194036 (Thread-182): 08:38:41  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 08:38:41.229256 (Thread-182): 08:38:41  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 08:38:41.233865 (Thread-182): 08:38:41  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58907a1e80>]}
2022-02-11 08:38:42.419239 (Thread-183): handling status request
2022-02-11 08:38:42.419594 (Thread-183): 08:38:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc091b20>]}
2022-02-11 08:38:42.420092 (Thread-183): sending response (<Response 2023 bytes [200 OK]>) to 10.0.40.197
2022-02-11 08:38:42.612172 (Thread-184): handling status request
2022-02-11 08:38:42.612476 (Thread-184): 08:38:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc135f40>]}
2022-02-11 08:38:42.612961 (Thread-184): sending response (<Response 2023 bytes [200 OK]>) to 10.0.4.165
2022-02-11 09:01:47.120754 (Thread-185): 09:01:47  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:01:47.122536 (Thread-185): 09:01:47  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:01:47.126959 (Thread-185): 09:01:47  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:01:47.164914 (Thread-185): 09:01:47  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:01:47.169658 (Thread-185): 09:01:47  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890775490>]}
2022-02-11 09:01:47.940098 (Thread-186): handling status request
2022-02-11 09:01:47.940433 (Thread-186): 09:01:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890780220>]}
2022-02-11 09:01:47.940933 (Thread-186): sending response (<Response 2023 bytes [200 OK]>) to 10.0.46.184
2022-02-11 09:01:49.239923 (Thread-187): handling status request
2022-02-11 09:01:49.240253 (Thread-187): 09:01:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc0331c0>]}
2022-02-11 09:01:49.240744 (Thread-187): sending response (<Response 2023 bytes [200 OK]>) to 10.0.19.158
2022-02-11 09:02:28.392885 (Thread-188): handling status request
2022-02-11 09:02:28.393229 (Thread-188): 09:02:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc033280>]}
2022-02-11 09:02:28.393744 (Thread-188): sending response (<Response 2023 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:02:28.689906 (Thread-189): handling status request
2022-02-11 09:02:28.690219 (Thread-189): 09:02:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc091e20>]}
2022-02-11 09:02:28.690688 (Thread-189): sending response (<Response 2023 bytes [200 OK]>) to 10.0.5.75
2022-02-11 09:02:28.749676 (Thread-190): handling cli_args request
2022-02-11 09:02:28.750007 (Thread-190): 09:02:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc0a0b50>]}
2022-02-11 09:02:30.902634 (Thread-190): sending response (<Response 138 bytes [200 OK]>) to 10.0.20.79
2022-02-11 09:02:31.005665 (MainThread): 09:02:31  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:02:31.006115 (MainThread): 09:02:31  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:02:31.006681 (MainThread): 09:02:31  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:02:31.012135 (MainThread): 09:02:31  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2d865a99-0860-4df4-b368-166ed485bafd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f695328d3d0>]}
2022-02-11 09:02:31.039612 (MainThread): 09:02:31  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2d865a99-0860-4df4-b368-166ed485bafd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6953311a60>]}
2022-02-11 09:02:31.039871 (MainThread): 09:02:31  Found 2 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:02:31.040894 (MainThread): 09:02:31  
2022-02-11 09:02:31.041175 (MainThread): 09:02:31  Acquiring new bigquery connection "master"
2022-02-11 09:02:31.042022 (ThreadPoolExecutor-0_0): 09:02:31  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 09:02:31.042178 (ThreadPoolExecutor-0_0): 09:02:31  Opening a new connection, currently in state init
2022-02-11 09:02:31.230744 (Thread-191): handling poll request
2022-02-11 09:02:31.231153 (Thread-191): 09:02:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890759ca0>]}
2022-02-11 09:02:31.232073 (Thread-191): sending response (<Response 3791 bytes [200 OK]>) to 10.0.20.79
2022-02-11 09:02:31.308591 (ThreadPoolExecutor-1_0): 09:02:31  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 09:02:31.308780 (ThreadPoolExecutor-1_0): 09:02:31  Opening a new connection, currently in state closed
2022-02-11 09:02:31.565219 (MainThread): 09:02:31  Concurrency: 4 threads (target='default')
2022-02-11 09:02:31.565382 (MainThread): 09:02:31  
2022-02-11 09:02:31.567860 (Thread-1): 09:02:31  Began running node model.my_new_project.customer_orders
2022-02-11 09:02:31.568156 (Thread-1): 09:02:31  1 of 2 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 09:02:31.568423 (Thread-1): 09:02:31  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 09:02:31.568518 (Thread-1): 09:02:31  Began compiling node model.my_new_project.customer_orders
2022-02-11 09:02:31.568612 (Thread-1): 09:02:31  Compiling model.my_new_project.customer_orders
2022-02-11 09:02:31.572511 (Thread-2): 09:02:31  Began running node model.my_new_project.fct_customers_orders
2022-02-11 09:02:31.572732 (Thread-2): 09:02:31  2 of 2 START view model dbt_luisscabral.fct_customers_orders.................... [RUN]
2022-02-11 09:02:31.572989 (Thread-2): 09:02:31  Acquiring new bigquery connection "model.my_new_project.fct_customers_orders"
2022-02-11 09:02:31.573076 (Thread-2): 09:02:31  Began compiling node model.my_new_project.fct_customers_orders
2022-02-11 09:02:31.573159 (Thread-2): 09:02:31  Compiling model.my_new_project.fct_customers_orders
2022-02-11 09:02:31.576145 (Thread-2): 09:02:31  Writing injected SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:02:31.578707 (Thread-1): 09:02:31  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:02:31.592875 (Thread-1): 09:02:31  finished collecting timing info
2022-02-11 09:02:31.593019 (Thread-1): 09:02:31  Began executing node model.my_new_project.customer_orders
2022-02-11 09:02:31.598227 (Thread-2): 09:02:31  finished collecting timing info
2022-02-11 09:02:31.598362 (Thread-2): 09:02:31  Began executing node model.my_new_project.fct_customers_orders
2022-02-11 09:02:31.638229 (Thread-1): 09:02:31  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:02:31.639430 (Thread-2): 09:02:31  Writing runtime SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:02:31.654378 (Thread-1): 09:02:31  Opening a new connection, currently in state closed
2022-02-11 09:02:31.657548 (Thread-2): 09:02:31  Opening a new connection, currently in state init
2022-02-11 09:02:31.658830 (Thread-1): 09:02:31  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 09:02:31.661837 (Thread-2): 09:02:31  On model.my_new_project.fct_customers_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customers_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customers_orders`
  OPTIONS()
  as with

-- Import CTEs
customers as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

orders as (

    select * from `dbt-tutorial`.`jaffle_shop`.`orders`

),

payments as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

-- Logical CTEs
customers as (

    select 

        first_name || ' ' || last_name as name, 
        * 

    from customers

),

a as (

      select 

        row_number() over (
            partition by user_id 
            order by order_date, id
        ) as user_order_seq,
        *

      from orders

),

b as ( 

    select 

        first_name || ' ' || last_name as name, 
        * 

    from customers

),

customer_order_history as (

    select 

        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,

        min(order_date) as first_order_date,

        min(case 
            when a.status not in ('returned','return_pending') 
            then order_date 
        end) as first_non_returned_order_date,

        max(case 
            when a.status not in ('returned','return_pending') 
            then order_date 
        end) as most_recent_non_returned_order_date,

        coalesce(max(user_order_seq),0) as order_count,

        coalesce(count(case 
            when a.status != 'returned' 
            then 1 end),
            0
        ) as non_returned_order_count,

        sum(case 
            when a.status not in ('returned','return_pending') 
            then round(c.amount/100.0,2) 
            else 0 
        end) as total_lifetime_value,

        sum(case 
            when a.status not in ('returned','return_pending') 
            then round(c.amount/100.0,2) 
            else 0 
        end)
        / nullif(count(case 
            when a.status not in ('returned','return_pending') 
            then 1 end),
            0
        ) as avg_non_returned_order_value,

        array_agg(distinct a.id) as order_ids

    from a

    join b
    on a.user_id = b.id

    left outer join payments as c
    on a.id = c.orderid

    where a.status not in ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

),

-- Final CTEs 
final as (

    select 

        orders.id as order_id,
        orders.user_id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_order_date,
        order_count,
        total_lifetime_value,
        round(amount/100.0,2) as order_value_dollars,
        orders.status as order_status,
        payments.status as payment_status

    from orders

    join customers
    on orders.user_id = customers.id

    join customer_order_history
    on orders.user_id = customer_order_history.customer_id

    left outer join payments
    on orders.id = payments.orderid

    where payments.status != 'fail'

)

-- Simple Select Statement
select * from final;


2022-02-11 09:02:32.537244 (Thread-2): 09:02:32  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Duplicate alias customers for WITH subquery at [28:1]')
2022-02-11 09:02:32.563403 (Thread-192): handling poll request
2022-02-11 09:02:32.563735 (Thread-192): 09:02:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890768d90>]}
2022-02-11 09:02:32.564620 (Thread-192): sending response (<Response 16955 bytes [200 OK]>) to 10.0.31.57
2022-02-11 09:02:32.976824 (Thread-1): 09:02:32  finished collecting timing info
2022-02-11 09:02:32.977431 (Thread-1): 09:02:32  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2d865a99-0860-4df4-b368-166ed485bafd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69501c3850>]}
2022-02-11 09:02:32.977800 (Thread-1): 09:02:32  1 of 2 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.41s]
2022-02-11 09:02:32.977920 (Thread-1): 09:02:32  Finished running node model.my_new_project.customer_orders
2022-02-11 09:02:33.433582 (Thread-2): 09:02:33  finished collecting timing info
2022-02-11 09:02:33.434042 (Thread-2): 09:02:33  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
  Duplicate alias customers for WITH subquery at [28:1]
  compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:02:33.434393 (Thread-2): 09:02:33  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2d865a99-0860-4df4-b368-166ed485bafd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69501726a0>]}
2022-02-11 09:02:33.434723 (Thread-2): 09:02:33  2 of 2 ERROR creating view model dbt_luisscabral.fct_customers_orders........... [ERROR in 1.86s]
2022-02-11 09:02:33.434831 (Thread-2): 09:02:33  Finished running node model.my_new_project.fct_customers_orders
2022-02-11 09:02:33.436352 (MainThread): 09:02:33  Acquiring new bigquery connection "master"
2022-02-11 09:02:33.436668 (MainThread): 09:02:33  
2022-02-11 09:02:33.436766 (MainThread): 09:02:33  Finished running 2 view models in 2.40s.
2022-02-11 09:02:33.436847 (MainThread): 09:02:33  Connection 'master' was properly closed.
2022-02-11 09:02:33.436915 (MainThread): 09:02:33  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 09:02:33.436991 (MainThread): 09:02:33  Connection 'model.my_new_project.fct_customers_orders' was properly closed.
2022-02-11 09:02:33.498212 (MainThread): 09:02:33  
2022-02-11 09:02:33.498365 (MainThread): 09:02:33  Completed with 1 error and 0 warnings:
2022-02-11 09:02:33.498454 (MainThread): 09:02:33  
2022-02-11 09:02:33.498544 (MainThread): 09:02:33  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
2022-02-11 09:02:33.498621 (MainThread): 09:02:33    Duplicate alias customers for WITH subquery at [28:1]
2022-02-11 09:02:33.498689 (MainThread): 09:02:33    compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:02:33.498767 (MainThread): 09:02:33  
2022-02-11 09:02:33.498847 (MainThread): 09:02:33  Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2022-02-11 09:02:33.933080 (Thread-193): handling poll request
2022-02-11 09:02:33.933420 (Thread-193): 09:02:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589076c460>]}
2022-02-11 09:02:33.934702 (Thread-193): sending response (<Response 25564 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:02:34.713291 (Thread-194): handling status request
2022-02-11 09:02:34.713622 (Thread-194): 09:02:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589076c310>]}
2022-02-11 09:02:34.714172 (Thread-194): sending response (<Response 2023 bytes [200 OK]>) to 10.0.10.236
2022-02-11 09:02:35.550970 (Thread-195): handling status request
2022-02-11 09:02:35.551289 (Thread-195): 09:02:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589076cca0>]}
2022-02-11 09:02:35.551754 (Thread-195): sending response (<Response 2023 bytes [200 OK]>) to 10.0.40.216
2022-02-11 09:03:01.672243 (Thread-196): 09:03:01  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:03:01.672653 (Thread-196): 09:03:01  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:03:01.677721 (Thread-196): 09:03:01  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:03:01.716830 (Thread-196): 09:03:01  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:03:01.722096 (Thread-196): 09:03:01  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58906a6e50>]}
2022-02-11 09:03:02.565959 (Thread-197): handling status request
2022-02-11 09:03:02.566294 (Thread-197): 09:03:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589067de20>]}
2022-02-11 09:03:02.566781 (Thread-197): sending response (<Response 2023 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:03:02.747697 (Thread-198): handling status request
2022-02-11 09:03:02.748032 (Thread-198): 09:03:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589067dcd0>]}
2022-02-11 09:03:02.771524 (Thread-198): sending response (<Response 2023 bytes [200 OK]>) to 10.0.38.212
2022-02-11 09:03:04.284718 (Thread-199): handling status request
2022-02-11 09:03:04.285150 (Thread-199): 09:03:04  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589067dfa0>]}
2022-02-11 09:03:04.285736 (Thread-199): sending response (<Response 2023 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:03:04.521604 (Thread-200): handling status request
2022-02-11 09:03:04.522009 (Thread-200): 09:03:04  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589067d250>]}
2022-02-11 09:03:04.522497 (Thread-200): sending response (<Response 2023 bytes [200 OK]>) to 10.0.10.236
2022-02-11 09:03:04.660951 (Thread-201): handling cli_args request
2022-02-11 09:03:04.661387 (Thread-201): 09:03:04  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890768fd0>]}
2022-02-11 09:03:06.817127 (Thread-201): sending response (<Response 138 bytes [200 OK]>) to 10.0.38.212
2022-02-11 09:03:06.923642 (MainThread): 09:03:06  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:03:06.924157 (MainThread): 09:03:06  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:03:06.924822 (MainThread): 09:03:06  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:03:06.930652 (MainThread): 09:03:06  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f08d454d-4729-4ac4-b9c7-eb0fbe45e016', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a37dbc400>]}
2022-02-11 09:03:06.954513 (MainThread): 09:03:06  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f08d454d-4729-4ac4-b9c7-eb0fbe45e016', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a37e3fa90>]}
2022-02-11 09:03:06.954746 (MainThread): 09:03:06  Found 2 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:03:06.955754 (MainThread): 09:03:06  
2022-02-11 09:03:06.956030 (MainThread): 09:03:06  Acquiring new bigquery connection "master"
2022-02-11 09:03:06.956825 (ThreadPoolExecutor-0_0): 09:03:06  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 09:03:06.956988 (ThreadPoolExecutor-0_0): 09:03:06  Opening a new connection, currently in state init
2022-02-11 09:03:07.111129 (Thread-202): handling poll request
2022-02-11 09:03:07.111513 (Thread-202): 09:03:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589067d820>]}
2022-02-11 09:03:07.112392 (Thread-202): sending response (<Response 3791 bytes [200 OK]>) to 10.0.3.5
2022-02-11 09:03:07.341638 (ThreadPoolExecutor-1_0): 09:03:07  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 09:03:07.341849 (ThreadPoolExecutor-1_0): 09:03:07  Opening a new connection, currently in state closed
2022-02-11 09:03:07.642479 (MainThread): 09:03:07  Concurrency: 4 threads (target='default')
2022-02-11 09:03:07.642643 (MainThread): 09:03:07  
2022-02-11 09:03:07.645016 (Thread-1): 09:03:07  Began running node model.my_new_project.customer_orders
2022-02-11 09:03:07.645318 (Thread-1): 09:03:07  1 of 2 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 09:03:07.645585 (Thread-1): 09:03:07  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 09:03:07.645687 (Thread-1): 09:03:07  Began compiling node model.my_new_project.customer_orders
2022-02-11 09:03:07.645812 (Thread-1): 09:03:07  Compiling model.my_new_project.customer_orders
2022-02-11 09:03:07.649883 (Thread-2): 09:03:07  Began running node model.my_new_project.fct_customers_orders
2022-02-11 09:03:07.650126 (Thread-2): 09:03:07  2 of 2 START view model dbt_luisscabral.fct_customers_orders.................... [RUN]
2022-02-11 09:03:07.650397 (Thread-2): 09:03:07  Acquiring new bigquery connection "model.my_new_project.fct_customers_orders"
2022-02-11 09:03:07.650491 (Thread-2): 09:03:07  Began compiling node model.my_new_project.fct_customers_orders
2022-02-11 09:03:07.650575 (Thread-2): 09:03:07  Compiling model.my_new_project.fct_customers_orders
2022-02-11 09:03:07.653530 (Thread-2): 09:03:07  Writing injected SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:03:07.655857 (Thread-1): 09:03:07  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:03:07.670585 (Thread-2): 09:03:07  finished collecting timing info
2022-02-11 09:03:07.670733 (Thread-2): 09:03:07  Began executing node model.my_new_project.fct_customers_orders
2022-02-11 09:03:07.675693 (Thread-1): 09:03:07  finished collecting timing info
2022-02-11 09:03:07.675826 (Thread-1): 09:03:07  Began executing node model.my_new_project.customer_orders
2022-02-11 09:03:07.715960 (Thread-2): 09:03:07  Writing runtime SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:03:07.717324 (Thread-1): 09:03:07  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:03:07.732745 (Thread-1): 09:03:07  Opening a new connection, currently in state closed
2022-02-11 09:03:07.732991 (Thread-2): 09:03:07  Opening a new connection, currently in state init
2022-02-11 09:03:07.737344 (Thread-1): 09:03:07  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 09:03:07.738285 (Thread-2): 09:03:07  On model.my_new_project.fct_customers_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customers_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customers_orders`
  OPTIONS()
  as with

-- Import CTEs
base_customers as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

orders as (

    select * from `dbt-tutorial`.`jaffle_shop`.`orders`

),

payments as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

-- Logical CTEs
customers as (

    select 

        first_name || ' ' || last_name as name, 
        * 

    from base_customers

),

a as (

      select 

        row_number() over (
            partition by user_id 
            order by order_date, id
        ) as user_order_seq,
        *

      from orders

),

b as ( 

    select 

        first_name || ' ' || last_name as name, 
        * 

    from customers

),

customer_order_history as (

    select 

        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,

        min(order_date) as first_order_date,

        min(case 
            when a.status not in ('returned','return_pending') 
            then order_date 
        end) as first_non_returned_order_date,

        max(case 
            when a.status not in ('returned','return_pending') 
            then order_date 
        end) as most_recent_non_returned_order_date,

        coalesce(max(user_order_seq),0) as order_count,

        coalesce(count(case 
            when a.status != 'returned' 
            then 1 end),
            0
        ) as non_returned_order_count,

        sum(case 
            when a.status not in ('returned','return_pending') 
            then round(c.amount/100.0,2) 
            else 0 
        end) as total_lifetime_value,

        sum(case 
            when a.status not in ('returned','return_pending') 
            then round(c.amount/100.0,2) 
            else 0 
        end)
        / nullif(count(case 
            when a.status not in ('returned','return_pending') 
            then 1 end),
            0
        ) as avg_non_returned_order_value,

        array_agg(distinct a.id) as order_ids

    from a

    join b
    on a.user_id = b.id

    left outer join payments as c
    on a.id = c.orderid

    where a.status not in ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

),

-- Final CTEs 
final as (

    select 

        orders.id as order_id,
        orders.user_id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_order_date,
        order_count,
        total_lifetime_value,
        round(amount/100.0,2) as order_value_dollars,
        orders.status as order_status,
        payments.status as payment_status

    from orders

    join customers
    on orders.user_id = customers.id

    join customer_order_history
    on orders.user_id = customer_order_history.customer_id

    left outer join payments
    on orders.id = payments.orderid

    where payments.status != 'fail'

)

-- Simple Select Statement
select * from final;


2022-02-11 09:03:08.468320 (Thread-203): handling poll request
2022-02-11 09:03:08.468666 (Thread-203): 09:03:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890697040>]}
2022-02-11 09:03:08.469475 (Thread-203): sending response (<Response 16546 bytes [200 OK]>) to 10.0.38.212
2022-02-11 09:03:08.705936 (Thread-2): 09:03:08  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Name name is ambiguous inside b at [69:11]')
2022-02-11 09:03:08.750349 (Thread-1): 09:03:08  finished collecting timing info
2022-02-11 09:03:08.750777 (Thread-1): 09:03:08  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f08d454d-4729-4ac4-b9c7-eb0fbe45e016', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a34491610>]}
2022-02-11 09:03:08.751233 (Thread-1): 09:03:08  1 of 2 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.11s]
2022-02-11 09:03:08.751359 (Thread-1): 09:03:08  Finished running node model.my_new_project.customer_orders
2022-02-11 09:03:09.802995 (Thread-204): handling poll request
2022-02-11 09:03:09.803312 (Thread-204): 09:03:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58906a7340>]}
2022-02-11 09:03:09.803850 (Thread-204): sending response (<Response 2494 bytes [200 OK]>) to 10.0.46.184
2022-02-11 09:03:10.617321 (Thread-2): 09:03:10  finished collecting timing info
2022-02-11 09:03:10.617788 (Thread-2): 09:03:10  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
  Name name is ambiguous inside b at [69:11]
  compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:03:10.618135 (Thread-2): 09:03:10  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f08d454d-4729-4ac4-b9c7-eb0fbe45e016', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a3449d280>]}
2022-02-11 09:03:10.618477 (Thread-2): 09:03:10  2 of 2 ERROR creating view model dbt_luisscabral.fct_customers_orders........... [ERROR in 2.97s]
2022-02-11 09:03:10.618591 (Thread-2): 09:03:10  Finished running node model.my_new_project.fct_customers_orders
2022-02-11 09:03:10.620178 (MainThread): 09:03:10  Acquiring new bigquery connection "master"
2022-02-11 09:03:10.620484 (MainThread): 09:03:10  
2022-02-11 09:03:10.620582 (MainThread): 09:03:10  Finished running 2 view models in 3.66s.
2022-02-11 09:03:10.620662 (MainThread): 09:03:10  Connection 'master' was properly closed.
2022-02-11 09:03:10.620728 (MainThread): 09:03:10  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 09:03:10.620792 (MainThread): 09:03:10  Connection 'model.my_new_project.fct_customers_orders' was properly closed.
2022-02-11 09:03:10.671998 (MainThread): 09:03:10  
2022-02-11 09:03:10.672217 (MainThread): 09:03:10  Completed with 1 error and 0 warnings:
2022-02-11 09:03:10.672327 (MainThread): 09:03:10  
2022-02-11 09:03:10.672422 (MainThread): 09:03:10  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
2022-02-11 09:03:10.672500 (MainThread): 09:03:10    Name name is ambiguous inside b at [69:11]
2022-02-11 09:03:10.672568 (MainThread): 09:03:10    compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:03:10.672656 (MainThread): 09:03:10  
2022-02-11 09:03:10.672743 (MainThread): 09:03:10  Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2022-02-11 09:03:11.136586 (Thread-205): handling poll request
2022-02-11 09:03:11.136937 (Thread-205): 09:03:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890690670>]}
2022-02-11 09:03:11.138120 (Thread-205): sending response (<Response 23736 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:03:13.328849 (Thread-206): handling status request
2022-02-11 09:03:13.329184 (Thread-206): 09:03:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890690820>]}
2022-02-11 09:03:13.329700 (Thread-206): sending response (<Response 2023 bytes [200 OK]>) to 10.0.3.5
2022-02-11 09:03:13.566782 (Thread-207): handling status request
2022-02-11 09:03:13.567139 (Thread-207): 09:03:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890690be0>]}
2022-02-11 09:03:13.567616 (Thread-207): sending response (<Response 2023 bytes [200 OK]>) to 10.0.19.158
2022-02-11 09:14:08.058612 (Thread-208): handling status request
2022-02-11 09:14:08.058948 (Thread-208): 09:14:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58906b80a0>]}
2022-02-11 09:14:08.059421 (Thread-208): sending response (<Response 2023 bytes [200 OK]>) to 10.0.13.131
2022-02-11 09:14:08.169579 (Thread-209): handling status request
2022-02-11 09:14:08.169909 (Thread-209): 09:14:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58906b8430>]}
2022-02-11 09:14:08.170369 (Thread-209): sending response (<Response 2023 bytes [200 OK]>) to 10.0.46.184
2022-02-11 09:14:08.246159 (Thread-210): handling ps request
2022-02-11 09:14:08.246416 (Thread-210): 09:14:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58906b82e0>]}
2022-02-11 09:14:08.248137 (Thread-210): sending response (<Response 10058 bytes [200 OK]>) to 10.0.19.158
2022-02-11 09:14:08.375156 (Thread-211): handling status request
2022-02-11 09:14:08.375420 (Thread-211): 09:14:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890690820>]}
2022-02-11 09:14:08.375854 (Thread-211): sending response (<Response 2023 bytes [200 OK]>) to 10.0.19.158
2022-02-11 09:14:10.470453 (Thread-212): handling poll request
2022-02-11 09:14:10.470790 (Thread-212): 09:14:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58906903d0>]}
2022-02-11 09:14:10.472191 (Thread-212): sending response (<Response 45715 bytes [200 OK]>) to 10.0.46.69
2022-02-11 09:14:10.482471 (Thread-213): handling status request
2022-02-11 09:14:10.482748 (Thread-213): 09:14:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890690580>]}
2022-02-11 09:14:10.483148 (Thread-213): sending response (<Response 2023 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:14:42.223000 (Thread-214): 09:14:42  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-02-11 09:14:42.223360 (Thread-214): 09:14:42  Partial parsing: added file: my_new_project://models/staging/jaffle_shop/stg_jaffle_shop__customers.sql
2022-02-11 09:14:42.227706 (Thread-214): 09:14:42  1699: static parser successfully parsed staging/jaffle_shop/stg_jaffle_shop__customers.sql
2022-02-11 09:14:42.273461 (Thread-214): 09:14:42  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:14:42.278855 (Thread-214): 09:14:42  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58905f3670>]}
2022-02-11 09:14:43.091964 (Thread-215): handling status request
2022-02-11 09:14:43.092301 (Thread-215): 09:14:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890622490>]}
2022-02-11 09:14:43.092815 (Thread-215): sending response (<Response 2061 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:14:43.133347 (Thread-216): handling status request
2022-02-11 09:14:43.133584 (Thread-216): 09:14:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890622190>]}
2022-02-11 09:14:43.134019 (Thread-216): sending response (<Response 2061 bytes [200 OK]>) to 10.0.44.113
2022-02-11 09:14:45.152161 (Thread-217): handling status request
2022-02-11 09:14:45.153072 (Thread-217): 09:14:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58905cedf0>]}
2022-02-11 09:14:45.153233 (Thread-218): handling status request
2022-02-11 09:14:45.153770 (Thread-217): sending response (<Response 2061 bytes [200 OK]>) to 10.0.44.113
2022-02-11 09:14:45.154088 (Thread-218): 09:14:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58906b8220>]}
2022-02-11 09:14:45.154912 (Thread-218): sending response (<Response 2061 bytes [200 OK]>) to 10.0.20.79
2022-02-11 09:15:18.680157 (Thread-219): handling status request
2022-02-11 09:15:18.680467 (Thread-219): 09:15:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58905cea90>]}
2022-02-11 09:15:18.680945 (Thread-219): sending response (<Response 2061 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:15:21.422630 (Thread-220): 09:15:21  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:15:21.422820 (Thread-220): 09:15:21  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:15:21.423105 (Thread-220): 09:15:21  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:15:21.427729 (Thread-220): 09:15:21  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58905589a0>]}
2022-02-11 09:15:22.272283 (Thread-221): handling status request
2022-02-11 09:15:22.272613 (Thread-221): 09:15:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc17df10>]}
2022-02-11 09:15:22.273084 (Thread-221): sending response (<Response 1685 bytes [200 OK]>) to 10.0.5.75
2022-02-11 09:15:24.494591 (Thread-222): handling status request
2022-02-11 09:15:24.494926 (Thread-222): 09:15:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58906a6ac0>]}
2022-02-11 09:15:24.495407 (Thread-222): sending response (<Response 1685 bytes [200 OK]>) to 10.0.40.216
2022-02-11 09:15:27.378660 (Thread-223): 09:15:27  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:15:27.379018 (Thread-223): 09:15:27  Partial parsing: updated file: my_new_project://models/staging/jaffle_shop/stg_jaffle_shop__customers.sql
2022-02-11 09:15:27.383257 (Thread-223): 09:15:27  1699: static parser successfully parsed staging/jaffle_shop/stg_jaffle_shop__customers.sql
2022-02-11 09:15:27.418619 (Thread-223): 09:15:27  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:15:27.423342 (Thread-223): 09:15:27  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904e0fd0>]}
2022-02-11 09:15:27.984136 (Thread-224): handling status request
2022-02-11 09:15:27.984466 (Thread-224): 09:15:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890600310>]}
2022-02-11 09:15:27.984965 (Thread-224): sending response (<Response 2063 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:15:28.028444 (Thread-225): handling status request
2022-02-11 09:15:28.028665 (Thread-225): 09:15:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58906005b0>]}
2022-02-11 09:15:28.029055 (Thread-225): sending response (<Response 2063 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:16:00.039692 (Thread-226): 09:16:00  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-02-11 09:16:00.039989 (Thread-226): 09:16:00  Partial parsing: added file: my_new_project://models/staging/jaffle_shop/stg_jaffle_shop__orders.sql
2022-02-11 09:16:00.043580 (Thread-226): 09:16:00  1699: static parser successfully parsed staging/jaffle_shop/stg_jaffle_shop__orders.sql
2022-02-11 09:16:00.082618 (Thread-226): 09:16:00  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:16:00.087194 (Thread-226): 09:16:00  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904f7cd0>]}
2022-02-11 09:16:00.935138 (Thread-227): handling status request
2022-02-11 09:16:00.935484 (Thread-227): 09:16:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904c2190>]}
2022-02-11 09:16:00.935979 (Thread-227): sending response (<Response 2055 bytes [200 OK]>) to 10.0.30.21
2022-02-11 09:16:01.950627 (Thread-228): handling status request
2022-02-11 09:16:01.950966 (Thread-228): 09:16:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904c26a0>]}
2022-02-11 09:16:01.972841 (Thread-228): sending response (<Response 2055 bytes [200 OK]>) to 10.0.46.69
2022-02-11 09:18:07.646093 (Thread-229): 09:18:07  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:18:07.648388 (Thread-229): 09:18:07  Partial parsing: updated file: my_new_project://models/staging/jaffle_shop/stg_jaffle_shop__orders.sql
2022-02-11 09:18:07.652348 (Thread-229): 09:18:07  1699: static parser successfully parsed staging/jaffle_shop/stg_jaffle_shop__orders.sql
2022-02-11 09:18:07.695104 (Thread-229): 09:18:07  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:18:07.700127 (Thread-229): 09:18:07  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904149a0>]}
2022-02-11 09:18:08.373350 (Thread-230): handling status request
2022-02-11 09:18:08.373675 (Thread-230): 09:18:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904c7be0>]}
2022-02-11 09:18:08.374193 (Thread-230): sending response (<Response 2057 bytes [200 OK]>) to 10.0.11.229
2022-02-11 09:18:09.460608 (Thread-231): handling status request
2022-02-11 09:18:09.460943 (Thread-231): 09:18:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904d17f0>]}
2022-02-11 09:18:09.461414 (Thread-231): sending response (<Response 2057 bytes [200 OK]>) to 10.0.10.236
2022-02-11 09:18:25.039050 (Thread-232): 09:18:25  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-02-11 09:18:25.039379 (Thread-232): 09:18:25  Partial parsing: added file: my_new_project://models/staging/stripe/stg_stripe__payments.sql
2022-02-11 09:18:25.043265 (Thread-232): 09:18:25  1699: static parser successfully parsed staging/stripe/stg_stripe__payments.sql
2022-02-11 09:18:25.079818 (Thread-232): 09:18:25  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:18:25.085319 (Thread-232): 09:18:25  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58903f8d90>]}
2022-02-11 09:18:26.545318 (Thread-233): handling status request
2022-02-11 09:18:26.545664 (Thread-233): 09:18:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589058f9a0>]}
2022-02-11 09:18:26.546208 (Thread-233): sending response (<Response 2039 bytes [200 OK]>) to 10.0.13.131
2022-02-11 09:18:26.662839 (Thread-234): handling status request
2022-02-11 09:18:26.663117 (Thread-234): 09:18:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589058f220>]}
2022-02-11 09:18:26.663579 (Thread-234): sending response (<Response 2039 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:19:42.648444 (Thread-235): 09:19:42  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:19:42.650814 (Thread-235): 09:19:42  Partial parsing: updated file: my_new_project://models/staging/stripe/stg_stripe__payments.sql
2022-02-11 09:19:42.654876 (Thread-235): 09:19:42  1699: static parser successfully parsed staging/stripe/stg_stripe__payments.sql
2022-02-11 09:19:42.696347 (Thread-235): 09:19:42  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:19:42.701565 (Thread-235): 09:19:42  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890681d00>]}
2022-02-11 09:19:43.263966 (Thread-236): handling status request
2022-02-11 09:19:43.264292 (Thread-236): 09:19:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58903cf6d0>]}
2022-02-11 09:19:43.264768 (Thread-236): sending response (<Response 2041 bytes [200 OK]>) to 10.0.44.113
2022-02-11 09:19:43.271698 (Thread-237): handling status request
2022-02-11 09:19:43.271947 (Thread-237): 09:19:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58903cf460>]}
2022-02-11 09:19:43.272315 (Thread-237): sending response (<Response 2041 bytes [200 OK]>) to 10.0.11.229
2022-02-11 09:20:49.363504 (Thread-238): 09:20:49  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:20:49.365765 (Thread-238): 09:20:49  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:20:49.369858 (Thread-238): 09:20:49  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:20:49.410991 (Thread-238): 09:20:49  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:20:49.415968 (Thread-238): 09:20:49  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc123e80>]}
2022-02-11 09:20:50.121090 (Thread-239): handling status request
2022-02-11 09:20:50.121402 (Thread-239): 09:20:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904ee940>]}
2022-02-11 09:20:50.121923 (Thread-239): sending response (<Response 2023 bytes [200 OK]>) to 10.0.3.5
2022-02-11 09:20:51.216422 (Thread-240): handling status request
2022-02-11 09:20:51.216750 (Thread-240): 09:20:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904ee4c0>]}
2022-02-11 09:20:51.217236 (Thread-240): sending response (<Response 2023 bytes [200 OK]>) to 10.0.46.184
2022-02-11 09:25:10.126861 (Thread-241): handling status request
2022-02-11 09:25:10.127197 (Thread-241): 09:25:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904eedc0>]}
2022-02-11 09:25:10.127707 (Thread-241): sending response (<Response 2023 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:25:10.311073 (Thread-242): handling status request
2022-02-11 09:25:10.311407 (Thread-242): 09:25:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904ee3a0>]}
2022-02-11 09:25:10.311871 (Thread-242): sending response (<Response 2023 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:25:10.375638 (Thread-243): handling ps request
2022-02-11 09:25:10.375907 (Thread-243): 09:25:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904f7280>]}
2022-02-11 09:25:10.377010 (Thread-243): sending response (<Response 10058 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:25:10.425344 (Thread-244): handling status request
2022-02-11 09:25:10.425583 (Thread-244): 09:25:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904f7430>]}
2022-02-11 09:25:10.426038 (Thread-244): sending response (<Response 2023 bytes [200 OK]>) to 10.0.46.69
2022-02-11 09:25:11.742544 (Thread-245): handling poll request
2022-02-11 09:25:11.742864 (Thread-245): 09:25:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904f7820>]}
2022-02-11 09:25:11.744206 (Thread-245): sending response (<Response 45715 bytes [200 OK]>) to 10.0.31.57
2022-02-11 09:25:13.164126 (Thread-246): handling status request
2022-02-11 09:25:13.164432 (Thread-246): 09:25:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904f7850>]}
2022-02-11 09:25:13.164898 (Thread-246): sending response (<Response 2001 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:25:13.167011 (Thread-247): handling status request
2022-02-11 09:25:13.167259 (Thread-247): 09:25:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904f7d00>]}
2022-02-11 09:25:13.167603 (Thread-247): sending response (<Response 2001 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:25:13.168461 (Thread-248): handling status request
2022-02-11 09:25:13.168702 (Thread-248): 09:25:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890622760>]}
2022-02-11 09:25:13.169036 (Thread-248): sending response (<Response 2001 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:25:13.170462 (Thread-249): handling list request
2022-02-11 09:25:13.170754 (Thread-249): 09:25:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904f4250>]}
2022-02-11 09:25:13.171197 (Thread-250): handling status request
2022-02-11 09:25:13.172365 (Thread-250): 09:25:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904ec9d0>]}
2022-02-11 09:25:13.172765 (Thread-250): sending response (<Response 2001 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:25:13.225153 (Thread-252): sending response (<Response 214 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:25:13.220696 (Thread-251): 09:25:13  The selection criterion '+1644567947323/__unsaved/Statement' does not match any nodes
2022-02-11 09:25:13.220874 (Thread-251): 09:25:13  The selection criterion '1.sql+' does not match any nodes
2022-02-11 09:25:13.220971 (Thread-251): 09:25:13  No nodes selected!
2022-02-11 09:25:13.227262 (Thread-251): sending response (<Response 5709 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:25:13.315456 (Thread-254): handling status request
2022-02-11 09:25:13.315749 (Thread-254): 09:25:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58907df1c0>]}
2022-02-11 09:25:13.330179 (Thread-255): handling status request
2022-02-11 09:25:13.330431 (Thread-255): 09:25:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58907ec730>]}
2022-02-11 09:25:13.337814 (Thread-254): sending response (<Response 2001 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:25:13.338191 (Thread-255): sending response (<Response 2001 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:25:13.343989 (Thread-256): handling list request
2022-02-11 09:25:13.344536 (Thread-257): handling list request
2022-02-11 09:25:13.344806 (Thread-256): 09:25:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc0ae280>]}
2022-02-11 09:25:13.345023 (Thread-257): 09:25:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589076d6a0>]}
2022-02-11 09:25:13.377553 (Thread-256): 09:25:13  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:25:13.377986 (Thread-257): 09:25:13  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58907ec4c0>]}
2022-02-11 09:25:13.382274 (Thread-256): sending response (<Response 1773 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:25:13.378212 (Thread-257): 09:25:13  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:25:13.383256 (Thread-257): sending response (<Response 5599 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:25:13.609139 (Thread-258): handling status request
2022-02-11 09:25:13.609442 (Thread-258): 09:25:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589076d550>]}
2022-02-11 09:25:13.609961 (Thread-258): sending response (<Response 2023 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:25:26.708315 (Thread-259): handling status request
2022-02-11 09:25:26.708646 (Thread-259): 09:25:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904c5be0>]}
2022-02-11 09:25:26.709417 (Thread-259): sending response (<Response 2001 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:25:26.714898 (Thread-260): handling list request
2022-02-11 09:25:26.715127 (Thread-260): 09:25:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc0ae130>]}
2022-02-11 09:25:26.748253 (Thread-260): 09:25:26  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58907754f0>]}
2022-02-11 09:25:26.748530 (Thread-260): 09:25:26  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:25:26.752290 (Thread-260): sending response (<Response 4579 bytes [200 OK]>) to 10.0.32.67
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     w_tracker.self_describing_json.SelfDescribingJson object at 0x7f517415dee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f517418f4c0>]}
2022-02-11 09:25:54.436589 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=186
2022-02-11 09:25:54.436852 (MainThread): Supported methods: ['build', 'cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'list', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'source-freshness', 'status', 'test']
2022-02-11 09:25:54.436986 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-02-11 09:25:54.521390 (Thread-12): 09:25:54  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:25:54.521617 (Thread-12): 09:25:54  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:25:54.522112 (Thread-12): 09:25:54  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:25:54.528335 (Thread-12): 09:25:54  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ef37323b-4a33-4809-b6b7-0e11220bd65f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f513aac63d0>]}
2022-02-11 09:29:02.279591 (Thread-261): 09:29:02  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:29:02.281855 (Thread-261): 09:29:02  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:29:02.286839 (Thread-261): 09:29:02  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:29:02.326723 (Thread-261): 09:29:02  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:29:02.331720 (Thread-261): 09:29:02  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc312700>]}
2022-02-11 09:29:02.970279 (Thread-262): handling status request
2022-02-11 09:29:02.970620 (Thread-262): 09:29:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc17bd60>]}
2022-02-11 09:29:02.971107 (Thread-262): sending response (<Response 2001 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:29:02.977164 (Thread-263): handling list request
2022-02-11 09:29:02.977391 (Thread-263): 09:29:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc17b970>]}
2022-02-11 09:29:03.003941 (Thread-263): 09:29:03  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc0bb400>]}
2022-02-11 09:29:03.004270 (Thread-263): 09:29:03  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:29:03.007090 (Thread-263): sending response (<Response 4579 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:29:03.329697 (Thread-264): handling status request
2022-02-11 09:29:03.330081 (Thread-264): 09:29:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc183a00>]}
2022-02-11 09:29:03.330553 (Thread-264): sending response (<Response 2023 bytes [200 OK]>) to 10.0.31.57
2022-02-11 09:29:03.864860 (Thread-265): handling status request
2022-02-11 09:29:03.865218 (Thread-265): 09:29:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1838b0>]}
2022-02-11 09:29:03.865763 (Thread-265): sending response (<Response 2001 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:29:03.871899 (Thread-266): handling list request
2022-02-11 09:29:03.872113 (Thread-266): 09:29:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc1832b0>]}
2022-02-11 09:29:03.875328 (Thread-267): handling status request
2022-02-11 09:29:03.875679 (Thread-267): 09:29:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58905fba00>]}
2022-02-11 09:29:03.876258 (Thread-267): sending response (<Response 2023 bytes [200 OK]>) to 10.0.44.113
2022-02-11 09:29:03.900431 (Thread-266): 09:29:03  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc0bbc10>]}
2022-02-11 09:29:03.900689 (Thread-266): 09:29:03  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:29:03.903640 (Thread-266): sending response (<Response 5904 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:29:08.973258 (Thread-268): handling status request
2022-02-11 09:29:08.973616 (Thread-268): 09:29:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc319070>]}
2022-02-11 09:29:08.974138 (Thread-268): sending response (<Response 2023 bytes [200 OK]>) to 10.0.31.57
2022-02-11 09:29:09.159951 (Thread-269): handling status request
2022-02-11 09:29:09.162506 (Thread-269): 09:29:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc130220>]}
2022-02-11 09:29:09.162996 (Thread-269): sending response (<Response 2023 bytes [200 OK]>) to 10.0.10.236
2022-02-11 09:29:09.288784 (Thread-270): handling cli_args request
2022-02-11 09:29:09.289065 (Thread-270): 09:29:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc130160>]}
2022-02-11 09:29:11.399749 (Thread-270): sending response (<Response 138 bytes [200 OK]>) to 10.0.30.21
2022-02-11 09:29:11.516903 (MainThread): 09:29:11  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:29:11.517365 (MainThread): 09:29:11  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:29:11.517902 (MainThread): 09:29:11  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:29:11.523161 (MainThread): 09:29:11  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9a1f7c7a-22f1-425b-9bfd-cb5f837c8c9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56312233a0>]}
2022-02-11 09:29:11.551189 (MainThread): 09:29:11  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9a1f7c7a-22f1-425b-9bfd-cb5f837c8c9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5631297ca0>]}
2022-02-11 09:29:11.551434 (MainThread): 09:29:11  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:29:11.552502 (MainThread): 09:29:11  
2022-02-11 09:29:11.552775 (MainThread): 09:29:11  Acquiring new bigquery connection "master"
2022-02-11 09:29:11.553678 (ThreadPoolExecutor-0_0): 09:29:11  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 09:29:11.553984 (ThreadPoolExecutor-0_0): 09:29:11  Opening a new connection, currently in state init
2022-02-11 09:29:11.742557 (Thread-271): handling poll request
2022-02-11 09:29:11.742980 (Thread-271): 09:29:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc446670>]}
2022-02-11 09:29:11.743867 (Thread-271): sending response (<Response 3791 bytes [200 OK]>) to 10.0.40.216
2022-02-11 09:29:11.876731 (ThreadPoolExecutor-1_0): 09:29:11  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 09:29:11.876928 (ThreadPoolExecutor-1_0): 09:29:11  Opening a new connection, currently in state closed
2022-02-11 09:29:12.110489 (MainThread): 09:29:12  Concurrency: 4 threads (target='default')
2022-02-11 09:29:12.110652 (MainThread): 09:29:12  
2022-02-11 09:29:12.113262 (Thread-1): 09:29:12  Began running node model.my_new_project.customer_orders
2022-02-11 09:29:12.113548 (Thread-1): 09:29:12  1 of 5 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 09:29:12.113843 (Thread-1): 09:29:12  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 09:29:12.113946 (Thread-1): 09:29:12  Began compiling node model.my_new_project.customer_orders
2022-02-11 09:29:12.114041 (Thread-1): 09:29:12  Compiling model.my_new_project.customer_orders
2022-02-11 09:29:12.118117 (Thread-1): 09:29:12  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:29:12.118342 (Thread-2): 09:29:12  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:29:12.118572 (Thread-2): 09:29:12  2 of 5 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 09:29:12.118821 (Thread-2): 09:29:12  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:29:12.118907 (Thread-2): 09:29:12  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:29:12.118987 (Thread-2): 09:29:12  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:29:12.121021 (Thread-2): 09:29:12  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:29:12.121269 (Thread-3): 09:29:12  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:29:12.121486 (Thread-3): 09:29:12  3 of 5 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 09:29:12.121758 (Thread-3): 09:29:12  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:29:12.121849 (Thread-3): 09:29:12  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:29:12.121929 (Thread-3): 09:29:12  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:29:12.124004 (Thread-3): 09:29:12  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:29:12.124296 (Thread-4): 09:29:12  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 09:29:12.124618 (Thread-4): 09:29:12  4 of 5 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 09:29:12.124985 (Thread-4): 09:29:12  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 09:29:12.125126 (Thread-4): 09:29:12  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 09:29:12.125256 (Thread-4): 09:29:12  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 09:29:12.127856 (Thread-4): 09:29:12  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:29:12.139961 (Thread-1): 09:29:12  finished collecting timing info
2022-02-11 09:29:12.140176 (Thread-1): 09:29:12  Began executing node model.my_new_project.customer_orders
2022-02-11 09:29:12.169016 (Thread-1): 09:29:12  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:29:12.169501 (Thread-2): 09:29:12  finished collecting timing info
2022-02-11 09:29:12.169659 (Thread-2): 09:29:12  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:29:12.171689 (Thread-2): 09:29:12  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:29:12.177265 (Thread-4): 09:29:12  finished collecting timing info
2022-02-11 09:29:12.177416 (Thread-4): 09:29:12  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 09:29:12.179374 (Thread-4): 09:29:12  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:29:12.179675 (Thread-3): 09:29:12  finished collecting timing info
2022-02-11 09:29:12.179812 (Thread-3): 09:29:12  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:29:12.181849 (Thread-3): 09:29:12  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:29:12.190920 (Thread-1): 09:29:12  Opening a new connection, currently in state closed
2022-02-11 09:29:12.195310 (Thread-1): 09:29:12  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 09:29:12.202568 (Thread-2): 09:29:12  Opening a new connection, currently in state init
2022-02-11 09:29:12.206858 (Thread-2): 09:29:12  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 09:29:12.207826 (Thread-3): 09:29:12  Opening a new connection, currently in state init
2022-02-11 09:29:12.209552 (Thread-4): 09:29:12  Opening a new connection, currently in state init
2022-02-11 09:29:12.212218 (Thread-3): 09:29:12  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`orders`

),

transformed as (

    select 

        id as order_id,
        user_id as customer_id,
        order_date,
        status as order_status,
        row number() over (
            partition  by user_id
            order by order_date, id
        ) as user_order_id

    from source

)

select * from transformed;


2022-02-11 09:29:12.214142 (Thread-4): 09:29:12  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 09:29:12.550567 (Thread-3): 09:29:12  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got "(" at [22:19]')
2022-02-11 09:29:13.113652 (Thread-4): 09:29:13  finished collecting timing info
2022-02-11 09:29:13.114100 (Thread-4): 09:29:13  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a1f7c7a-22f1-425b-9bfd-cb5f837c8c9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f563008dd00>]}
2022-02-11 09:29:13.114578 (Thread-4): 09:29:13  4 of 5 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 0.99s]
2022-02-11 09:29:13.116106 (Thread-272): handling poll request
2022-02-11 09:29:13.114699 (Thread-4): 09:29:13  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 09:29:13.116576 (Thread-272): 09:29:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc320b50>]}
2022-02-11 09:29:13.117862 (Thread-272): sending response (<Response 26503 bytes [200 OK]>) to 10.0.38.212
2022-02-11 09:29:13.219414 (Thread-1): 09:29:13  finished collecting timing info
2022-02-11 09:29:13.219914 (Thread-1): 09:29:13  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a1f7c7a-22f1-425b-9bfd-cb5f837c8c9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56300e5bb0>]}
2022-02-11 09:29:13.220228 (Thread-1): 09:29:13  1 of 5 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.11s]
2022-02-11 09:29:13.220337 (Thread-1): 09:29:13  Finished running node model.my_new_project.customer_orders
2022-02-11 09:29:13.248043 (Thread-2): 09:29:13  finished collecting timing info
2022-02-11 09:29:13.248374 (Thread-2): 09:29:13  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a1f7c7a-22f1-425b-9bfd-cb5f837c8c9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f563004a3a0>]}
2022-02-11 09:29:13.248753 (Thread-2): 09:29:13  2 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 1.13s]
2022-02-11 09:29:13.248865 (Thread-2): 09:29:13  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:29:13.488219 (Thread-3): 09:29:13  finished collecting timing info
2022-02-11 09:29:13.488657 (Thread-3): 09:29:13  Database Error in model stg_jaffle_shop__orders (models/staging/jaffle_shop/stg_jaffle_shop__orders.sql)
  Syntax error: Expected ")" but got "(" at [22:19]
  compiled SQL at target/run/my_new_project/models/staging/jaffle_shop/stg_jaffle_shop__orders.sql
2022-02-11 09:29:13.488849 (Thread-3): 09:29:13  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a1f7c7a-22f1-425b-9bfd-cb5f837c8c9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56300cd100>]}
2022-02-11 09:29:13.489177 (Thread-3): 09:29:13  3 of 5 ERROR creating view model dbt_luisscabral.stg_jaffle_shop__orders........ [ERROR in 1.37s]
2022-02-11 09:29:13.489289 (Thread-3): 09:29:13  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:29:13.490246 (Thread-4): 09:29:13  Began running node model.my_new_project.fct_customers_orders
2022-02-11 09:29:13.490421 (Thread-4): 09:29:13  5 of 5 SKIP relation dbt_luisscabral.fct_customers_orders....................... [SKIP]
2022-02-11 09:29:13.490524 (Thread-4): 09:29:13  Finished running node model.my_new_project.fct_customers_orders
2022-02-11 09:29:13.491917 (MainThread): 09:29:13  Acquiring new bigquery connection "master"
2022-02-11 09:29:13.492274 (MainThread): 09:29:13  
2022-02-11 09:29:13.492372 (MainThread): 09:29:13  Finished running 5 view models in 1.94s.
2022-02-11 09:29:13.492456 (MainThread): 09:29:13  Connection 'master' was properly closed.
2022-02-11 09:29:13.492523 (MainThread): 09:29:13  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 09:29:13.492587 (MainThread): 09:29:13  Connection 'model.my_new_project.stg_jaffle_shop__customers' was properly closed.
2022-02-11 09:29:13.492648 (MainThread): 09:29:13  Connection 'model.my_new_project.stg_jaffle_shop__orders' was properly closed.
2022-02-11 09:29:13.492708 (MainThread): 09:29:13  Connection 'model.my_new_project.stg_stripe__payments' was properly closed.
2022-02-11 09:29:13.568310 (MainThread): 09:29:13  
2022-02-11 09:29:13.568509 (MainThread): 09:29:13  Completed with 1 error and 0 warnings:
2022-02-11 09:29:13.568599 (MainThread): 09:29:13  
2022-02-11 09:29:13.568688 (MainThread): 09:29:13  Database Error in model stg_jaffle_shop__orders (models/staging/jaffle_shop/stg_jaffle_shop__orders.sql)
2022-02-11 09:29:13.568766 (MainThread): 09:29:13    Syntax error: Expected ")" but got "(" at [22:19]
2022-02-11 09:29:13.568835 (MainThread): 09:29:13    compiled SQL at target/run/my_new_project/models/staging/jaffle_shop/stg_jaffle_shop__orders.sql
2022-02-11 09:29:13.568918 (MainThread): 09:29:13  
2022-02-11 09:29:13.569000 (MainThread): 09:29:13  Done. PASS=3 WARN=0 ERROR=1 SKIP=1 TOTAL=5
2022-02-11 09:29:14.465642 (Thread-273): handling poll request
2022-02-11 09:29:14.465999 (Thread-273): 09:29:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc52ba60>]}
2022-02-11 09:29:14.467645 (Thread-273): sending response (<Response 34543 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:29:15.747184 (Thread-274): handling status request
2022-02-11 09:29:15.747516 (Thread-274): 09:29:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc52baf0>]}
2022-02-11 09:29:15.748021 (Thread-274): sending response (<Response 2023 bytes [200 OK]>) to 10.0.18.228
2022-02-11 09:29:15.908403 (Thread-275): handling status request
2022-02-11 09:29:15.908703 (Thread-275): 09:29:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc526430>]}
2022-02-11 09:29:15.909163 (Thread-275): sending response (<Response 2023 bytes [200 OK]>) to 10.0.13.131
2022-02-11 09:29:15.951726 (Thread-276): handling status request
2022-02-11 09:29:15.951961 (Thread-276): 09:29:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc526970>]}
2022-02-11 09:29:15.952357 (Thread-276): sending response (<Response 2001 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:29:15.958854 (Thread-277): handling list request
2022-02-11 09:29:15.959060 (Thread-277): 09:29:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc526790>]}
2022-02-11 09:29:15.990094 (Thread-277): 09:29:15  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc5269d0>]}
2022-02-11 09:29:15.990359 (Thread-277): 09:29:15  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:29:15.993003 (Thread-277): sending response (<Response 4579 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:29:37.194859 (Thread-278): handling status request
2022-02-11 09:29:37.197549 (Thread-278): 09:29:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc52bdc0>]}
2022-02-11 09:29:37.220097 (Thread-278): sending response (<Response 2001 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:29:37.225482 (Thread-279): handling list request
2022-02-11 09:29:37.225739 (Thread-279): 09:29:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59282ced30>]}
2022-02-11 09:29:37.258868 (Thread-279): 09:29:37  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc451430>]}
2022-02-11 09:29:37.259124 (Thread-279): 09:29:37  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:29:37.261338 (Thread-279): sending response (<Response 2770 bytes [200 OK]>) to 10.0.32.67
2022-02-11 09:29:55.573518 (Thread-280): handling status request
2022-02-11 09:29:55.573879 (Thread-280): 09:29:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc3120d0>]}
2022-02-11 09:29:55.574374 (Thread-280): sending response (<Response 2023 bytes [200 OK]>) to 10.0.20.79
2022-02-11 09:29:55.894773 (Thread-281): handling compile_sql request
2022-02-11 09:29:55.895096 (Thread-281): 09:29:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc526040>]}
2022-02-11 09:29:57.992979 (Thread-281): sending response (<Response 138 bytes [200 OK]>) to 10.0.46.184
2022-02-11 09:29:58.017970 (MainThread): 09:29:58  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f453c0e9-c746-4b12-94a6-b07662d70d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e402f7dc0>]}
2022-02-11 09:29:58.018496 (MainThread): 09:29:58  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:29:58.019028 (Thread-1): 09:29:58  Acquiring new bigquery connection "rpc.my_new_project.request"
2022-02-11 09:29:58.019251 (Thread-1): 09:29:58  Began compiling node rpc.my_new_project.request
2022-02-11 09:29:58.019353 (Thread-1): 09:29:58  Compiling rpc.my_new_project.request
2022-02-11 09:29:58.021447 (Thread-1): 09:29:58  finished collecting timing info
2022-02-11 09:29:58.021598 (Thread-1): 09:29:58  Began executing node rpc.my_new_project.request
2022-02-11 09:29:58.021699 (Thread-1): 09:29:58  finished collecting timing info
2022-02-11 09:29:58.327082 (Thread-282): handling poll request
2022-02-11 09:29:58.327496 (Thread-282): 09:29:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6b81f0>]}
2022-02-11 09:29:58.328685 (Thread-282): sending response (<Response 6956 bytes [200 OK]>) to 10.0.5.75
2022-02-11 09:31:43.799808 (Thread-283): 09:31:43  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:31:43.802408 (Thread-283): 09:31:43  Partial parsing: updated file: my_new_project://models/staging/jaffle_shop/stg_jaffle_shop__orders.sql
2022-02-11 09:31:43.806803 (Thread-283): 09:31:43  1699: static parser successfully parsed staging/jaffle_shop/stg_jaffle_shop__orders.sql
2022-02-11 09:31:43.874401 (Thread-283): 09:31:43  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:31:43.879710 (Thread-283): 09:31:43  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc46c580>]}
2022-02-11 09:31:44.549922 (Thread-284): handling status request
2022-02-11 09:31:44.550275 (Thread-284): 09:31:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6c2fd0>]}
2022-02-11 09:31:44.550803 (Thread-284): sending response (<Response 2057 bytes [200 OK]>) to 10.0.44.113
2022-02-11 09:31:45.266487 (Thread-285): handling status request
2022-02-11 09:31:45.266816 (Thread-285): 09:31:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6c2970>]}
2022-02-11 09:31:45.267289 (Thread-285): sending response (<Response 2057 bytes [200 OK]>) to 10.0.38.212
2022-02-11 09:31:46.700734 (Thread-286): handling status request
2022-02-11 09:31:46.701058 (Thread-286): 09:31:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6c2490>]}
2022-02-11 09:31:46.701536 (Thread-286): sending response (<Response 2057 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:31:47.040769 (Thread-287): handling status request
2022-02-11 09:31:47.041122 (Thread-287): 09:31:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6c20d0>]}
2022-02-11 09:31:47.041619 (Thread-287): sending response (<Response 2057 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:31:47.218223 (Thread-288): handling cli_args request
2022-02-11 09:31:47.218558 (Thread-288): 09:31:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6c2640>]}
2022-02-11 09:31:49.351367 (Thread-288): sending response (<Response 138 bytes [200 OK]>) to 10.0.19.158
2022-02-11 09:31:49.464108 (MainThread): 09:31:49  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:31:49.464601 (MainThread): 09:31:49  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:31:49.465163 (MainThread): 09:31:49  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:31:49.470758 (MainThread): 09:31:49  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c295d113-170c-4e99-b63d-f3a38a22b46c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3216a8460>]}
2022-02-11 09:31:49.497914 (MainThread): 09:31:49  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c295d113-170c-4e99-b63d-f3a38a22b46c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd321719d30>]}
2022-02-11 09:31:49.498183 (MainThread): 09:31:49  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:31:49.499352 (MainThread): 09:31:49  
2022-02-11 09:31:49.499670 (MainThread): 09:31:49  Acquiring new bigquery connection "master"
2022-02-11 09:31:49.500659 (ThreadPoolExecutor-0_0): 09:31:49  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 09:31:49.500968 (ThreadPoolExecutor-0_0): 09:31:49  Opening a new connection, currently in state init
2022-02-11 09:31:49.686525 (Thread-289): handling poll request
2022-02-11 09:31:49.686926 (Thread-289): 09:31:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592009c4c0>]}
2022-02-11 09:31:49.687833 (Thread-289): sending response (<Response 3791 bytes [200 OK]>) to 10.0.44.113
2022-02-11 09:31:49.791426 (ThreadPoolExecutor-1_0): 09:31:49  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 09:31:49.791597 (ThreadPoolExecutor-1_0): 09:31:49  Opening a new connection, currently in state closed
2022-02-11 09:31:50.007392 (MainThread): 09:31:50  Concurrency: 4 threads (target='default')
2022-02-11 09:31:50.007561 (MainThread): 09:31:50  
2022-02-11 09:31:50.010271 (Thread-1): 09:31:50  Began running node model.my_new_project.customer_orders
2022-02-11 09:31:50.010559 (Thread-1): 09:31:50  1 of 5 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 09:31:50.010820 (Thread-1): 09:31:50  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 09:31:50.010917 (Thread-1): 09:31:50  Began compiling node model.my_new_project.customer_orders
2022-02-11 09:31:50.011014 (Thread-1): 09:31:50  Compiling model.my_new_project.customer_orders
2022-02-11 09:31:50.015064 (Thread-1): 09:31:50  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:31:50.015316 (Thread-2): 09:31:50  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:31:50.015558 (Thread-2): 09:31:50  2 of 5 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 09:31:50.015813 (Thread-2): 09:31:50  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:31:50.015900 (Thread-2): 09:31:50  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:31:50.015980 (Thread-2): 09:31:50  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:31:50.018080 (Thread-2): 09:31:50  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:31:50.018342 (Thread-3): 09:31:50  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:31:50.018568 (Thread-3): 09:31:50  3 of 5 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 09:31:50.018815 (Thread-3): 09:31:50  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:31:50.018899 (Thread-3): 09:31:50  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:31:50.018978 (Thread-3): 09:31:50  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:31:50.021046 (Thread-3): 09:31:50  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:31:50.021294 (Thread-4): 09:31:50  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 09:31:50.021509 (Thread-4): 09:31:50  4 of 5 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 09:31:50.021783 (Thread-4): 09:31:50  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 09:31:50.021872 (Thread-4): 09:31:50  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 09:31:50.021951 (Thread-4): 09:31:50  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 09:31:50.024066 (Thread-4): 09:31:50  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:31:50.033868 (Thread-1): 09:31:50  finished collecting timing info
2022-02-11 09:31:50.034005 (Thread-1): 09:31:50  Began executing node model.my_new_project.customer_orders
2022-02-11 09:31:50.039252 (Thread-2): 09:31:50  finished collecting timing info
2022-02-11 09:31:50.039428 (Thread-2): 09:31:50  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:31:50.054968 (Thread-3): 09:31:50  finished collecting timing info
2022-02-11 09:31:50.055107 (Thread-3): 09:31:50  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:31:50.079552 (Thread-3): 09:31:50  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:31:50.080410 (Thread-2): 09:31:50  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:31:50.083388 (Thread-1): 09:31:50  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:31:50.086753 (Thread-4): 09:31:50  finished collecting timing info
2022-02-11 09:31:50.086899 (Thread-4): 09:31:50  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 09:31:50.088783 (Thread-4): 09:31:50  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:31:50.102458 (Thread-3): 09:31:50  Opening a new connection, currently in state init
2022-02-11 09:31:50.102722 (Thread-1): 09:31:50  Opening a new connection, currently in state closed
2022-02-11 09:31:50.102998 (Thread-2): 09:31:50  Opening a new connection, currently in state init
2022-02-11 09:31:50.104374 (Thread-4): 09:31:50  Opening a new connection, currently in state init
2022-02-11 09:31:50.107599 (Thread-3): 09:31:50  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`orders`

),

transformed as (

    select 

        id as order_id,
        user_id as customer_id,
        order_date,
        status as order_status,
        row_number() over (
            partition  by user_id
            order by order_date, id
        ) as user_order_seq

    from source

)

select * from transformed;


2022-02-11 09:31:50.108673 (Thread-1): 09:31:50  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 09:31:50.109646 (Thread-4): 09:31:50  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 09:31:50.111834 (Thread-2): 09:31:50  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 09:31:50.964203 (Thread-4): 09:31:50  finished collecting timing info
2022-02-11 09:31:50.964626 (Thread-4): 09:31:50  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c295d113-170c-4e99-b63d-f3a38a22b46c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3204e47f0>]}
2022-02-11 09:31:50.965102 (Thread-4): 09:31:50  4 of 5 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 0.94s]
2022-02-11 09:31:50.965224 (Thread-4): 09:31:50  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 09:31:51.013835 (Thread-290): handling poll request
2022-02-11 09:31:51.014142 (Thread-290): 09:31:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc45f5e0>]}
2022-02-11 09:31:51.015337 (Thread-290): sending response (<Response 26083 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:31:51.079460 (Thread-1): 09:31:51  finished collecting timing info
2022-02-11 09:31:51.080067 (Thread-1): 09:31:51  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c295d113-170c-4e99-b63d-f3a38a22b46c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd32056c460>]}
2022-02-11 09:31:51.080587 (Thread-1): 09:31:51  1 of 5 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.07s]
2022-02-11 09:31:51.080723 (Thread-1): 09:31:51  Finished running node model.my_new_project.customer_orders
2022-02-11 09:31:51.099768 (Thread-3): 09:31:51  finished collecting timing info
2022-02-11 09:31:51.100155 (Thread-3): 09:31:51  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c295d113-170c-4e99-b63d-f3a38a22b46c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd320523f40>]}
2022-02-11 09:31:51.100622 (Thread-3): 09:31:51  3 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 1.08s]
2022-02-11 09:31:51.100736 (Thread-3): 09:31:51  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:31:51.145767 (Thread-2): 09:31:51  finished collecting timing info
2022-02-11 09:31:51.146179 (Thread-2): 09:31:51  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c295d113-170c-4e99-b63d-f3a38a22b46c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3205462e0>]}
2022-02-11 09:31:51.146635 (Thread-2): 09:31:51  2 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 1.13s]
2022-02-11 09:31:51.146755 (Thread-2): 09:31:51  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:31:51.147591 (Thread-4): 09:31:51  Began running node model.my_new_project.fct_customers_orders
2022-02-11 09:31:51.147865 (Thread-4): 09:31:51  5 of 5 START view model dbt_luisscabral.fct_customers_orders.................... [RUN]
2022-02-11 09:31:51.148120 (Thread-4): 09:31:51  Acquiring new bigquery connection "model.my_new_project.fct_customers_orders"
2022-02-11 09:31:51.148212 (Thread-4): 09:31:51  Began compiling node model.my_new_project.fct_customers_orders
2022-02-11 09:31:51.148299 (Thread-4): 09:31:51  Compiling model.my_new_project.fct_customers_orders
2022-02-11 09:31:51.152123 (Thread-4): 09:31:51  Writing injected SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:31:51.168491 (Thread-4): 09:31:51  finished collecting timing info
2022-02-11 09:31:51.168647 (Thread-4): 09:31:51  Began executing node model.my_new_project.fct_customers_orders
2022-02-11 09:31:51.170743 (Thread-4): 09:31:51  Writing runtime SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:31:51.187032 (Thread-4): 09:31:51  Opening a new connection, currently in state closed
2022-02-11 09:31:51.191501 (Thread-4): 09:31:51  On model.my_new_project.fct_customers_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customers_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customers_orders`
  OPTIONS()
  as with

-- Import CTEs
base_customers as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`

),

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`

),

customer_order_history as (

    select 

        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname,
        min(order_date) as first_order_date,

        min(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as first_non_returned_order_date,

        max(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as most_recent_non_returned_order_date,

        coalesce(max(user_order_seq),0) as order_count,

        coalesce(count(case 
            when orders.order_status != 'returned' 
            then 1 end),
            0
        ) as non_returned_order_count,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then round(payments.amount/100.0,2) 
            else 0 
        end) as total_lifetime_value,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then round(payments.amount/100.0,2) 
            else 0 
        end)
        / nullif(count(case 
            when orders.order_status not in ('returned','return_pending') 
            then 1 end),
            0
        ) as avg_non_returned_order_value,

        array_agg(distinct orders.order_id) as order_ids

    from orders

    join customers
    on orders.customer_id = customers.id

    left outer join payments as payments
    on orders.order_id = payments.order_id

    where orders.order_status not in ('pending') and payments.payment_status != 'fail'

    group by 
        customers.full_name,
        customers.surname,
        customers.givenname,

),

-- Final CTEs 
final as (

    select 

        ordersorder_id,
        orderscustomer_id,
        surname,
        givenname,
        first_order_date,
        order_count,
        total_lifetime_value,
        payment_amount as order_value_dollars,
        orders.order_status as order_status,
        payments.payment_status as payment_status

    from orders

    join customers
    on orders.customer_id = customers.id

    join customer_order_history
    on orders.customer_id = customer_order_history.customer_id

    left outer join payments
    on orders.order_id = payments.order_id

    where payments.payment_status != 'fail'

)

-- Simple Select Statement
select * from final;


2022-02-11 09:31:51.580613 (Thread-4): 09:31:51  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected ")" at [89:1]')
2022-02-11 09:31:52.393508 (Thread-291): handling poll request
2022-02-11 09:31:52.393857 (Thread-291): 09:31:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc051460>]}
2022-02-11 09:31:52.394609 (Thread-291): sending response (<Response 13941 bytes [200 OK]>) to 10.0.46.69
2022-02-11 09:31:52.738972 (Thread-4): 09:31:52  finished collecting timing info
2022-02-11 09:31:52.739548 (Thread-4): 09:31:52  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
  Syntax error: Unexpected ")" at [89:1]
  compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:31:52.739812 (Thread-4): 09:31:52  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c295d113-170c-4e99-b63d-f3a38a22b46c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd320501070>]}
2022-02-11 09:31:52.740236 (Thread-4): 09:31:52  5 of 5 ERROR creating view model dbt_luisscabral.fct_customers_orders........... [ERROR in 1.59s]
2022-02-11 09:31:52.740390 (Thread-4): 09:31:52  Finished running node model.my_new_project.fct_customers_orders
2022-02-11 09:31:52.744975 (MainThread): 09:31:52  Acquiring new bigquery connection "master"
2022-02-11 09:31:52.745309 (MainThread): 09:31:52  
2022-02-11 09:31:52.745409 (MainThread): 09:31:52  Finished running 5 view models in 3.25s.
2022-02-11 09:31:52.745495 (MainThread): 09:31:52  Connection 'master' was properly closed.
2022-02-11 09:31:52.745566 (MainThread): 09:31:52  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 09:31:52.745635 (MainThread): 09:31:52  Connection 'model.my_new_project.stg_jaffle_shop__customers' was properly closed.
2022-02-11 09:31:52.745701 (MainThread): 09:31:52  Connection 'model.my_new_project.stg_jaffle_shop__orders' was properly closed.
2022-02-11 09:31:52.745797 (MainThread): 09:31:52  Connection 'model.my_new_project.fct_customers_orders' was properly closed.
2022-02-11 09:31:52.802149 (MainThread): 09:31:52  
2022-02-11 09:31:52.802330 (MainThread): 09:31:52  Completed with 1 error and 0 warnings:
2022-02-11 09:31:52.802422 (MainThread): 09:31:52  
2022-02-11 09:31:52.802514 (MainThread): 09:31:52  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
2022-02-11 09:31:52.802594 (MainThread): 09:31:52    Syntax error: Unexpected ")" at [89:1]
2022-02-11 09:31:52.802666 (MainThread): 09:31:52    compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:31:52.802750 (MainThread): 09:31:52  
2022-02-11 09:31:52.802835 (MainThread): 09:31:52  Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
2022-02-11 09:31:53.720202 (Thread-292): handling poll request
2022-02-11 09:31:53.720813 (Thread-292): 09:31:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc051730>]}
2022-02-11 09:31:53.722179 (Thread-292): sending response (<Response 32488 bytes [200 OK]>) to 10.0.46.69
2022-02-11 09:31:54.604206 (Thread-293): handling status request
2022-02-11 09:31:54.604531 (Thread-293): 09:31:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc466b50>]}
2022-02-11 09:31:54.605046 (Thread-293): sending response (<Response 2057 bytes [200 OK]>) to 10.0.11.229
2022-02-11 09:31:54.747258 (Thread-294): handling status request
2022-02-11 09:31:54.747586 (Thread-294): 09:31:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc455be0>]}
2022-02-11 09:31:54.748066 (Thread-294): sending response (<Response 2057 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:32:10.162067 (Thread-295): handling status request
2022-02-11 09:32:10.162446 (Thread-295): 09:32:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc051a30>]}
2022-02-11 09:32:10.162930 (Thread-295): sending response (<Response 2057 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:32:10.494610 (Thread-296): handling compile_sql request
2022-02-11 09:32:10.494942 (Thread-296): 09:32:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc455220>]}
2022-02-11 09:32:12.689811 (Thread-296): sending response (<Response 138 bytes [200 OK]>) to 10.0.19.158
2022-02-11 09:32:12.716528 (MainThread): 09:32:12  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bd73e623-746f-475e-af3e-019e7bc4645f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8fa7bdcd60>]}
2022-02-11 09:32:12.717100 (MainThread): 09:32:12  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:32:12.717697 (Thread-1): 09:32:12  Acquiring new bigquery connection "rpc.my_new_project.request"
2022-02-11 09:32:12.717958 (Thread-1): 09:32:12  Began compiling node rpc.my_new_project.request
2022-02-11 09:32:12.718052 (Thread-1): 09:32:12  Compiling rpc.my_new_project.request
2022-02-11 09:32:12.720637 (Thread-1): 09:32:12  finished collecting timing info
2022-02-11 09:32:12.720762 (Thread-1): 09:32:12  Began executing node rpc.my_new_project.request
2022-02-11 09:32:12.720859 (Thread-1): 09:32:12  finished collecting timing info
2022-02-11 09:32:13.024423 (Thread-297): handling poll request
2022-02-11 09:32:13.024824 (Thread-297): 09:32:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f592f6e5c70>]}
2022-02-11 09:32:13.026078 (Thread-297): sending response (<Response 17133 bytes [200 OK]>) to 10.0.18.228
2022-02-11 09:32:35.702338 (Thread-298): 09:32:35  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:32:35.702738 (Thread-298): 09:32:35  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:32:35.707106 (Thread-298): 09:32:35  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:32:35.751317 (Thread-298): 09:32:35  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:32:35.756306 (Thread-298): 09:32:35  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc0e77f0>]}
2022-02-11 09:32:36.557407 (Thread-299): handling status request
2022-02-11 09:32:36.557781 (Thread-299): 09:32:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc3ef640>]}
2022-02-11 09:32:36.558310 (Thread-299): sending response (<Response 2023 bytes [200 OK]>) to 10.0.46.184
2022-02-11 09:32:36.566570 (Thread-300): handling status request
2022-02-11 09:32:36.566804 (Thread-300): 09:32:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc3efc70>]}
2022-02-11 09:32:36.567180 (Thread-300): sending response (<Response 2023 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:32:42.372610 (Thread-301): handling status request
2022-02-11 09:32:42.372951 (Thread-301): 09:32:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc3efe20>]}
2022-02-11 09:32:42.373428 (Thread-301): sending response (<Response 2023 bytes [200 OK]>) to 10.0.46.69
2022-02-11 09:32:42.626583 (Thread-302): handling status request
2022-02-11 09:32:42.626920 (Thread-302): 09:32:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc3effd0>]}
2022-02-11 09:32:42.627411 (Thread-302): sending response (<Response 2023 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:32:42.657108 (Thread-303): handling cli_args request
2022-02-11 09:32:42.657338 (Thread-303): 09:32:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc3ef220>]}
2022-02-11 09:32:44.802780 (Thread-303): sending response (<Response 138 bytes [200 OK]>) to 10.0.3.5
2022-02-11 09:32:44.930479 (MainThread): 09:32:44  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:32:44.930961 (MainThread): 09:32:44  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:32:44.931519 (MainThread): 09:32:44  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:32:44.937101 (MainThread): 09:32:44  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '95b48dbf-4745-4fac-a7f8-e85ffa1d5f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc7b295f430>]}
2022-02-11 09:32:44.967687 (MainThread): 09:32:44  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '95b48dbf-4745-4fac-a7f8-e85ffa1d5f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc7b29d0d00>]}
2022-02-11 09:32:44.967950 (MainThread): 09:32:44  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:32:44.969222 (MainThread): 09:32:44  
2022-02-11 09:32:44.969517 (MainThread): 09:32:44  Acquiring new bigquery connection "master"
2022-02-11 09:32:44.970617 (ThreadPoolExecutor-0_0): 09:32:44  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 09:32:44.970914 (ThreadPoolExecutor-0_0): 09:32:44  Opening a new connection, currently in state init
2022-02-11 09:32:45.224602 (Thread-304): handling poll request
2022-02-11 09:32:45.225056 (Thread-304): 09:32:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58ccfa8f10>]}
2022-02-11 09:32:45.226093 (Thread-304): sending response (<Response 3791 bytes [200 OK]>) to 10.0.13.131
2022-02-11 09:32:45.311557 (ThreadPoolExecutor-1_0): 09:32:45  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 09:32:45.311742 (ThreadPoolExecutor-1_0): 09:32:45  Opening a new connection, currently in state closed
2022-02-11 09:32:45.590551 (MainThread): 09:32:45  Concurrency: 4 threads (target='default')
2022-02-11 09:32:45.590716 (MainThread): 09:32:45  
2022-02-11 09:32:45.593438 (Thread-1): 09:32:45  Began running node model.my_new_project.customer_orders
2022-02-11 09:32:45.593765 (Thread-1): 09:32:45  1 of 5 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 09:32:45.594048 (Thread-1): 09:32:45  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 09:32:45.594151 (Thread-1): 09:32:45  Began compiling node model.my_new_project.customer_orders
2022-02-11 09:32:45.594247 (Thread-1): 09:32:45  Compiling model.my_new_project.customer_orders
2022-02-11 09:32:45.598501 (Thread-2): 09:32:45  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:32:45.598731 (Thread-2): 09:32:45  2 of 5 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 09:32:45.598984 (Thread-2): 09:32:45  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:32:45.599072 (Thread-2): 09:32:45  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:32:45.599155 (Thread-2): 09:32:45  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:32:45.601246 (Thread-2): 09:32:45  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:32:45.598319 (Thread-1): 09:32:45  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:32:45.601569 (Thread-3): 09:32:45  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:32:45.601836 (Thread-3): 09:32:45  3 of 5 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 09:32:45.602092 (Thread-3): 09:32:45  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:32:45.602210 (Thread-3): 09:32:45  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:32:45.602291 (Thread-3): 09:32:45  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:32:45.604475 (Thread-3): 09:32:45  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:32:45.604735 (Thread-4): 09:32:45  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 09:32:45.604948 (Thread-4): 09:32:45  4 of 5 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 09:32:45.605190 (Thread-4): 09:32:45  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 09:32:45.605275 (Thread-4): 09:32:45  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 09:32:45.605354 (Thread-4): 09:32:45  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 09:32:45.607421 (Thread-4): 09:32:45  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:32:45.622131 (Thread-2): 09:32:45  finished collecting timing info
2022-02-11 09:32:45.622285 (Thread-2): 09:32:45  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:32:45.627495 (Thread-3): 09:32:45  finished collecting timing info
2022-02-11 09:32:45.627651 (Thread-3): 09:32:45  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:32:45.632617 (Thread-4): 09:32:45  finished collecting timing info
2022-02-11 09:32:45.632744 (Thread-4): 09:32:45  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 09:32:45.643119 (Thread-1): 09:32:45  finished collecting timing info
2022-02-11 09:32:45.643252 (Thread-1): 09:32:45  Began executing node model.my_new_project.customer_orders
2022-02-11 09:32:45.685021 (Thread-3): 09:32:45  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:32:45.686229 (Thread-1): 09:32:45  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:32:45.689867 (Thread-2): 09:32:45  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:32:45.690282 (Thread-4): 09:32:45  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:32:45.707374 (Thread-4): 09:32:45  Opening a new connection, currently in state init
2022-02-11 09:32:45.707631 (Thread-2): 09:32:45  Opening a new connection, currently in state init
2022-02-11 09:32:45.707897 (Thread-1): 09:32:45  Opening a new connection, currently in state closed
2022-02-11 09:32:45.711921 (Thread-3): 09:32:45  Opening a new connection, currently in state init
2022-02-11 09:32:45.712338 (Thread-2): 09:32:45  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 09:32:45.712685 (Thread-4): 09:32:45  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 09:32:45.714179 (Thread-1): 09:32:45  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 09:32:45.717633 (Thread-3): 09:32:45  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`orders`

),

transformed as (

    select 

        id as order_id,
        user_id as customer_id,
        order_date,
        status as order_status,
        row_number() over (
            partition  by user_id
            order by order_date, id
        ) as user_order_seq

    from source

)

select * from transformed;


2022-02-11 09:32:46.560375 (Thread-305): handling poll request
2022-02-11 09:32:46.560712 (Thread-305): 09:32:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58903fe0a0>]}
2022-02-11 09:32:46.561818 (Thread-305): sending response (<Response 24256 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:32:46.665808 (Thread-1): 09:32:46  finished collecting timing info
2022-02-11 09:32:46.666243 (Thread-1): 09:32:46  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95b48dbf-4745-4fac-a7f8-e85ffa1d5f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc79a7fc700>]}
2022-02-11 09:32:46.666583 (Thread-1): 09:32:46  1 of 5 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.07s]
2022-02-11 09:32:46.666703 (Thread-1): 09:32:46  Finished running node model.my_new_project.customer_orders
2022-02-11 09:32:46.676450 (Thread-3): 09:32:46  finished collecting timing info
2022-02-11 09:32:46.676802 (Thread-3): 09:32:46  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95b48dbf-4745-4fac-a7f8-e85ffa1d5f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc79a7f2a90>]}
2022-02-11 09:32:46.677098 (Thread-3): 09:32:46  3 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 1.07s]
2022-02-11 09:32:46.677208 (Thread-3): 09:32:46  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:32:46.732964 (Thread-2): 09:32:46  finished collecting timing info
2022-02-11 09:32:46.733313 (Thread-2): 09:32:46  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95b48dbf-4745-4fac-a7f8-e85ffa1d5f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc7b1860d90>]}
2022-02-11 09:32:46.733606 (Thread-2): 09:32:46  2 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 1.13s]
2022-02-11 09:32:46.733743 (Thread-2): 09:32:46  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:32:46.763150 (Thread-4): 09:32:46  finished collecting timing info
2022-02-11 09:32:46.763479 (Thread-4): 09:32:46  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95b48dbf-4745-4fac-a7f8-e85ffa1d5f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc79a7d50d0>]}
2022-02-11 09:32:46.763767 (Thread-4): 09:32:46  4 of 5 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 1.16s]
2022-02-11 09:32:46.763875 (Thread-4): 09:32:46  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 09:32:46.764954 (Thread-1): 09:32:46  Began running node model.my_new_project.fct_customers_orders
2022-02-11 09:32:46.765184 (Thread-1): 09:32:46  5 of 5 START view model dbt_luisscabral.fct_customers_orders.................... [RUN]
2022-02-11 09:32:46.765422 (Thread-1): 09:32:46  Acquiring new bigquery connection "model.my_new_project.fct_customers_orders"
2022-02-11 09:32:46.765513 (Thread-1): 09:32:46  Began compiling node model.my_new_project.fct_customers_orders
2022-02-11 09:32:46.765598 (Thread-1): 09:32:46  Compiling model.my_new_project.fct_customers_orders
2022-02-11 09:32:46.769074 (Thread-1): 09:32:46  Writing injected SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:32:46.785060 (Thread-1): 09:32:46  finished collecting timing info
2022-02-11 09:32:46.785203 (Thread-1): 09:32:46  Began executing node model.my_new_project.fct_customers_orders
2022-02-11 09:32:46.787242 (Thread-1): 09:32:46  Writing runtime SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:32:46.803898 (Thread-1): 09:32:46  Opening a new connection, currently in state closed
2022-02-11 09:32:46.808409 (Thread-1): 09:32:46  On model.my_new_project.fct_customers_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customers_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customers_orders`
  OPTIONS()
  as with

-- Import CTEs
customers as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`

),

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`

),

customer_order_history as (

    select 

        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname,
        min(order_date) as first_order_date,

        min(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as first_non_returned_order_date,

        max(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as most_recent_non_returned_order_date,

        coalesce(max(user_order_seq),0) as order_count,

        coalesce(count(case 
            when orders.order_status != 'returned' 
            then 1 end),
            0
        ) as non_returned_order_count,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then round(payments.amount/100.0,2) 
            else 0 
        end) as total_lifetime_value,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then round(payments.amount/100.0,2) 
            else 0 
        end)
        / nullif(count(case 
            when orders.order_status not in ('returned','return_pending') 
            then 1 end),
            0
        ) as avg_non_returned_order_value,

        array_agg(distinct orders.order_id) as order_ids

    from orders

    join customers
    on orders.customer_id = customers.id

    left outer join payments as payments
    on orders.order_id = payments.order_id

    where orders.order_status not in ('pending') and payments.payment_status != 'fail'

    group by 
        customers.full_name,
        customers.surname,
        customers.givenname,

),

-- Final CTEs 
final as (

    select 

        ordersorder_id,
        orderscustomer_id,
        surname,
        givenname,
        first_order_date,
        order_count,
        total_lifetime_value,
        payment_amount as order_value_dollars,
        orders.order_status as order_status,
        payments.payment_status as payment_status

    from orders

    join customers
    on orders.customer_id = customers.id

    join customer_order_history
    on orders.customer_id = customer_order_history.customer_id

    left outer join payments
    on orders.order_id = payments.order_id

    where payments.payment_status != 'fail'

)

-- Simple Select Statement
select * from final;


2022-02-11 09:32:47.170653 (Thread-1): 09:32:47  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected ")" at [89:1]')
2022-02-11 09:32:47.870216 (Thread-306): handling poll request
2022-02-11 09:32:47.870564 (Thread-306): 09:32:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58903fedf0>]}
2022-02-11 09:32:47.871328 (Thread-306): sending response (<Response 15763 bytes [200 OK]>) to 10.0.3.5
2022-02-11 09:32:48.331199 (Thread-1): 09:32:48  finished collecting timing info
2022-02-11 09:32:48.331647 (Thread-1): 09:32:48  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
  Syntax error: Unexpected ")" at [89:1]
  compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:32:48.332030 (Thread-1): 09:32:48  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95b48dbf-4745-4fac-a7f8-e85ffa1d5f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc79a747d60>]}
2022-02-11 09:32:48.332647 (Thread-1): 09:32:48  5 of 5 ERROR creating view model dbt_luisscabral.fct_customers_orders........... [ERROR in 1.57s]
2022-02-11 09:32:48.332801 (Thread-1): 09:32:48  Finished running node model.my_new_project.fct_customers_orders
2022-02-11 09:32:48.334276 (MainThread): 09:32:48  Acquiring new bigquery connection "master"
2022-02-11 09:32:48.334591 (MainThread): 09:32:48  
2022-02-11 09:32:48.334687 (MainThread): 09:32:48  Finished running 5 view models in 3.37s.
2022-02-11 09:32:48.334769 (MainThread): 09:32:48  Connection 'master' was properly closed.
2022-02-11 09:32:48.334835 (MainThread): 09:32:48  Connection 'model.my_new_project.fct_customers_orders' was properly closed.
2022-02-11 09:32:48.334897 (MainThread): 09:32:48  Connection 'model.my_new_project.stg_jaffle_shop__customers' was properly closed.
2022-02-11 09:32:48.334960 (MainThread): 09:32:48  Connection 'model.my_new_project.stg_jaffle_shop__orders' was properly closed.
2022-02-11 09:32:48.335023 (MainThread): 09:32:48  Connection 'model.my_new_project.stg_stripe__payments' was properly closed.
2022-02-11 09:32:48.397572 (MainThread): 09:32:48  
2022-02-11 09:32:48.397773 (MainThread): 09:32:48  Completed with 1 error and 0 warnings:
2022-02-11 09:32:48.397873 (MainThread): 09:32:48  
2022-02-11 09:32:48.397977 (MainThread): 09:32:48  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
2022-02-11 09:32:48.398059 (MainThread): 09:32:48    Syntax error: Unexpected ")" at [89:1]
2022-02-11 09:32:48.398131 (MainThread): 09:32:48    compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:32:48.398214 (MainThread): 09:32:48  
2022-02-11 09:32:48.398296 (MainThread): 09:32:48  Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
2022-02-11 09:32:49.225914 (Thread-307): handling poll request
2022-02-11 09:32:49.226262 (Thread-307): 09:32:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58903fec70>]}
2022-02-11 09:32:49.251647 (Thread-307): sending response (<Response 32480 bytes [200 OK]>) to 10.0.19.158
2022-02-11 09:32:50.109169 (Thread-308): handling status request
2022-02-11 09:32:50.109508 (Thread-308): 09:32:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc0d5130>]}
2022-02-11 09:32:50.110064 (Thread-308): sending response (<Response 2023 bytes [200 OK]>) to 10.0.10.236
2022-02-11 09:32:50.392916 (Thread-309): handling status request
2022-02-11 09:32:50.393269 (Thread-309): 09:32:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58fc056070>]}
2022-02-11 09:32:50.393780 (Thread-309): sending response (<Response 2023 bytes [200 OK]>) to 10.0.30.21
2022-02-11 09:32:56.781181 (Thread-310): handling status request
2022-02-11 09:32:56.781510 (Thread-310): 09:32:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc0e75e0>]}
2022-02-11 09:32:56.782068 (Thread-310): sending response (<Response 2023 bytes [200 OK]>) to 10.0.18.228
2022-02-11 09:32:57.091265 (Thread-311): handling compile_sql request
2022-02-11 09:32:57.091600 (Thread-311): 09:32:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc0e7460>]}
2022-02-11 09:32:59.224884 (Thread-311): sending response (<Response 138 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:32:59.251600 (MainThread): 09:32:59  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7752f1ba-e8b9-482f-a76a-c5c5cdb5b3ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe7fd77c10>]}
2022-02-11 09:32:59.252154 (MainThread): 09:32:59  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:32:59.252768 (Thread-1): 09:32:59  Acquiring new bigquery connection "rpc.my_new_project.request"
2022-02-11 09:32:59.253003 (Thread-1): 09:32:59  Began compiling node rpc.my_new_project.request
2022-02-11 09:32:59.253107 (Thread-1): 09:32:59  Compiling rpc.my_new_project.request
2022-02-11 09:32:59.255762 (Thread-1): 09:32:59  finished collecting timing info
2022-02-11 09:32:59.255889 (Thread-1): 09:32:59  Began executing node rpc.my_new_project.request
2022-02-11 09:32:59.255988 (Thread-1): 09:32:59  finished collecting timing info
2022-02-11 09:32:59.518732 (Thread-312): handling poll request
2022-02-11 09:32:59.519166 (Thread-312): 09:32:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890415cd0>]}
2022-02-11 09:32:59.520409 (Thread-312): sending response (<Response 17114 bytes [200 OK]>) to 10.0.10.236
2022-02-11 09:33:30.891235 (Thread-313): 09:33:30  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:33:30.891649 (Thread-313): 09:33:30  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:33:30.896093 (Thread-313): 09:33:30  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:33:30.934561 (Thread-313): 09:33:30  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:33:30.939491 (Thread-313): 09:33:30  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904e4040>]}
2022-02-11 09:33:31.495037 (Thread-314): handling status request
2022-02-11 09:33:31.495361 (Thread-314): 09:33:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58905fa670>]}
2022-02-11 09:33:31.495876 (Thread-314): sending response (<Response 2023 bytes [200 OK]>) to 10.0.44.113
2022-02-11 09:33:31.539204 (Thread-315): handling status request
2022-02-11 09:33:31.539472 (Thread-315): 09:33:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58905faf10>]}
2022-02-11 09:33:31.539912 (Thread-315): sending response (<Response 2023 bytes [200 OK]>) to 10.0.30.21
2022-02-11 09:33:32.916343 (Thread-316): handling status request
2022-02-11 09:33:32.916842 (Thread-316): 09:33:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904e3f10>]}
2022-02-11 09:33:32.917500 (Thread-316): sending response (<Response 2023 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:33:33.240782 (Thread-317): handling cli_args request
2022-02-11 09:33:33.241137 (Thread-317): 09:33:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58905fa220>]}
2022-02-11 09:33:33.242790 (Thread-318): handling status request
2022-02-11 09:33:33.243321 (Thread-318): 09:33:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904cc1c0>]}
2022-02-11 09:33:33.243773 (Thread-318): sending response (<Response 2023 bytes [200 OK]>) to 10.0.18.228
2022-02-11 09:33:35.362679 (Thread-317): sending response (<Response 138 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:33:35.461325 (MainThread): 09:33:35  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:33:35.461822 (MainThread): 09:33:35  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:33:35.462378 (MainThread): 09:33:35  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:33:35.467717 (MainThread): 09:33:35  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '992f7723-7e40-4c07-b24a-998ab85e9a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83954f1370>]}
2022-02-11 09:33:35.495099 (MainThread): 09:33:35  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '992f7723-7e40-4c07-b24a-998ab85e9a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8395563c70>]}
2022-02-11 09:33:35.495343 (MainThread): 09:33:35  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:33:35.496426 (MainThread): 09:33:35  
2022-02-11 09:33:35.496701 (MainThread): 09:33:35  Acquiring new bigquery connection "master"
2022-02-11 09:33:35.497666 (ThreadPoolExecutor-0_0): 09:33:35  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 09:33:35.497985 (ThreadPoolExecutor-0_0): 09:33:35  Opening a new connection, currently in state init
2022-02-11 09:33:35.707827 (Thread-319): handling poll request
2022-02-11 09:33:35.708241 (Thread-319): 09:33:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904e4850>]}
2022-02-11 09:33:35.709134 (Thread-319): sending response (<Response 3791 bytes [200 OK]>) to 10.0.20.79
2022-02-11 09:33:35.819648 (ThreadPoolExecutor-1_0): 09:33:35  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 09:33:35.819830 (ThreadPoolExecutor-1_0): 09:33:35  Opening a new connection, currently in state closed
2022-02-11 09:33:36.087402 (MainThread): 09:33:36  Concurrency: 4 threads (target='default')
2022-02-11 09:33:36.087568 (MainThread): 09:33:36  
2022-02-11 09:33:36.090269 (Thread-1): 09:33:36  Began running node model.my_new_project.customer_orders
2022-02-11 09:33:36.090567 (Thread-1): 09:33:36  1 of 5 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 09:33:36.090843 (Thread-1): 09:33:36  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 09:33:36.090945 (Thread-1): 09:33:36  Began compiling node model.my_new_project.customer_orders
2022-02-11 09:33:36.091034 (Thread-1): 09:33:36  Compiling model.my_new_project.customer_orders
2022-02-11 09:33:36.095351 (Thread-2): 09:33:36  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:33:36.095595 (Thread-2): 09:33:36  2 of 5 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 09:33:36.095857 (Thread-2): 09:33:36  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:33:36.095948 (Thread-2): 09:33:36  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:33:36.096033 (Thread-2): 09:33:36  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:33:36.098179 (Thread-2): 09:33:36  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:33:36.095130 (Thread-1): 09:33:36  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:33:36.098475 (Thread-3): 09:33:36  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:33:36.098706 (Thread-3): 09:33:36  3 of 5 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 09:33:36.098965 (Thread-3): 09:33:36  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:33:36.099054 (Thread-3): 09:33:36  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:33:36.099135 (Thread-3): 09:33:36  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:33:36.101235 (Thread-3): 09:33:36  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:33:36.101495 (Thread-4): 09:33:36  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 09:33:36.101740 (Thread-4): 09:33:36  4 of 5 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 09:33:36.101998 (Thread-4): 09:33:36  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 09:33:36.102087 (Thread-4): 09:33:36  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 09:33:36.102169 (Thread-4): 09:33:36  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 09:33:36.104154 (Thread-4): 09:33:36  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:33:36.114452 (Thread-1): 09:33:36  finished collecting timing info
2022-02-11 09:33:36.114596 (Thread-1): 09:33:36  Began executing node model.my_new_project.customer_orders
2022-02-11 09:33:36.119811 (Thread-4): 09:33:36  finished collecting timing info
2022-02-11 09:33:36.119946 (Thread-4): 09:33:36  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 09:33:36.130121 (Thread-2): 09:33:36  finished collecting timing info
2022-02-11 09:33:36.130251 (Thread-2): 09:33:36  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:33:36.156416 (Thread-3): 09:33:36  finished collecting timing info
2022-02-11 09:33:36.156557 (Thread-3): 09:33:36  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:33:36.167014 (Thread-1): 09:33:36  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:33:36.167897 (Thread-3): 09:33:36  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:33:36.168708 (Thread-2): 09:33:36  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:33:36.168954 (Thread-4): 09:33:36  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:33:36.186553 (Thread-1): 09:33:36  Opening a new connection, currently in state closed
2022-02-11 09:33:36.187028 (Thread-4): 09:33:36  Opening a new connection, currently in state init
2022-02-11 09:33:36.187265 (Thread-2): 09:33:36  Opening a new connection, currently in state init
2022-02-11 09:33:36.187485 (Thread-3): 09:33:36  Opening a new connection, currently in state init
2022-02-11 09:33:36.190951 (Thread-1): 09:33:36  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 09:33:36.192198 (Thread-4): 09:33:36  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 09:33:36.192905 (Thread-3): 09:33:36  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`orders`

),

transformed as (

    select 

        id as order_id,
        user_id as customer_id,
        order_date,
        status as order_status,
        row_number() over (
            partition  by user_id
            order by order_date, id
        ) as user_order_seq

    from source

)

select * from transformed;


2022-02-11 09:33:36.193878 (Thread-2): 09:33:36  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 09:33:37.105804 (Thread-320): handling poll request
2022-02-11 09:33:37.106145 (Thread-320): 09:33:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904bd580>]}
2022-02-11 09:33:37.107264 (Thread-320): sending response (<Response 24256 bytes [200 OK]>) to 10.0.38.212
2022-02-11 09:33:37.118190 (Thread-4): 09:33:37  finished collecting timing info
2022-02-11 09:33:37.118615 (Thread-4): 09:33:37  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '992f7723-7e40-4c07-b24a-998ab85e9a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8394348c40>]}
2022-02-11 09:33:37.118964 (Thread-4): 09:33:37  4 of 5 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 1.02s]
2022-02-11 09:33:37.119082 (Thread-4): 09:33:37  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 09:33:37.138919 (Thread-1): 09:33:37  finished collecting timing info
2022-02-11 09:33:37.139322 (Thread-1): 09:33:37  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '992f7723-7e40-4c07-b24a-998ab85e9a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8394318ee0>]}
2022-02-11 09:33:37.139622 (Thread-1): 09:33:37  1 of 5 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.05s]
2022-02-11 09:33:37.139734 (Thread-1): 09:33:37  Finished running node model.my_new_project.customer_orders
2022-02-11 09:33:37.141311 (Thread-2): 09:33:37  finished collecting timing info
2022-02-11 09:33:37.141627 (Thread-2): 09:33:37  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '992f7723-7e40-4c07-b24a-998ab85e9a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8394318760>]}
2022-02-11 09:33:37.142019 (Thread-2): 09:33:37  2 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 1.05s]
2022-02-11 09:33:37.142131 (Thread-2): 09:33:37  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:33:37.146884 (Thread-3): 09:33:37  finished collecting timing info
2022-02-11 09:33:37.147207 (Thread-3): 09:33:37  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '992f7723-7e40-4c07-b24a-998ab85e9a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f839440ba60>]}
2022-02-11 09:33:37.147490 (Thread-3): 09:33:37  3 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 1.05s]
2022-02-11 09:33:37.147597 (Thread-3): 09:33:37  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:33:37.148446 (Thread-4): 09:33:37  Began running node model.my_new_project.fct_customers_orders
2022-02-11 09:33:37.148667 (Thread-4): 09:33:37  5 of 5 START view model dbt_luisscabral.fct_customers_orders.................... [RUN]
2022-02-11 09:33:37.148907 (Thread-4): 09:33:37  Acquiring new bigquery connection "model.my_new_project.fct_customers_orders"
2022-02-11 09:33:37.148999 (Thread-4): 09:33:37  Began compiling node model.my_new_project.fct_customers_orders
2022-02-11 09:33:37.149083 (Thread-4): 09:33:37  Compiling model.my_new_project.fct_customers_orders
2022-02-11 09:33:37.153145 (Thread-4): 09:33:37  Writing injected SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:33:37.169466 (Thread-4): 09:33:37  finished collecting timing info
2022-02-11 09:33:37.169599 (Thread-4): 09:33:37  Began executing node model.my_new_project.fct_customers_orders
2022-02-11 09:33:37.171526 (Thread-4): 09:33:37  Writing runtime SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:33:37.187350 (Thread-4): 09:33:37  Opening a new connection, currently in state closed
2022-02-11 09:33:37.191829 (Thread-4): 09:33:37  On model.my_new_project.fct_customers_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customers_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customers_orders`
  OPTIONS()
  as with

-- Import CTEs
customers as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`

),

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`

),

customer_order_history as (

    select 

        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname,
        min(order_date) as first_order_date,

        min(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as first_non_returned_order_date,

        max(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as most_recent_non_returned_order_date,

        coalesce(max(user_order_seq),0) as order_count,

        coalesce(count(case 
            when orders.order_status != 'returned' 
            then 1 end),
            0
        ) as non_returned_order_count,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then round(payments.amount/100.0,2) 
            else 0 
        end) as total_lifetime_value,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then round(payments.amount/100.0,2) 
            else 0 
        end)
        / nullif(count(case 
            when orders.order_status not in ('returned','return_pending') 
            then 1 end),
            0
        ) as avg_non_returned_order_value,

        array_agg(distinct orders.order_id) as order_ids

    from orders

    join customers
    on orders.customer_id = customers.id

    left outer join payments as payments
    on orders.order_id = payments.order_id

    where orders.order_status not in ('pending') and payments.payment_status != 'fail'

    group by 
        customers.full_name,
        customers.surname,
        customers.givenname

),

-- Final CTEs 
final as (

    select 

        ordersorder_id,
        orderscustomer_id,
        surname,
        givenname,
        first_order_date,
        order_count,
        total_lifetime_value,
        payment_amount as order_value_dollars,
        orders.order_status as order_status,
        payments.payment_status as payment_status

    from orders

    join customers
    on orders.customer_id = customers.id

    join customer_order_history
    on orders.customer_id = customer_order_history.customer_id

    left outer join payments
    on orders.order_id = payments.order_id

    where payments.payment_status != 'fail'

)

-- Simple Select Statement
select * from final;


2022-02-11 09:33:37.899553 (Thread-4): 09:33:37  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Name id not found inside customers at [77:39]')
2022-02-11 09:33:38.449592 (Thread-321): handling poll request
2022-02-11 09:33:38.449952 (Thread-321): 09:33:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904dcac0>]}
2022-02-11 09:33:38.450717 (Thread-321): sending response (<Response 15766 bytes [200 OK]>) to 10.0.20.79
2022-02-11 09:33:39.721806 (Thread-4): 09:33:39  finished collecting timing info
2022-02-11 09:33:39.722268 (Thread-4): 09:33:39  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
  Name id not found inside customers at [77:39]
  compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:33:39.722655 (Thread-4): 09:33:39  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '992f7723-7e40-4c07-b24a-998ab85e9a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83942e4e20>]}
2022-02-11 09:33:39.723021 (Thread-4): 09:33:39  5 of 5 ERROR creating view model dbt_luisscabral.fct_customers_orders........... [ERROR in 2.57s]
2022-02-11 09:33:39.723137 (Thread-4): 09:33:39  Finished running node model.my_new_project.fct_customers_orders
2022-02-11 09:33:39.724820 (MainThread): 09:33:39  Acquiring new bigquery connection "master"
2022-02-11 09:33:39.725160 (MainThread): 09:33:39  
2022-02-11 09:33:39.725263 (MainThread): 09:33:39  Finished running 5 view models in 4.23s.
2022-02-11 09:33:39.725347 (MainThread): 09:33:39  Connection 'master' was properly closed.
2022-02-11 09:33:39.725417 (MainThread): 09:33:39  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 09:33:39.725482 (MainThread): 09:33:39  Connection 'model.my_new_project.stg_jaffle_shop__customers' was properly closed.
2022-02-11 09:33:39.725545 (MainThread): 09:33:39  Connection 'model.my_new_project.stg_jaffle_shop__orders' was properly closed.
2022-02-11 09:33:39.725605 (MainThread): 09:33:39  Connection 'model.my_new_project.fct_customers_orders' was properly closed.
2022-02-11 09:33:39.780872 (MainThread): 09:33:39  
2022-02-11 09:33:39.782759 (Thread-322): handling poll request
2022-02-11 09:33:39.781042 (MainThread): 09:33:39  Completed with 1 error and 0 warnings:
2022-02-11 09:33:39.783277 (Thread-322): 09:33:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904db070>]}
2022-02-11 09:33:39.781133 (MainThread): 09:33:39  
2022-02-11 09:33:39.784208 (Thread-322): sending response (<Response 6510 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:33:39.781224 (MainThread): 09:33:39  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
2022-02-11 09:33:39.781300 (MainThread): 09:33:39    Name id not found inside customers at [77:39]
2022-02-11 09:33:39.781369 (MainThread): 09:33:39    compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:33:39.781452 (MainThread): 09:33:39  
2022-02-11 09:33:39.781533 (MainThread): 09:33:39  Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
2022-02-11 09:33:41.190187 (Thread-323): handling poll request
2022-02-11 09:33:41.190524 (Thread-323): 09:33:41  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc36f730>]}
2022-02-11 09:33:41.191969 (Thread-323): sending response (<Response 26264 bytes [200 OK]>) to 10.0.5.75
2022-02-11 09:33:42.531290 (Thread-324): handling status request
2022-02-11 09:33:42.531632 (Thread-324): 09:33:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904bd2b0>]}
2022-02-11 09:33:42.532163 (Thread-324): sending response (<Response 2023 bytes [200 OK]>) to 10.0.46.184
2022-02-11 09:33:42.580837 (Thread-325): handling status request
2022-02-11 09:33:42.581152 (Thread-325): 09:33:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904dceb0>]}
2022-02-11 09:33:42.581598 (Thread-325): sending response (<Response 2023 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:33:56.015560 (Thread-326): handling status request
2022-02-11 09:33:56.015902 (Thread-326): 09:33:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904edeb0>]}
2022-02-11 09:33:56.016392 (Thread-326): sending response (<Response 2023 bytes [200 OK]>) to 10.0.46.69
2022-02-11 09:33:56.333733 (Thread-327): handling compile_sql request
2022-02-11 09:33:56.334073 (Thread-327): 09:33:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904ed400>]}
2022-02-11 09:33:58.451400 (Thread-327): sending response (<Response 138 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:33:58.477318 (MainThread): 09:33:58  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd5c6a23f-6907-4f89-bbcb-66aa2fc23878', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc8c174bb0>]}
2022-02-11 09:33:58.477880 (MainThread): 09:33:58  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:33:58.478475 (Thread-1): 09:33:58  Acquiring new bigquery connection "rpc.my_new_project.request"
2022-02-11 09:33:58.478710 (Thread-1): 09:33:58  Began compiling node rpc.my_new_project.request
2022-02-11 09:33:58.478806 (Thread-1): 09:33:58  Compiling rpc.my_new_project.request
2022-02-11 09:33:58.481382 (Thread-1): 09:33:58  finished collecting timing info
2022-02-11 09:33:58.481507 (Thread-1): 09:33:58  Began executing node rpc.my_new_project.request
2022-02-11 09:33:58.481605 (Thread-1): 09:33:58  finished collecting timing info
2022-02-11 09:33:58.787540 (Thread-328): handling poll request
2022-02-11 09:33:58.787950 (Thread-328): 09:33:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc3616d0>]}
2022-02-11 09:33:58.789157 (Thread-328): sending response (<Response 17110 bytes [200 OK]>) to 10.0.18.228
2022-02-11 09:34:30.854165 (Thread-329): 09:34:30  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:34:30.854562 (Thread-329): 09:34:30  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:34:30.859628 (Thread-329): 09:34:30  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:34:30.898355 (Thread-329): 09:34:30  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:34:30.903377 (Thread-329): 09:34:30  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890578670>]}
2022-02-11 09:34:32.086334 (Thread-330): handling status request
2022-02-11 09:34:32.086672 (Thread-330): 09:34:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589054b2e0>]}
2022-02-11 09:34:32.087199 (Thread-330): sending response (<Response 2023 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:34:32.424655 (Thread-331): handling status request
2022-02-11 09:34:32.424983 (Thread-331): 09:34:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589054b550>]}
2022-02-11 09:34:32.425458 (Thread-331): sending response (<Response 2023 bytes [200 OK]>) to 10.0.31.57
2022-02-11 09:34:40.205484 (Thread-332): handling status request
2022-02-11 09:34:40.205847 (Thread-332): 09:34:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589054b190>]}
2022-02-11 09:34:40.206329 (Thread-332): sending response (<Response 2023 bytes [200 OK]>) to 10.0.20.79
2022-02-11 09:34:40.444408 (Thread-333): handling status request
2022-02-11 09:34:40.444706 (Thread-333): 09:34:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589054b490>]}
2022-02-11 09:34:40.445184 (Thread-333): sending response (<Response 2023 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:34:40.568382 (Thread-334): handling cli_args request
2022-02-11 09:34:40.568690 (Thread-334): 09:34:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58904dc130>]}
2022-02-11 09:34:42.676219 (Thread-334): sending response (<Response 138 bytes [200 OK]>) to 10.0.13.131
2022-02-11 09:34:42.764819 (MainThread): 09:34:42  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:34:42.765281 (MainThread): 09:34:42  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:34:42.765849 (MainThread): 09:34:42  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:34:42.771143 (MainThread): 09:34:42  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '703932b5-fd21-4772-a854-a91e6776579d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf91364c0>]}
2022-02-11 09:34:42.802377 (MainThread): 09:34:42  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '703932b5-fd21-4772-a854-a91e6776579d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf91a9dc0>]}
2022-02-11 09:34:42.802615 (MainThread): 09:34:42  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:34:42.803678 (MainThread): 09:34:42  
2022-02-11 09:34:42.803946 (MainThread): 09:34:42  Acquiring new bigquery connection "master"
2022-02-11 09:34:42.804846 (ThreadPoolExecutor-0_0): 09:34:42  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 09:34:42.805124 (ThreadPoolExecutor-0_0): 09:34:42  Opening a new connection, currently in state init
2022-02-11 09:34:42.972903 (Thread-335): handling poll request
2022-02-11 09:34:42.973277 (Thread-335): 09:34:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890578be0>]}
2022-02-11 09:34:42.974175 (Thread-335): sending response (<Response 3791 bytes [200 OK]>) to 10.0.10.236
2022-02-11 09:34:43.092600 (ThreadPoolExecutor-1_0): 09:34:43  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 09:34:43.092781 (ThreadPoolExecutor-1_0): 09:34:43  Opening a new connection, currently in state closed
2022-02-11 09:34:43.292259 (MainThread): 09:34:43  Concurrency: 4 threads (target='default')
2022-02-11 09:34:43.292399 (MainThread): 09:34:43  
2022-02-11 09:34:43.294952 (Thread-1): 09:34:43  Began running node model.my_new_project.customer_orders
2022-02-11 09:34:43.295230 (Thread-1): 09:34:43  1 of 5 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 09:34:43.295484 (Thread-1): 09:34:43  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 09:34:43.295576 (Thread-1): 09:34:43  Began compiling node model.my_new_project.customer_orders
2022-02-11 09:34:43.295670 (Thread-1): 09:34:43  Compiling model.my_new_project.customer_orders
2022-02-11 09:34:43.299696 (Thread-1): 09:34:43  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:34:43.299926 (Thread-2): 09:34:43  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:34:43.300157 (Thread-2): 09:34:43  2 of 5 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 09:34:43.300409 (Thread-2): 09:34:43  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:34:43.300496 (Thread-2): 09:34:43  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:34:43.300577 (Thread-2): 09:34:43  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:34:43.302636 (Thread-2): 09:34:43  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:34:43.302883 (Thread-3): 09:34:43  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:34:43.303106 (Thread-3): 09:34:43  3 of 5 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 09:34:43.303353 (Thread-3): 09:34:43  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:34:43.303439 (Thread-3): 09:34:43  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:34:43.303520 (Thread-3): 09:34:43  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:34:43.305602 (Thread-3): 09:34:43  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:34:43.305856 (Thread-4): 09:34:43  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 09:34:43.306074 (Thread-4): 09:34:43  4 of 5 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 09:34:43.306317 (Thread-4): 09:34:43  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 09:34:43.306402 (Thread-4): 09:34:43  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 09:34:43.306480 (Thread-4): 09:34:43  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 09:34:43.308504 (Thread-4): 09:34:43  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:34:43.320809 (Thread-1): 09:34:43  finished collecting timing info
2022-02-11 09:34:43.321131 (Thread-1): 09:34:43  Began executing node model.my_new_project.customer_orders
2022-02-11 09:34:43.326251 (Thread-3): 09:34:43  finished collecting timing info
2022-02-11 09:34:43.326383 (Thread-3): 09:34:43  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:34:43.336544 (Thread-2): 09:34:43  finished collecting timing info
2022-02-11 09:34:43.336676 (Thread-2): 09:34:43  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:34:43.341954 (Thread-4): 09:34:43  finished collecting timing info
2022-02-11 09:34:43.342084 (Thread-4): 09:34:43  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 09:34:43.375588 (Thread-1): 09:34:43  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:34:43.376405 (Thread-2): 09:34:43  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:34:43.377213 (Thread-4): 09:34:43  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:34:43.378377 (Thread-3): 09:34:43  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:34:43.396292 (Thread-1): 09:34:43  Opening a new connection, currently in state closed
2022-02-11 09:34:43.396559 (Thread-2): 09:34:43  Opening a new connection, currently in state init
2022-02-11 09:34:43.396802 (Thread-3): 09:34:43  Opening a new connection, currently in state init
2022-02-11 09:34:43.397089 (Thread-4): 09:34:43  Opening a new connection, currently in state init
2022-02-11 09:34:43.401434 (Thread-2): 09:34:43  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 09:34:43.402377 (Thread-3): 09:34:43  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`orders`

),

transformed as (

    select 

        id as order_id,
        user_id as customer_id,
        order_date,
        status as order_status,
        row_number() over (
            partition  by user_id
            order by order_date, id
        ) as user_order_seq

    from source

)

select * from transformed;


2022-02-11 09:34:43.406333 (Thread-4): 09:34:43  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 09:34:43.407240 (Thread-1): 09:34:43  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 09:34:44.163159 (Thread-3): 09:34:44  finished collecting timing info
2022-02-11 09:34:44.163580 (Thread-3): 09:34:44  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '703932b5-fd21-4772-a854-a91e6776579d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf0f5c490>]}
2022-02-11 09:34:44.163916 (Thread-3): 09:34:44  3 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 0.86s]
2022-02-11 09:34:44.164033 (Thread-3): 09:34:44  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:34:44.310763 (Thread-4): 09:34:44  finished collecting timing info
2022-02-11 09:34:44.311164 (Thread-4): 09:34:44  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '703932b5-fd21-4772-a854-a91e6776579d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf0fac1f0>]}
2022-02-11 09:34:44.311625 (Thread-4): 09:34:44  4 of 5 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 1.00s]
2022-02-11 09:34:44.311737 (Thread-4): 09:34:44  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 09:34:44.322167 (Thread-336): handling poll request
2022-02-11 09:34:44.322459 (Thread-336): 09:34:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589052a5e0>]}
2022-02-11 09:34:44.323590 (Thread-336): sending response (<Response 27925 bytes [200 OK]>) to 10.0.3.5
2022-02-11 09:34:44.485162 (Thread-2): 09:34:44  finished collecting timing info
2022-02-11 09:34:44.485589 (Thread-2): 09:34:44  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '703932b5-fd21-4772-a854-a91e6776579d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf0ff4730>]}
2022-02-11 09:34:44.485946 (Thread-2): 09:34:44  2 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 1.19s]
2022-02-11 09:34:44.486059 (Thread-2): 09:34:44  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:34:44.486825 (Thread-3): 09:34:44  Began running node model.my_new_project.fct_customers_orders
2022-02-11 09:34:44.487084 (Thread-3): 09:34:44  5 of 5 START view model dbt_luisscabral.fct_customers_orders.................... [RUN]
2022-02-11 09:34:44.487346 (Thread-3): 09:34:44  Acquiring new bigquery connection "model.my_new_project.fct_customers_orders"
2022-02-11 09:34:44.487443 (Thread-3): 09:34:44  Began compiling node model.my_new_project.fct_customers_orders
2022-02-11 09:34:44.487532 (Thread-3): 09:34:44  Compiling model.my_new_project.fct_customers_orders
2022-02-11 09:34:44.490927 (Thread-3): 09:34:44  Writing injected SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:34:44.509839 (Thread-3): 09:34:44  finished collecting timing info
2022-02-11 09:34:44.510072 (Thread-3): 09:34:44  Began executing node model.my_new_project.fct_customers_orders
2022-02-11 09:34:44.512003 (Thread-3): 09:34:44  Writing runtime SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:34:44.528359 (Thread-3): 09:34:44  Opening a new connection, currently in state closed
2022-02-11 09:34:44.532703 (Thread-3): 09:34:44  On model.my_new_project.fct_customers_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customers_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customers_orders`
  OPTIONS()
  as with

-- Import CTEs
customers as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`

),

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`

),

customer_order_history as (

    select 

        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname,
        min(order_date) as first_order_date,

        min(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as first_non_returned_order_date,

        max(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as most_recent_non_returned_order_date,

        coalesce(max(user_order_seq),0) as order_count,

        coalesce(count(case 
            when orders.order_status != 'returned' 
            then 1 end),
            0
        ) as non_returned_order_count,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then round(payments.amount/100.0,2) 
            else 0 
        end) as total_lifetime_value,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then round(payments.amount/100.0,2) 
            else 0 
        end)
        / nullif(count(case 
            when orders.order_status not in ('returned','return_pending') 
            then 1 end),
            0
        ) as avg_non_returned_order_value,

        array_agg(distinct orders.order_id) as order_ids

    from orders

    join customers
    on orders.customer_id = customers.customer_id

    left outer join payments as payments
    on orders.order_id = payments.order_id

    where orders.order_status not in ('pending') and payments.payment_status != 'fail'

    group by 
        customers.full_name,
        customers.surname,
        customers.givenname

),

-- Final CTEs 
final as (

    select 

        ordersorder_id,
        orderscustomer_id,
        surname,
        givenname,
        first_order_date,
        order_count,
        total_lifetime_value,
        payment_amount as order_value_dollars,
        orders.order_status as order_status,
        payments.payment_status as payment_status

    from orders

    join customers
    on orders.customer_id = customers.id

    join customer_order_history
    on orders.customer_id = customer_order_history.customer_id

    left outer join payments
    on orders.order_id = payments.order_id

    where payments.payment_status != 'fail'

)

-- Simple Select Statement
select * from final;


2022-02-11 09:34:44.583771 (Thread-1): 09:34:44  finished collecting timing info
2022-02-11 09:34:44.584258 (Thread-1): 09:34:44  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '703932b5-fd21-4772-a854-a91e6776579d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf0fac9d0>]}
2022-02-11 09:34:44.584563 (Thread-1): 09:34:44  1 of 5 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.29s]
2022-02-11 09:34:44.584676 (Thread-1): 09:34:44  Finished running node model.my_new_project.customer_orders
2022-02-11 09:34:45.702817 (Thread-337): handling poll request
2022-02-11 09:34:45.703180 (Thread-337): 09:34:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589052afa0>]}
2022-02-11 09:34:45.729005 (Thread-337): sending response (<Response 11696 bytes [200 OK]>) to 10.0.11.229
2022-02-11 09:34:46.174383 (Thread-3): 09:34:46  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Name amount not found inside payments at [57:33]')
2022-02-11 09:34:47.045978 (Thread-338): handling poll request
2022-02-11 09:34:47.046307 (Thread-338): 09:34:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589050b340>]}
2022-02-11 09:34:47.046820 (Thread-338): sending response (<Response 698 bytes [200 OK]>) to 10.0.13.131
2022-02-11 09:34:47.753558 (Thread-3): 09:34:47  finished collecting timing info
2022-02-11 09:34:47.754020 (Thread-3): 09:34:47  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
  Name amount not found inside payments at [57:33]
  compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:34:47.754383 (Thread-3): 09:34:47  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '703932b5-fd21-4772-a854-a91e6776579d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf0f7b0a0>]}
2022-02-11 09:34:47.754715 (Thread-3): 09:34:47  5 of 5 ERROR creating view model dbt_luisscabral.fct_customers_orders........... [ERROR in 3.27s]
2022-02-11 09:34:47.754827 (Thread-3): 09:34:47  Finished running node model.my_new_project.fct_customers_orders
2022-02-11 09:34:47.756389 (MainThread): 09:34:47  Acquiring new bigquery connection "master"
2022-02-11 09:34:47.756705 (MainThread): 09:34:47  
2022-02-11 09:34:47.756814 (MainThread): 09:34:47  Finished running 5 view models in 4.95s.
2022-02-11 09:34:47.756896 (MainThread): 09:34:47  Connection 'master' was properly closed.
2022-02-11 09:34:47.756967 (MainThread): 09:34:47  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 09:34:47.757034 (MainThread): 09:34:47  Connection 'model.my_new_project.stg_jaffle_shop__customers' was properly closed.
2022-02-11 09:34:47.757099 (MainThread): 09:34:47  Connection 'model.my_new_project.fct_customers_orders' was properly closed.
2022-02-11 09:34:47.757164 (MainThread): 09:34:47  Connection 'model.my_new_project.stg_stripe__payments' was properly closed.
2022-02-11 09:34:47.813453 (MainThread): 09:34:47  
2022-02-11 09:34:47.813619 (MainThread): 09:34:47  Completed with 1 error and 0 warnings:
2022-02-11 09:34:47.813738 (MainThread): 09:34:47  
2022-02-11 09:34:47.813865 (MainThread): 09:34:47  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
2022-02-11 09:34:47.813970 (MainThread): 09:34:47    Name amount not found inside payments at [57:33]
2022-02-11 09:34:47.814043 (MainThread): 09:34:47    compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:34:47.814132 (MainThread): 09:34:47  
2022-02-11 09:34:47.814218 (MainThread): 09:34:47  Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
2022-02-11 09:34:48.383349 (Thread-339): handling poll request
2022-02-11 09:34:48.383685 (Thread-339): 09:34:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890578430>]}
2022-02-11 09:34:48.385039 (Thread-339): sending response (<Response 32520 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:34:49.149263 (Thread-340): handling status request
2022-02-11 09:34:49.149603 (Thread-340): 09:34:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58907cf700>]}
2022-02-11 09:34:49.150145 (Thread-340): sending response (<Response 2023 bytes [200 OK]>) to 10.0.38.212
2022-02-11 09:34:49.657546 (Thread-341): handling status request
2022-02-11 09:34:49.657906 (Thread-341): 09:34:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890531430>]}
2022-02-11 09:34:49.658377 (Thread-341): sending response (<Response 2023 bytes [200 OK]>) to 10.0.46.184
2022-02-11 09:35:20.488968 (Thread-342): 09:35:20  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:35:20.489346 (Thread-342): 09:35:20  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:35:20.493362 (Thread-342): 09:35:20  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:35:20.531088 (Thread-342): 09:35:20  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:35:20.535839 (Thread-342): 09:35:20  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902efe80>]}
2022-02-11 09:35:21.163765 (Thread-343): handling status request
2022-02-11 09:35:21.164105 (Thread-343): 09:35:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902c3f70>]}
2022-02-11 09:35:21.164614 (Thread-343): sending response (<Response 2023 bytes [200 OK]>) to 10.0.10.236
2022-02-11 09:35:21.302534 (Thread-344): handling status request
2022-02-11 09:35:21.302897 (Thread-344): 09:35:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890514a60>]}
2022-02-11 09:35:21.303353 (Thread-344): sending response (<Response 2023 bytes [200 OK]>) to 10.0.31.57
2022-02-11 09:35:22.974807 (Thread-345): handling status request
2022-02-11 09:35:22.975156 (Thread-345): 09:35:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902c3d00>]}
2022-02-11 09:35:22.975646 (Thread-345): sending response (<Response 2023 bytes [200 OK]>) to 10.0.3.5
2022-02-11 09:35:23.213341 (Thread-346): handling status request
2022-02-11 09:35:23.213678 (Thread-346): 09:35:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902c3970>]}
2022-02-11 09:35:23.214200 (Thread-346): sending response (<Response 2023 bytes [200 OK]>) to 10.0.30.21
2022-02-11 09:35:23.331528 (Thread-347): handling cli_args request
2022-02-11 09:35:23.331863 (Thread-347): 09:35:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902c3280>]}
2022-02-11 09:35:25.471026 (Thread-347): sending response (<Response 138 bytes [200 OK]>) to 10.0.18.228
2022-02-11 09:35:25.552401 (MainThread): 09:35:25  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:35:25.552917 (MainThread): 09:35:25  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:35:25.553488 (MainThread): 09:35:25  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:35:25.559263 (MainThread): 09:35:25  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '01f30dbf-d2d0-4d61-a8f2-7a3a7366f4b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd62a8eb2e0>]}
2022-02-11 09:35:25.584591 (MainThread): 09:35:25  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '01f30dbf-d2d0-4d61-a8f2-7a3a7366f4b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd62a96ab80>]}
2022-02-11 09:35:25.584882 (MainThread): 09:35:25  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:35:25.586134 (MainThread): 09:35:25  
2022-02-11 09:35:25.586458 (MainThread): 09:35:25  Acquiring new bigquery connection "master"
2022-02-11 09:35:25.587450 (ThreadPoolExecutor-0_0): 09:35:25  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 09:35:25.587751 (ThreadPoolExecutor-0_0): 09:35:25  Opening a new connection, currently in state init
2022-02-11 09:35:25.782622 (Thread-348): handling poll request
2022-02-11 09:35:25.783037 (Thread-348): 09:35:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589054baf0>]}
2022-02-11 09:35:25.783924 (Thread-348): sending response (<Response 3791 bytes [200 OK]>) to 10.0.13.131
2022-02-11 09:35:25.919472 (ThreadPoolExecutor-1_0): 09:35:25  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 09:35:25.919676 (ThreadPoolExecutor-1_0): 09:35:25  Opening a new connection, currently in state closed
2022-02-11 09:35:26.197547 (MainThread): 09:35:26  Concurrency: 4 threads (target='default')
2022-02-11 09:35:26.197748 (MainThread): 09:35:26  
2022-02-11 09:35:26.200434 (Thread-1): 09:35:26  Began running node model.my_new_project.customer_orders
2022-02-11 09:35:26.200711 (Thread-1): 09:35:26  1 of 5 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 09:35:26.200973 (Thread-1): 09:35:26  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 09:35:26.201066 (Thread-1): 09:35:26  Began compiling node model.my_new_project.customer_orders
2022-02-11 09:35:26.201160 (Thread-1): 09:35:26  Compiling model.my_new_project.customer_orders
2022-02-11 09:35:26.205213 (Thread-1): 09:35:26  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:35:26.205479 (Thread-2): 09:35:26  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:35:26.205752 (Thread-2): 09:35:26  2 of 5 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 09:35:26.206022 (Thread-2): 09:35:26  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:35:26.206109 (Thread-2): 09:35:26  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:35:26.206195 (Thread-2): 09:35:26  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:35:26.208333 (Thread-2): 09:35:26  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:35:26.208592 (Thread-3): 09:35:26  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:35:26.208816 (Thread-3): 09:35:26  3 of 5 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 09:35:26.209069 (Thread-3): 09:35:26  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:35:26.209152 (Thread-3): 09:35:26  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:35:26.209232 (Thread-3): 09:35:26  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:35:26.211373 (Thread-3): 09:35:26  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:35:26.211634 (Thread-4): 09:35:26  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 09:35:26.211852 (Thread-4): 09:35:26  4 of 5 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 09:35:26.212100 (Thread-4): 09:35:26  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 09:35:26.212192 (Thread-4): 09:35:26  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 09:35:26.212277 (Thread-4): 09:35:26  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 09:35:26.214330 (Thread-4): 09:35:26  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:35:26.222973 (Thread-1): 09:35:26  finished collecting timing info
2022-02-11 09:35:26.223143 (Thread-1): 09:35:26  Began executing node model.my_new_project.customer_orders
2022-02-11 09:35:26.228363 (Thread-3): 09:35:26  finished collecting timing info
2022-02-11 09:35:26.228525 (Thread-3): 09:35:26  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:35:26.233594 (Thread-4): 09:35:26  finished collecting timing info
2022-02-11 09:35:26.233800 (Thread-4): 09:35:26  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 09:35:26.243859 (Thread-2): 09:35:26  finished collecting timing info
2022-02-11 09:35:26.244007 (Thread-2): 09:35:26  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:35:26.284136 (Thread-2): 09:35:26  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:35:26.287512 (Thread-1): 09:35:26  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:35:26.289023 (Thread-4): 09:35:26  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:35:26.291518 (Thread-3): 09:35:26  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:35:26.301952 (Thread-2): 09:35:26  Opening a new connection, currently in state init
2022-02-11 09:35:26.305968 (Thread-4): 09:35:26  Opening a new connection, currently in state init
2022-02-11 09:35:26.306411 (Thread-2): 09:35:26  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 09:35:26.306858 (Thread-3): 09:35:26  Opening a new connection, currently in state init
2022-02-11 09:35:26.307740 (Thread-1): 09:35:26  Opening a new connection, currently in state closed
2022-02-11 09:35:26.312125 (Thread-4): 09:35:26  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 09:35:26.313179 (Thread-1): 09:35:26  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 09:35:26.313974 (Thread-3): 09:35:26  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`orders`

),

transformed as (

    select 

        id as order_id,
        user_id as customer_id,
        order_date,
        status as order_status,
        row_number() over (
            partition  by user_id
            order by order_date, id
        ) as user_order_seq

    from source

)

select * from transformed;


2022-02-11 09:35:27.126037 (Thread-349): handling poll request
2022-02-11 09:35:27.126386 (Thread-349): 09:35:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890372a60>]}
2022-02-11 09:35:27.127447 (Thread-349): sending response (<Response 24256 bytes [200 OK]>) to 10.0.38.212
2022-02-11 09:35:28.055442 (Thread-1): 09:35:28  finished collecting timing info
2022-02-11 09:35:28.056039 (Thread-1): 09:35:28  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01f30dbf-d2d0-4d61-a8f2-7a3a7366f4b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6287af070>]}
2022-02-11 09:35:28.056466 (Thread-1): 09:35:28  1 of 5 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.85s]
2022-02-11 09:35:28.056597 (Thread-1): 09:35:28  Finished running node model.my_new_project.customer_orders
2022-02-11 09:35:28.468841 (Thread-350): handling poll request
2022-02-11 09:35:28.469246 (Thread-350): 09:35:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890372e50>]}
2022-02-11 09:35:28.469878 (Thread-350): sending response (<Response 2086 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:35:28.862322 (Thread-4): 09:35:28  finished collecting timing info
2022-02-11 09:35:28.862781 (Thread-4): 09:35:28  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01f30dbf-d2d0-4d61-a8f2-7a3a7366f4b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd62879d670>]}
2022-02-11 09:35:28.863115 (Thread-4): 09:35:28  4 of 5 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 2.65s]
2022-02-11 09:35:28.863229 (Thread-4): 09:35:28  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 09:35:28.922697 (Thread-3): 09:35:28  finished collecting timing info
2022-02-11 09:35:28.923106 (Thread-3): 09:35:28  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01f30dbf-d2d0-4d61-a8f2-7a3a7366f4b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6287ca100>]}
2022-02-11 09:35:28.923572 (Thread-3): 09:35:28  3 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 2.71s]
2022-02-11 09:35:28.923686 (Thread-3): 09:35:28  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:35:28.939063 (Thread-2): 09:35:28  finished collecting timing info
2022-02-11 09:35:28.939423 (Thread-2): 09:35:28  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01f30dbf-d2d0-4d61-a8f2-7a3a7366f4b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6287ca2e0>]}
2022-02-11 09:35:28.939844 (Thread-2): 09:35:28  2 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 2.73s]
2022-02-11 09:35:28.939954 (Thread-2): 09:35:28  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:35:28.940763 (Thread-1): 09:35:28  Began running node model.my_new_project.fct_customers_orders
2022-02-11 09:35:28.940976 (Thread-1): 09:35:28  5 of 5 START view model dbt_luisscabral.fct_customers_orders.................... [RUN]
2022-02-11 09:35:28.941217 (Thread-1): 09:35:28  Acquiring new bigquery connection "model.my_new_project.fct_customers_orders"
2022-02-11 09:35:28.941308 (Thread-1): 09:35:28  Began compiling node model.my_new_project.fct_customers_orders
2022-02-11 09:35:28.941396 (Thread-1): 09:35:28  Compiling model.my_new_project.fct_customers_orders
2022-02-11 09:35:28.944769 (Thread-1): 09:35:28  Writing injected SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:35:28.961314 (Thread-1): 09:35:28  finished collecting timing info
2022-02-11 09:35:28.961453 (Thread-1): 09:35:28  Began executing node model.my_new_project.fct_customers_orders
2022-02-11 09:35:28.963430 (Thread-1): 09:35:28  Writing runtime SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:35:28.982073 (Thread-1): 09:35:28  Opening a new connection, currently in state closed
2022-02-11 09:35:28.986442 (Thread-1): 09:35:28  On model.my_new_project.fct_customers_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customers_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customers_orders`
  OPTIONS()
  as with

-- Import CTEs
customers as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`

),

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`

),

customer_order_history as (

    select 

        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname,
        min(order_date) as first_order_date,

        min(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as first_non_returned_order_date,

        max(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as most_recent_non_returned_order_date,

        coalesce(max(user_order_seq),0) as order_count,

        coalesce(count(case 
            when orders.order_status != 'returned' 
            then 1 end),
            0
        ) as non_returned_order_count,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then payments.payment_amount) 
            else 0 
        end) as total_lifetime_value,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then payments.payment_amount) 
            else 0 
        end)
        / nullif(count(case 
            when orders.order_status not in ('returned','return_pending') 
            then 1 end),
            0
        ) as avg_non_returned_order_value,

        array_agg(distinct orders.order_id) as order_ids

    from orders

    join customers
    on orders.customer_id = customers.customer_id

    left outer join payments as payments
    on orders.order_id = payments.order_id

    where orders.order_status not in ('pending') and payments.payment_status != 'fail'

    group by 
        customers.full_name,
        customers.surname,
        customers.givenname

),

-- Final CTEs 
final as (

    select 

        ordersorder_id,
        orderscustomer_id,
        surname,
        givenname,
        first_order_date,
        order_count,
        total_lifetime_value,
        payment_amount as order_value_dollars,
        orders.order_status as order_status,
        payments.payment_status as payment_status

    from orders

    join customers
    on orders.customer_id = customers.id

    join customer_order_history
    on orders.customer_id = customer_order_history.customer_id

    left outer join payments
    on orders.order_id = payments.order_id

    where payments.payment_status != 'fail'

)

-- Simple Select Statement
select * from final;


2022-02-11 09:35:29.339552 (Thread-1): 09:35:29  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected keyword ELSE or keyword END but got ")" at [57:41]')
2022-02-11 09:35:29.842846 (Thread-351): handling poll request
2022-02-11 09:35:29.843177 (Thread-351): 09:35:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902d4a60>]}
2022-02-11 09:35:29.844175 (Thread-351): sending response (<Response 13992 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:35:29.845035 (Thread-1): 09:35:29  finished collecting timing info
2022-02-11 09:35:29.845471 (Thread-1): 09:35:29  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
  Syntax error: Expected keyword ELSE or keyword END but got ")" at [57:41]
  compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:35:29.845851 (Thread-1): 09:35:29  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01f30dbf-d2d0-4d61-a8f2-7a3a7366f4b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6286de640>]}
2022-02-11 09:35:29.846198 (Thread-1): 09:35:29  5 of 5 ERROR creating view model dbt_luisscabral.fct_customers_orders........... [ERROR in 0.90s]
2022-02-11 09:35:29.846309 (Thread-1): 09:35:29  Finished running node model.my_new_project.fct_customers_orders
2022-02-11 09:35:29.847853 (MainThread): 09:35:29  Acquiring new bigquery connection "master"
2022-02-11 09:35:29.848172 (MainThread): 09:35:29  
2022-02-11 09:35:29.848269 (MainThread): 09:35:29  Finished running 5 view models in 4.26s.
2022-02-11 09:35:29.848352 (MainThread): 09:35:29  Connection 'master' was properly closed.
2022-02-11 09:35:29.848420 (MainThread): 09:35:29  Connection 'model.my_new_project.fct_customers_orders' was properly closed.
2022-02-11 09:35:29.848484 (MainThread): 09:35:29  Connection 'model.my_new_project.stg_jaffle_shop__customers' was properly closed.
2022-02-11 09:35:29.848548 (MainThread): 09:35:29  Connection 'model.my_new_project.stg_jaffle_shop__orders' was properly closed.
2022-02-11 09:35:29.848611 (MainThread): 09:35:29  Connection 'model.my_new_project.stg_stripe__payments' was properly closed.
2022-02-11 09:35:29.906795 (MainThread): 09:35:29  
2022-02-11 09:35:29.906996 (MainThread): 09:35:29  Completed with 1 error and 0 warnings:
2022-02-11 09:35:29.907089 (MainThread): 09:35:29  
2022-02-11 09:35:29.907184 (MainThread): 09:35:29  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
2022-02-11 09:35:29.907263 (MainThread): 09:35:29    Syntax error: Expected keyword ELSE or keyword END but got ")" at [57:41]
2022-02-11 09:35:29.907334 (MainThread): 09:35:29    compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:35:29.907418 (MainThread): 09:35:29  
2022-02-11 09:35:29.907501 (MainThread): 09:35:29  Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
2022-02-11 09:35:31.196350 (Thread-352): handling poll request
2022-02-11 09:35:31.196692 (Thread-352): 09:35:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890372940>]}
2022-02-11 09:35:31.198109 (Thread-352): sending response (<Response 32611 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:35:31.928155 (Thread-353): handling status request
2022-02-11 09:35:31.928483 (Thread-353): 09:35:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58903723d0>]}
2022-02-11 09:35:31.928974 (Thread-353): sending response (<Response 2023 bytes [200 OK]>) to 10.0.30.21
2022-02-11 09:35:32.482968 (Thread-354): handling status request
2022-02-11 09:35:32.483327 (Thread-354): 09:35:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58903727f0>]}
2022-02-11 09:35:32.483836 (Thread-354): sending response (<Response 2023 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:35:58.129037 (Thread-355): 09:35:58  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:35:58.129424 (Thread-355): 09:35:58  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:35:58.133579 (Thread-355): 09:35:58  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:35:58.173485 (Thread-355): 09:35:58  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:35:58.178401 (Thread-355): 09:35:58  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902138e0>]}
2022-02-11 09:35:58.799270 (Thread-356): handling status request
2022-02-11 09:35:58.799594 (Thread-356): 09:35:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58cc306280>]}
2022-02-11 09:35:58.800124 (Thread-356): sending response (<Response 2023 bytes [200 OK]>) to 10.0.3.5
2022-02-11 09:35:58.871264 (Thread-357): handling status request
2022-02-11 09:35:58.871586 (Thread-357): 09:35:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902d1040>]}
2022-02-11 09:35:58.872054 (Thread-357): sending response (<Response 2023 bytes [200 OK]>) to 10.0.20.79
2022-02-11 09:36:01.705783 (Thread-358): handling status request
2022-02-11 09:36:01.706128 (Thread-358): 09:36:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890211640>]}
2022-02-11 09:36:01.706612 (Thread-358): sending response (<Response 2023 bytes [200 OK]>) to 10.0.31.57
2022-02-11 09:36:01.895561 (Thread-359): handling status request
2022-02-11 09:36:01.895899 (Thread-359): 09:36:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890201100>]}
2022-02-11 09:36:01.896379 (Thread-359): sending response (<Response 2023 bytes [200 OK]>) to 10.0.46.69
2022-02-11 09:36:01.987120 (Thread-360): handling cli_args request
2022-02-11 09:36:01.987452 (Thread-360): 09:36:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589033c910>]}
2022-02-11 09:36:04.146173 (Thread-360): sending response (<Response 138 bytes [200 OK]>) to 10.0.13.131
2022-02-11 09:36:04.230300 (MainThread): 09:36:04  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:36:04.230782 (MainThread): 09:36:04  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:36:04.231335 (MainThread): 09:36:04  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:36:04.236880 (MainThread): 09:36:04  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '059ab241-c35b-4399-b682-1019ed68801d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa46b23b3a0>]}
2022-02-11 09:36:04.265203 (MainThread): 09:36:04  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '059ab241-c35b-4399-b682-1019ed68801d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa46b2adca0>]}
2022-02-11 09:36:04.265466 (MainThread): 09:36:04  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:36:04.266633 (MainThread): 09:36:04  
2022-02-11 09:36:04.266950 (MainThread): 09:36:04  Acquiring new bigquery connection "master"
2022-02-11 09:36:04.267945 (ThreadPoolExecutor-0_0): 09:36:04  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 09:36:04.268241 (ThreadPoolExecutor-0_0): 09:36:04  Opening a new connection, currently in state init
2022-02-11 09:36:04.451860 (Thread-361): handling poll request
2022-02-11 09:36:04.452262 (Thread-361): 09:36:04  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902137f0>]}
2022-02-11 09:36:04.453165 (Thread-361): sending response (<Response 3791 bytes [200 OK]>) to 10.0.11.229
2022-02-11 09:36:04.553425 (ThreadPoolExecutor-1_0): 09:36:04  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 09:36:04.553601 (ThreadPoolExecutor-1_0): 09:36:04  Opening a new connection, currently in state closed
2022-02-11 09:36:04.831657 (MainThread): 09:36:04  Concurrency: 4 threads (target='default')
2022-02-11 09:36:04.831829 (MainThread): 09:36:04  
2022-02-11 09:36:04.834771 (Thread-1): 09:36:04  Began running node model.my_new_project.customer_orders
2022-02-11 09:36:04.835080 (Thread-1): 09:36:04  1 of 5 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 09:36:04.835355 (Thread-1): 09:36:04  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 09:36:04.835456 (Thread-1): 09:36:04  Began compiling node model.my_new_project.customer_orders
2022-02-11 09:36:04.835551 (Thread-1): 09:36:04  Compiling model.my_new_project.customer_orders
2022-02-11 09:36:04.839859 (Thread-2): 09:36:04  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:36:04.840099 (Thread-2): 09:36:04  2 of 5 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 09:36:04.840363 (Thread-2): 09:36:04  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:36:04.840451 (Thread-2): 09:36:04  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:36:04.840535 (Thread-2): 09:36:04  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:36:04.842685 (Thread-2): 09:36:04  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:36:04.839642 (Thread-1): 09:36:04  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:36:04.842993 (Thread-3): 09:36:04  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:36:04.843220 (Thread-3): 09:36:04  3 of 5 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 09:36:04.843473 (Thread-3): 09:36:04  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:36:04.843561 (Thread-3): 09:36:04  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:36:04.843640 (Thread-3): 09:36:04  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:36:04.845741 (Thread-3): 09:36:04  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:36:04.846011 (Thread-4): 09:36:04  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 09:36:04.846225 (Thread-4): 09:36:04  4 of 5 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 09:36:04.846468 (Thread-4): 09:36:04  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 09:36:04.846551 (Thread-4): 09:36:04  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 09:36:04.846633 (Thread-4): 09:36:04  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 09:36:04.848625 (Thread-4): 09:36:04  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:36:04.860729 (Thread-2): 09:36:04  finished collecting timing info
2022-02-11 09:36:04.860902 (Thread-2): 09:36:04  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:36:04.865941 (Thread-1): 09:36:04  finished collecting timing info
2022-02-11 09:36:04.866083 (Thread-1): 09:36:04  Began executing node model.my_new_project.customer_orders
2022-02-11 09:36:04.881398 (Thread-4): 09:36:04  finished collecting timing info
2022-02-11 09:36:04.881536 (Thread-4): 09:36:04  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 09:36:04.886695 (Thread-3): 09:36:04  finished collecting timing info
2022-02-11 09:36:04.886836 (Thread-3): 09:36:04  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:36:04.926308 (Thread-1): 09:36:04  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:36:04.926757 (Thread-4): 09:36:04  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:36:04.927104 (Thread-3): 09:36:04  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:36:04.928874 (Thread-2): 09:36:04  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:36:04.943226 (Thread-1): 09:36:04  Opening a new connection, currently in state closed
2022-02-11 09:36:04.943562 (Thread-4): 09:36:04  Opening a new connection, currently in state init
2022-02-11 09:36:04.944178 (Thread-3): 09:36:04  Opening a new connection, currently in state init
2022-02-11 09:36:04.944492 (Thread-2): 09:36:04  Opening a new connection, currently in state init
2022-02-11 09:36:04.948173 (Thread-1): 09:36:04  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 09:36:04.949529 (Thread-3): 09:36:04  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`orders`

),

transformed as (

    select 

        id as order_id,
        user_id as customer_id,
        order_date,
        status as order_status,
        row_number() over (
            partition  by user_id
            order by order_date, id
        ) as user_order_seq

    from source

)

select * from transformed;


2022-02-11 09:36:04.950584 (Thread-4): 09:36:04  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 09:36:04.951308 (Thread-2): 09:36:04  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 09:36:05.770286 (Thread-362): handling poll request
2022-02-11 09:36:05.770643 (Thread-362): 09:36:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902b7d00>]}
2022-02-11 09:36:05.771659 (Thread-362): sending response (<Response 24256 bytes [200 OK]>) to 10.0.46.184
2022-02-11 09:36:05.770796 (Thread-3): 09:36:05  finished collecting timing info
2022-02-11 09:36:05.771216 (Thread-3): 09:36:05  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '059ab241-c35b-4399-b682-1019ed68801d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4680de100>]}
2022-02-11 09:36:05.771553 (Thread-3): 09:36:05  3 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 0.93s]
2022-02-11 09:36:05.771672 (Thread-3): 09:36:05  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:36:05.888177 (Thread-2): 09:36:05  finished collecting timing info
2022-02-11 09:36:05.888612 (Thread-2): 09:36:05  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '059ab241-c35b-4399-b682-1019ed68801d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa46a146d60>]}
2022-02-11 09:36:05.888948 (Thread-2): 09:36:05  2 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 1.05s]
2022-02-11 09:36:05.889063 (Thread-2): 09:36:05  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:36:05.915955 (Thread-4): 09:36:05  finished collecting timing info
2022-02-11 09:36:05.916391 (Thread-4): 09:36:05  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '059ab241-c35b-4399-b682-1019ed68801d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4680fd190>]}
2022-02-11 09:36:05.916736 (Thread-4): 09:36:05  4 of 5 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 1.07s]
2022-02-11 09:36:05.916852 (Thread-4): 09:36:05  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 09:36:05.917964 (Thread-3): 09:36:05  Began running node model.my_new_project.fct_customers_orders
2022-02-11 09:36:05.918206 (Thread-3): 09:36:05  5 of 5 START view model dbt_luisscabral.fct_customers_orders.................... [RUN]
2022-02-11 09:36:05.918457 (Thread-3): 09:36:05  Acquiring new bigquery connection "model.my_new_project.fct_customers_orders"
2022-02-11 09:36:05.918550 (Thread-3): 09:36:05  Began compiling node model.my_new_project.fct_customers_orders
2022-02-11 09:36:05.918636 (Thread-3): 09:36:05  Compiling model.my_new_project.fct_customers_orders
2022-02-11 09:36:05.921915 (Thread-3): 09:36:05  Writing injected SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:36:05.923673 (Thread-1): 09:36:05  finished collecting timing info
2022-02-11 09:36:05.924069 (Thread-1): 09:36:05  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '059ab241-c35b-4399-b682-1019ed68801d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa46810fd00>]}
2022-02-11 09:36:05.924357 (Thread-1): 09:36:05  1 of 5 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.09s]
2022-02-11 09:36:05.924463 (Thread-1): 09:36:05  Finished running node model.my_new_project.customer_orders
2022-02-11 09:36:05.937143 (Thread-3): 09:36:05  finished collecting timing info
2022-02-11 09:36:05.937287 (Thread-3): 09:36:05  Began executing node model.my_new_project.fct_customers_orders
2022-02-11 09:36:05.939353 (Thread-3): 09:36:05  Writing runtime SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:36:05.954907 (Thread-3): 09:36:05  Opening a new connection, currently in state closed
2022-02-11 09:36:05.959414 (Thread-3): 09:36:05  On model.my_new_project.fct_customers_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customers_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customers_orders`
  OPTIONS()
  as with

-- Import CTEs
customers as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`

),

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`

),

customer_order_history as (

    select 

        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname,
        min(order_date) as first_order_date,

        min(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as first_non_returned_order_date,

        max(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as most_recent_non_returned_order_date,

        coalesce(max(user_order_seq),0) as order_count,

        coalesce(count(case 
            when orders.order_status != 'returned' 
            then 1 end),
            0
        ) as non_returned_order_count,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then payments.payment_amount 
            else 0 
        end) as total_lifetime_value,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then payments.payment_amount
            else 0 
        end)
        / nullif(count(case 
            when orders.order_status not in ('returned','return_pending') 
            then 1 end),
            0
        ) as avg_non_returned_order_value,

        array_agg(distinct orders.order_id) as order_ids

    from orders

    join customers
    on orders.customer_id = customers.customer_id

    left outer join payments as payments
    on orders.order_id = payments.order_id

    where orders.order_status not in ('pending') and payments.payment_status != 'fail'

    group by 
        customers.full_name,
        customers.surname,
        customers.givenname

),

-- Final CTEs 
final as (

    select 

        ordersorder_id,
        orderscustomer_id,
        surname,
        givenname,
        first_order_date,
        order_count,
        total_lifetime_value,
        payment_amount as order_value_dollars,
        orders.order_status as order_status,
        payments.payment_status as payment_status

    from orders

    join customers
    on orders.customer_id = customers.id

    join customer_order_history
    on orders.customer_id = customer_order_history.customer_id

    left outer join payments
    on orders.order_id = payments.order_id

    where payments.payment_status != 'fail'

)

-- Simple Select Statement
select * from final;


2022-02-11 09:36:06.810747 (Thread-3): 09:36:06  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('SELECT list expression references customers.customer_id which is neither grouped nor aggregated at [31:9]')
2022-02-11 09:36:07.131771 (Thread-363): handling poll request
2022-02-11 09:36:07.132097 (Thread-363): 09:36:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890233d60>]}
2022-02-11 09:36:07.132869 (Thread-363): sending response (<Response 15821 bytes [200 OK]>) to 10.0.11.229
2022-02-11 09:36:08.037930 (Thread-3): 09:36:08  finished collecting timing info
2022-02-11 09:36:08.038388 (Thread-3): 09:36:08  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
  SELECT list expression references customers.customer_id which is neither grouped nor aggregated at [31:9]
  compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:36:08.038609 (Thread-3): 09:36:08  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '059ab241-c35b-4399-b682-1019ed68801d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa468038820>]}
2022-02-11 09:36:08.038952 (Thread-3): 09:36:08  5 of 5 ERROR creating view model dbt_luisscabral.fct_customers_orders........... [ERROR in 2.12s]
2022-02-11 09:36:08.039064 (Thread-3): 09:36:08  Finished running node model.my_new_project.fct_customers_orders
2022-02-11 09:36:08.040682 (MainThread): 09:36:08  Acquiring new bigquery connection "master"
2022-02-11 09:36:08.041014 (MainThread): 09:36:08  
2022-02-11 09:36:08.041114 (MainThread): 09:36:08  Finished running 5 view models in 3.77s.
2022-02-11 09:36:08.041199 (MainThread): 09:36:08  Connection 'master' was properly closed.
2022-02-11 09:36:08.041269 (MainThread): 09:36:08  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 09:36:08.041337 (MainThread): 09:36:08  Connection 'model.my_new_project.stg_jaffle_shop__customers' was properly closed.
2022-02-11 09:36:08.041401 (MainThread): 09:36:08  Connection 'model.my_new_project.fct_customers_orders' was properly closed.
2022-02-11 09:36:08.041464 (MainThread): 09:36:08  Connection 'model.my_new_project.stg_stripe__payments' was properly closed.
2022-02-11 09:36:08.098861 (MainThread): 09:36:08  
2022-02-11 09:36:08.099091 (MainThread): 09:36:08  Completed with 1 error and 0 warnings:
2022-02-11 09:36:08.099187 (MainThread): 09:36:08  
2022-02-11 09:36:08.099282 (MainThread): 09:36:08  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
2022-02-11 09:36:08.099363 (MainThread): 09:36:08    SELECT list expression references customers.customer_id which is neither grouped nor aggregated at [31:9]
2022-02-11 09:36:08.099434 (MainThread): 09:36:08    compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:36:08.099519 (MainThread): 09:36:08  
2022-02-11 09:36:08.099604 (MainThread): 09:36:08  Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
2022-02-11 09:36:08.458546 (Thread-364): handling poll request
2022-02-11 09:36:08.458890 (Thread-364): 09:36:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589021f8e0>]}
2022-02-11 09:36:08.460518 (Thread-364): sending response (<Response 32717 bytes [200 OK]>) to 10.0.44.113
2022-02-11 09:36:09.473248 (Thread-365): handling status request
2022-02-11 09:36:09.473611 (Thread-365): 09:36:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902a7a30>]}
2022-02-11 09:36:09.474166 (Thread-365): sending response (<Response 2023 bytes [200 OK]>) to 10.0.5.75
2022-02-11 09:36:09.745880 (Thread-366): handling status request
2022-02-11 09:36:09.746210 (Thread-366): 09:36:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890200370>]}
2022-02-11 09:36:09.746689 (Thread-366): sending response (<Response 2023 bytes [200 OK]>) to 10.0.11.229
2022-02-11 09:36:41.408069 (Thread-367): 09:36:41  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:36:41.408447 (Thread-367): 09:36:41  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:36:41.412638 (Thread-367): 09:36:41  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:36:41.451524 (Thread-367): 09:36:41  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:36:41.456378 (Thread-367): 09:36:41  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890160fa0>]}
2022-02-11 09:36:42.668883 (Thread-368): handling status request
2022-02-11 09:36:42.669219 (Thread-368): 09:36:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902115b0>]}
2022-02-11 09:36:42.669738 (Thread-368): sending response (<Response 2023 bytes [200 OK]>) to 10.0.40.216
2022-02-11 09:36:42.696479 (Thread-369): handling status request
2022-02-11 09:36:42.696730 (Thread-369): 09:36:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890213ca0>]}
2022-02-11 09:36:42.697124 (Thread-369): sending response (<Response 2023 bytes [200 OK]>) to 10.0.18.228
2022-02-11 09:36:44.615451 (Thread-370): handling status request
2022-02-11 09:36:44.615798 (Thread-370): 09:36:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890213250>]}
2022-02-11 09:36:44.616274 (Thread-370): sending response (<Response 2023 bytes [200 OK]>) to 10.0.44.113
2022-02-11 09:36:44.815396 (Thread-371): handling status request
2022-02-11 09:36:44.815723 (Thread-371): 09:36:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902133d0>]}
2022-02-11 09:36:44.816190 (Thread-371): sending response (<Response 2023 bytes [200 OK]>) to 10.0.13.131
2022-02-11 09:36:44.945315 (Thread-372): handling cli_args request
2022-02-11 09:36:44.945654 (Thread-372): 09:36:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890213a90>]}
2022-02-11 09:36:47.054362 (Thread-372): sending response (<Response 138 bytes [200 OK]>) to 10.0.46.184
2022-02-11 09:36:47.142126 (MainThread): 09:36:47  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:36:47.142646 (MainThread): 09:36:47  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:36:47.143213 (MainThread): 09:36:47  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:36:47.148745 (MainThread): 09:36:47  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4019bd55-8f36-4f60-8dc1-9d2c700dc5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff51dbd32e0>]}
2022-02-11 09:36:47.177737 (MainThread): 09:36:47  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4019bd55-8f36-4f60-8dc1-9d2c700dc5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff51dc53b80>]}
2022-02-11 09:36:47.178008 (MainThread): 09:36:47  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:36:47.179139 (MainThread): 09:36:47  
2022-02-11 09:36:47.179441 (MainThread): 09:36:47  Acquiring new bigquery connection "master"
2022-02-11 09:36:47.180429 (ThreadPoolExecutor-0_0): 09:36:47  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 09:36:47.180725 (ThreadPoolExecutor-0_0): 09:36:47  Opening a new connection, currently in state init
2022-02-11 09:36:47.379051 (Thread-373): handling poll request
2022-02-11 09:36:47.379479 (Thread-373): 09:36:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890213070>]}
2022-02-11 09:36:47.380416 (Thread-373): sending response (<Response 3791 bytes [200 OK]>) to 10.0.30.21
2022-02-11 09:36:47.411404 (ThreadPoolExecutor-1_0): 09:36:47  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 09:36:47.411583 (ThreadPoolExecutor-1_0): 09:36:47  Opening a new connection, currently in state closed
2022-02-11 09:36:47.650590 (MainThread): 09:36:47  Concurrency: 4 threads (target='default')
2022-02-11 09:36:47.650761 (MainThread): 09:36:47  
2022-02-11 09:36:47.653445 (Thread-1): 09:36:47  Began running node model.my_new_project.customer_orders
2022-02-11 09:36:47.653768 (Thread-1): 09:36:47  1 of 5 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 09:36:47.654040 (Thread-1): 09:36:47  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 09:36:47.654139 (Thread-1): 09:36:47  Began compiling node model.my_new_project.customer_orders
2022-02-11 09:36:47.654230 (Thread-1): 09:36:47  Compiling model.my_new_project.customer_orders
2022-02-11 09:36:47.658522 (Thread-2): 09:36:47  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:36:47.658757 (Thread-2): 09:36:47  2 of 5 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 09:36:47.659014 (Thread-2): 09:36:47  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:36:47.659103 (Thread-2): 09:36:47  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:36:47.659185 (Thread-2): 09:36:47  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:36:47.661237 (Thread-2): 09:36:47  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:36:47.658301 (Thread-1): 09:36:47  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:36:47.661505 (Thread-3): 09:36:47  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:36:47.661765 (Thread-3): 09:36:47  3 of 5 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 09:36:47.662025 (Thread-3): 09:36:47  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:36:47.662111 (Thread-3): 09:36:47  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:36:47.662191 (Thread-3): 09:36:47  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:36:47.664271 (Thread-3): 09:36:47  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:36:47.664585 (Thread-4): 09:36:47  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 09:36:47.664905 (Thread-4): 09:36:47  4 of 5 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 09:36:47.665278 (Thread-4): 09:36:47  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 09:36:47.665407 (Thread-4): 09:36:47  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 09:36:47.665496 (Thread-4): 09:36:47  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 09:36:47.667568 (Thread-4): 09:36:47  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:36:47.678795 (Thread-2): 09:36:47  finished collecting timing info
2022-02-11 09:36:47.678940 (Thread-2): 09:36:47  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:36:47.683894 (Thread-1): 09:36:47  finished collecting timing info
2022-02-11 09:36:47.684024 (Thread-1): 09:36:47  Began executing node model.my_new_project.customer_orders
2022-02-11 09:36:47.699463 (Thread-3): 09:36:47  finished collecting timing info
2022-02-11 09:36:47.699610 (Thread-3): 09:36:47  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:36:47.704822 (Thread-4): 09:36:47  finished collecting timing info
2022-02-11 09:36:47.704961 (Thread-4): 09:36:47  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 09:36:47.734880 (Thread-4): 09:36:47  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:36:47.736163 (Thread-1): 09:36:47  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:36:47.737035 (Thread-3): 09:36:47  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:36:47.737463 (Thread-2): 09:36:47  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:36:47.754283 (Thread-2): 09:36:47  Opening a new connection, currently in state init
2022-02-11 09:36:47.754561 (Thread-3): 09:36:47  Opening a new connection, currently in state init
2022-02-11 09:36:47.754794 (Thread-1): 09:36:47  Opening a new connection, currently in state closed
2022-02-11 09:36:47.755151 (Thread-4): 09:36:47  Opening a new connection, currently in state init
2022-02-11 09:36:47.759684 (Thread-1): 09:36:47  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 09:36:47.760464 (Thread-3): 09:36:47  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`orders`

),

transformed as (

    select 

        id as order_id,
        user_id as customer_id,
        order_date,
        status as order_status,
        row_number() over (
            partition  by user_id
            order by order_date, id
        ) as user_order_seq

    from source

)

select * from transformed;


2022-02-11 09:36:47.763315 (Thread-4): 09:36:47  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 09:36:47.764187 (Thread-2): 09:36:47  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 09:36:48.699735 (Thread-3): 09:36:48  finished collecting timing info
2022-02-11 09:36:48.700166 (Thread-3): 09:36:48  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4019bd55-8f36-4f60-8dc1-9d2c700dc5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff51c216430>]}
2022-02-11 09:36:48.700507 (Thread-3): 09:36:48  3 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 1.04s]
2022-02-11 09:36:48.700624 (Thread-3): 09:36:48  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:36:48.717993 (Thread-1): 09:36:48  finished collecting timing info
2022-02-11 09:36:48.718495 (Thread-1): 09:36:48  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4019bd55-8f36-4f60-8dc1-9d2c700dc5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff51c26cac0>]}
2022-02-11 09:36:48.718815 (Thread-1): 09:36:48  1 of 5 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.06s]
2022-02-11 09:36:48.718924 (Thread-1): 09:36:48  Finished running node model.my_new_project.customer_orders
2022-02-11 09:36:48.732862 (Thread-374): handling poll request
2022-02-11 09:36:48.733136 (Thread-374): 09:36:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589015de80>]}
2022-02-11 09:36:48.734269 (Thread-374): sending response (<Response 27900 bytes [200 OK]>) to 10.0.19.158
2022-02-11 09:36:48.745951 (Thread-4): 09:36:48  finished collecting timing info
2022-02-11 09:36:48.746316 (Thread-4): 09:36:48  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4019bd55-8f36-4f60-8dc1-9d2c700dc5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff51c20f4f0>]}
2022-02-11 09:36:48.746645 (Thread-4): 09:36:48  4 of 5 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 1.08s]
2022-02-11 09:36:48.746764 (Thread-4): 09:36:48  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 09:36:48.750556 (Thread-2): 09:36:48  finished collecting timing info
2022-02-11 09:36:48.750887 (Thread-2): 09:36:48  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4019bd55-8f36-4f60-8dc1-9d2c700dc5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff51c21e040>]}
2022-02-11 09:36:48.751254 (Thread-2): 09:36:48  2 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 1.09s]
2022-02-11 09:36:48.751363 (Thread-2): 09:36:48  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:36:48.752136 (Thread-3): 09:36:48  Began running node model.my_new_project.fct_customers_orders
2022-02-11 09:36:48.752376 (Thread-3): 09:36:48  5 of 5 START view model dbt_luisscabral.fct_customers_orders.................... [RUN]
2022-02-11 09:36:48.752614 (Thread-3): 09:36:48  Acquiring new bigquery connection "model.my_new_project.fct_customers_orders"
2022-02-11 09:36:48.752708 (Thread-3): 09:36:48  Began compiling node model.my_new_project.fct_customers_orders
2022-02-11 09:36:48.752796 (Thread-3): 09:36:48  Compiling model.my_new_project.fct_customers_orders
2022-02-11 09:36:48.755676 (Thread-3): 09:36:48  Writing injected SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:36:48.770674 (Thread-3): 09:36:48  finished collecting timing info
2022-02-11 09:36:48.770813 (Thread-3): 09:36:48  Began executing node model.my_new_project.fct_customers_orders
2022-02-11 09:36:48.772976 (Thread-3): 09:36:48  Writing runtime SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:36:48.786052 (Thread-3): 09:36:48  Opening a new connection, currently in state closed
2022-02-11 09:36:48.790424 (Thread-3): 09:36:48  On model.my_new_project.fct_customers_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customers_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customers_orders`
  OPTIONS()
  as with

-- Import CTEs
customers as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`

),

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`

),

customer_order_history as (

    select 

        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname,
        min(order_date) as first_order_date,

        min(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as first_non_returned_order_date,

        max(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as most_recent_non_returned_order_date,

        coalesce(max(user_order_seq),0) as order_count,

        coalesce(count(case 
            when orders.order_status != 'returned' 
            then 1 end),
            0
        ) as non_returned_order_count,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then payments.payment_amount 
            else 0 
        end) as total_lifetime_value,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then payments.payment_amount
            else 0 
        end)
        / nullif(count(case 
            when orders.order_status not in ('returned','return_pending') 
            then 1 end),
            0
        ) as avg_non_returned_order_value,

        array_agg(distinct orders.order_id) as order_ids

    from orders

    join customers
    on orders.customer_id = customers.customer_id

    left outer join payments as payments
    on orders.order_id = payments.order_id

    where orders.order_status not in ('pending') and payments.payment_status != 'fail'

    group by 
        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname

),

-- Final CTEs 
final as (

    select 

        ordersorder_id,
        orderscustomer_id,
        surname,
        givenname,
        first_order_date,
        order_count,
        total_lifetime_value,
        payment_amount as order_value_dollars,
        orders.order_status as order_status,
        payments.payment_status as payment_status

    from orders

    join customers
    on orders.customer_id = customers.id

    join customer_order_history
    on orders.customer_id = customer_order_history.customer_id

    left outer join payments
    on orders.order_id = payments.order_id

    where payments.payment_status != 'fail'

)

-- Simple Select Statement
select * from final;


2022-02-11 09:36:49.514659 (Thread-3): 09:36:49  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Name id not found inside customers at [111:39]')
2022-02-11 09:36:50.071857 (Thread-375): handling poll request
2022-02-11 09:36:50.072200 (Thread-375): 09:36:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589016b790>]}
2022-02-11 09:36:50.072906 (Thread-375): sending response (<Response 12150 bytes [200 OK]>) to 10.0.18.228
2022-02-11 09:36:51.333842 (Thread-3): 09:36:51  finished collecting timing info
2022-02-11 09:36:51.334301 (Thread-3): 09:36:51  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
  Name id not found inside customers at [111:39]
  compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:36:51.334652 (Thread-3): 09:36:51  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4019bd55-8f36-4f60-8dc1-9d2c700dc5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff51caec8e0>]}
2022-02-11 09:36:51.334991 (Thread-3): 09:36:51  5 of 5 ERROR creating view model dbt_luisscabral.fct_customers_orders........... [ERROR in 2.58s]
2022-02-11 09:36:51.335101 (Thread-3): 09:36:51  Finished running node model.my_new_project.fct_customers_orders
2022-02-11 09:36:51.336596 (MainThread): 09:36:51  Acquiring new bigquery connection "master"
2022-02-11 09:36:51.336905 (MainThread): 09:36:51  
2022-02-11 09:36:51.337001 (MainThread): 09:36:51  Finished running 5 view models in 4.16s.
2022-02-11 09:36:51.337082 (MainThread): 09:36:51  Connection 'master' was properly closed.
2022-02-11 09:36:51.337150 (MainThread): 09:36:51  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 09:36:51.337214 (MainThread): 09:36:51  Connection 'model.my_new_project.stg_jaffle_shop__customers' was properly closed.
2022-02-11 09:36:51.337276 (MainThread): 09:36:51  Connection 'model.my_new_project.fct_customers_orders' was properly closed.
2022-02-11 09:36:51.337337 (MainThread): 09:36:51  Connection 'model.my_new_project.stg_stripe__payments' was properly closed.
2022-02-11 09:36:51.399750 (MainThread): 09:36:51  
2022-02-11 09:36:51.399938 (MainThread): 09:36:51  Completed with 1 error and 0 warnings:
2022-02-11 09:36:51.400029 (MainThread): 09:36:51  
2022-02-11 09:36:51.400119 (MainThread): 09:36:51  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
2022-02-11 09:36:51.400196 (MainThread): 09:36:51    Name id not found inside customers at [111:39]
2022-02-11 09:36:51.400265 (MainThread): 09:36:51    compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:36:51.400346 (MainThread): 09:36:51  
2022-02-11 09:36:51.400428 (MainThread): 09:36:51  Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
2022-02-11 09:36:51.464362 (Thread-376): handling poll request
2022-02-11 09:36:51.464704 (Thread-376): 09:36:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589016b550>]}
2022-02-11 09:36:51.465396 (Thread-376): sending response (<Response 8715 bytes [200 OK]>) to 10.0.46.184
2022-02-11 09:36:52.814639 (Thread-377): handling poll request
2022-02-11 09:36:52.814978 (Thread-377): 09:36:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589015d880>]}
2022-02-11 09:36:52.816144 (Thread-377): sending response (<Response 24119 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:36:53.832204 (Thread-378): handling status request
2022-02-11 09:36:53.832527 (Thread-378): 09:36:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58902117c0>]}
2022-02-11 09:36:53.833027 (Thread-378): sending response (<Response 2023 bytes [200 OK]>) to 10.0.10.236
2022-02-11 09:36:53.962498 (Thread-379): handling status request
2022-02-11 09:36:53.962788 (Thread-379): 09:36:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589015e9a0>]}
2022-02-11 09:36:53.963256 (Thread-379): sending response (<Response 2023 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:37:06.683895 (Thread-380): 09:37:06  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:37:06.684289 (Thread-380): 09:37:06  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:37:06.688593 (Thread-380): 09:37:06  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:37:06.731852 (Thread-380): 09:37:06  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:37:06.737015 (Thread-380): 09:37:06  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589009c820>]}
2022-02-11 09:37:07.869594 (Thread-381): handling status request
2022-02-11 09:37:07.869961 (Thread-381): 09:37:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58900f2700>]}
2022-02-11 09:37:07.870455 (Thread-381): sending response (<Response 2023 bytes [200 OK]>) to 10.0.11.229
2022-02-11 09:37:07.935583 (Thread-382): handling status request
2022-02-11 09:37:07.935829 (Thread-382): 09:37:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58900f2400>]}
2022-02-11 09:37:07.936244 (Thread-382): sending response (<Response 2023 bytes [200 OK]>) to 10.0.38.212
2022-02-11 09:37:18.613095 (Thread-383): handling status request
2022-02-11 09:37:18.613443 (Thread-383): 09:37:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58900f2100>]}
2022-02-11 09:37:18.613968 (Thread-383): sending response (<Response 2023 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:37:18.852129 (Thread-384): handling status request
2022-02-11 09:37:18.852476 (Thread-384): 09:37:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58900edbe0>]}
2022-02-11 09:37:18.852968 (Thread-384): sending response (<Response 2023 bytes [200 OK]>) to 10.0.3.5
2022-02-11 09:37:18.992299 (Thread-385): handling cli_args request
2022-02-11 09:37:18.992590 (Thread-385): 09:37:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58900edb80>]}
2022-02-11 09:37:21.110781 (Thread-385): sending response (<Response 138 bytes [200 OK]>) to 10.0.46.69
2022-02-11 09:37:21.200761 (MainThread): 09:37:21  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:37:21.201208 (MainThread): 09:37:21  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:37:21.201755 (MainThread): 09:37:21  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:37:21.206992 (MainThread): 09:37:21  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6b9f76b0-6f96-4489-9391-2634fa9befae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9f310d400>]}
2022-02-11 09:37:21.240659 (MainThread): 09:37:21  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6b9f76b0-6f96-4489-9391-2634fa9befae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9f317fca0>]}
2022-02-11 09:37:21.240978 (MainThread): 09:37:21  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:37:21.242059 (MainThread): 09:37:21  
2022-02-11 09:37:21.242321 (MainThread): 09:37:21  Acquiring new bigquery connection "master"
2022-02-11 09:37:21.243240 (ThreadPoolExecutor-0_0): 09:37:21  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 09:37:21.243515 (ThreadPoolExecutor-0_0): 09:37:21  Opening a new connection, currently in state init
2022-02-11 09:37:21.446615 (Thread-386): handling poll request
2022-02-11 09:37:21.446993 (Thread-386): 09:37:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58900ffeb0>]}
2022-02-11 09:37:21.447861 (Thread-386): sending response (<Response 3791 bytes [200 OK]>) to 10.0.5.75
2022-02-11 09:37:21.519168 (ThreadPoolExecutor-1_0): 09:37:21  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 09:37:21.519347 (ThreadPoolExecutor-1_0): 09:37:21  Opening a new connection, currently in state closed
2022-02-11 09:37:21.743512 (MainThread): 09:37:21  Concurrency: 4 threads (target='default')
2022-02-11 09:37:21.743672 (MainThread): 09:37:21  
2022-02-11 09:37:21.746397 (Thread-1): 09:37:21  Began running node model.my_new_project.customer_orders
2022-02-11 09:37:21.746696 (Thread-1): 09:37:21  1 of 5 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 09:37:21.746979 (Thread-1): 09:37:21  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 09:37:21.747082 (Thread-1): 09:37:21  Began compiling node model.my_new_project.customer_orders
2022-02-11 09:37:21.747178 (Thread-1): 09:37:21  Compiling model.my_new_project.customer_orders
2022-02-11 09:37:21.751244 (Thread-1): 09:37:21  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:37:21.751472 (Thread-2): 09:37:21  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:37:21.751759 (Thread-3): 09:37:21  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:37:21.752012 (Thread-2): 09:37:21  2 of 5 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 09:37:21.752225 (Thread-4): 09:37:21  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 09:37:21.752586 (Thread-3): 09:37:21  3 of 5 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 09:37:21.752953 (Thread-2): 09:37:21  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:37:21.753249 (Thread-4): 09:37:21  4 of 5 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 09:37:21.753606 (Thread-3): 09:37:21  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:37:21.754072 (Thread-2): 09:37:21  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:37:21.754367 (Thread-4): 09:37:21  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 09:37:21.754512 (Thread-3): 09:37:21  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:37:21.754773 (Thread-2): 09:37:21  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:37:21.754911 (Thread-4): 09:37:21  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 09:37:21.755064 (Thread-3): 09:37:21  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:37:21.757347 (Thread-2): 09:37:21  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:37:21.757555 (Thread-4): 09:37:21  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 09:37:21.759756 (Thread-3): 09:37:21  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:37:21.761995 (Thread-4): 09:37:21  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:37:21.770102 (Thread-1): 09:37:21  finished collecting timing info
2022-02-11 09:37:21.770244 (Thread-1): 09:37:21  Began executing node model.my_new_project.customer_orders
2022-02-11 09:37:21.780666 (Thread-2): 09:37:21  finished collecting timing info
2022-02-11 09:37:21.780799 (Thread-2): 09:37:21  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:37:21.810056 (Thread-1): 09:37:21  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:37:21.810421 (Thread-3): 09:37:21  finished collecting timing info
2022-02-11 09:37:21.810568 (Thread-3): 09:37:21  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:37:21.812441 (Thread-3): 09:37:21  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:37:21.815423 (Thread-2): 09:37:21  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:37:21.822679 (Thread-4): 09:37:21  finished collecting timing info
2022-02-11 09:37:21.822816 (Thread-4): 09:37:21  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 09:37:21.824619 (Thread-4): 09:37:21  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:37:21.831683 (Thread-2): 09:37:21  Opening a new connection, currently in state init
2022-02-11 09:37:21.831929 (Thread-3): 09:37:21  Opening a new connection, currently in state init
2022-02-11 09:37:21.832162 (Thread-1): 09:37:21  Opening a new connection, currently in state closed
2022-02-11 09:37:21.836598 (Thread-2): 09:37:21  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 09:37:21.837446 (Thread-3): 09:37:21  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`orders`

),

transformed as (

    select 

        id as order_id,
        user_id as customer_id,
        order_date,
        status as order_status,
        row_number() over (
            partition  by user_id
            order by order_date, id
        ) as user_order_seq

    from source

)

select * from transformed;


2022-02-11 09:37:21.838225 (Thread-1): 09:37:21  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 09:37:21.839102 (Thread-4): 09:37:21  Opening a new connection, currently in state init
2022-02-11 09:37:21.843485 (Thread-4): 09:37:21  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 09:37:22.622164 (Thread-2): 09:37:22  finished collecting timing info
2022-02-11 09:37:22.622588 (Thread-2): 09:37:22  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b9f76b0-6f96-4489-9391-2634fa9befae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9f073cac0>]}
2022-02-11 09:37:22.623068 (Thread-2): 09:37:22  2 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 0.87s]
2022-02-11 09:37:22.623191 (Thread-2): 09:37:22  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:37:22.737307 (Thread-1): 09:37:22  finished collecting timing info
2022-02-11 09:37:22.737887 (Thread-1): 09:37:22  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b9f76b0-6f96-4489-9391-2634fa9befae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9f07ce640>]}
2022-02-11 09:37:22.738234 (Thread-1): 09:37:22  1 of 5 OK created view model dbt_luisscabral.customer_orders.................... [OK in 0.99s]
2022-02-11 09:37:22.738348 (Thread-1): 09:37:22  Finished running node model.my_new_project.customer_orders
2022-02-11 09:37:22.753894 (Thread-387): handling poll request
2022-02-11 09:37:22.754175 (Thread-387): 09:37:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890080640>]}
2022-02-11 09:37:22.755280 (Thread-387): sending response (<Response 27915 bytes [200 OK]>) to 10.0.11.229
2022-02-11 09:37:22.802301 (Thread-4): 09:37:22  finished collecting timing info
2022-02-11 09:37:22.802660 (Thread-4): 09:37:22  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b9f76b0-6f96-4489-9391-2634fa9befae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9f073c100>]}
2022-02-11 09:37:22.803099 (Thread-4): 09:37:22  4 of 5 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 1.05s]
2022-02-11 09:37:22.803213 (Thread-4): 09:37:22  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 09:37:22.863061 (Thread-3): 09:37:22  finished collecting timing info
2022-02-11 09:37:22.863453 (Thread-3): 09:37:22  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b9f76b0-6f96-4489-9391-2634fa9befae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9f0743af0>]}
2022-02-11 09:37:22.863914 (Thread-3): 09:37:22  3 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 1.11s]
2022-02-11 09:37:22.864029 (Thread-3): 09:37:22  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:37:22.864913 (Thread-2): 09:37:22  Began running node model.my_new_project.fct_customers_orders
2022-02-11 09:37:22.865156 (Thread-2): 09:37:22  5 of 5 START view model dbt_luisscabral.fct_customers_orders.................... [RUN]
2022-02-11 09:37:22.865404 (Thread-2): 09:37:22  Acquiring new bigquery connection "model.my_new_project.fct_customers_orders"
2022-02-11 09:37:22.865497 (Thread-2): 09:37:22  Began compiling node model.my_new_project.fct_customers_orders
2022-02-11 09:37:22.865585 (Thread-2): 09:37:22  Compiling model.my_new_project.fct_customers_orders
2022-02-11 09:37:22.868990 (Thread-2): 09:37:22  Writing injected SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:37:22.882155 (Thread-2): 09:37:22  finished collecting timing info
2022-02-11 09:37:22.882291 (Thread-2): 09:37:22  Began executing node model.my_new_project.fct_customers_orders
2022-02-11 09:37:22.884248 (Thread-2): 09:37:22  Writing runtime SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:37:22.902591 (Thread-2): 09:37:22  Opening a new connection, currently in state closed
2022-02-11 09:37:22.909589 (Thread-2): 09:37:22  On model.my_new_project.fct_customers_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customers_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customers_orders`
  OPTIONS()
  as with

-- Import CTEs
customers as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`

),

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`

),

customer_order_history as (

    select 

        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname,
        min(order_date) as first_order_date,

        min(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as first_non_returned_order_date,

        max(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as most_recent_non_returned_order_date,

        coalesce(max(user_order_seq),0) as order_count,

        coalesce(count(case 
            when orders.order_status != 'returned' 
            then 1 end),
            0
        ) as non_returned_order_count,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then payments.payment_amount 
            else 0 
        end) as total_lifetime_value,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then payments.payment_amount
            else 0 
        end)
        / nullif(count(case 
            when orders.order_status not in ('returned','return_pending') 
            then 1 end),
            0
        ) as avg_non_returned_order_value,

        array_agg(distinct orders.order_id) as order_ids

    from orders

    join customers
    on orders.customer_id = customers.customer_id

    left outer join payments as payments
    on orders.order_id = payments.order_id

    where orders.order_status not in ('pending') and payments.payment_status != 'fail'

    group by 
        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname

),

-- Final CTEs 
final as (

    select 

        ordersorder_id,
        orderscustomer_id,
        surname,
        givenname,
        first_order_date,
        order_count,
        total_lifetime_value,
        payment_amount as order_value_dollars,
        orders.order_status as order_status,
        payments.payment_status as payment_status

    from orders

    join customers
    on orders.customer_id = customers.customer_id

    join customer_order_history
    on orders.customer_id = customer_order_history.customer_id

    left outer join payments
    on orders.order_id = payments.order_id

    where payments.payment_status != 'fail'

)

-- Simple Select Statement
select * from final;


2022-02-11 09:37:23.883344 (Thread-2): 09:37:23  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: ordersorder_id at [97:9]')
2022-02-11 09:37:24.093086 (Thread-388): handling poll request
2022-02-11 09:37:24.093424 (Thread-388): 09:37:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589007b6a0>]}
2022-02-11 09:37:24.094156 (Thread-388): sending response (<Response 12141 bytes [200 OK]>) to 10.0.10.236
2022-02-11 09:37:25.456406 (Thread-389): handling poll request
2022-02-11 09:37:25.456755 (Thread-389): 09:37:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f589007bfd0>]}
2022-02-11 09:37:25.457238 (Thread-389): sending response (<Response 286 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:37:25.742266 (Thread-2): 09:37:25  finished collecting timing info
2022-02-11 09:37:25.742715 (Thread-2): 09:37:25  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
  Unrecognized name: ordersorder_id at [97:9]
  compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:37:25.743078 (Thread-2): 09:37:25  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b9f76b0-6f96-4489-9391-2634fa9befae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9f07685e0>]}
2022-02-11 09:37:25.743415 (Thread-2): 09:37:25  5 of 5 ERROR creating view model dbt_luisscabral.fct_customers_orders........... [ERROR in 2.88s]
2022-02-11 09:37:25.743529 (Thread-2): 09:37:25  Finished running node model.my_new_project.fct_customers_orders
2022-02-11 09:37:25.745182 (MainThread): 09:37:25  Acquiring new bigquery connection "master"
2022-02-11 09:37:25.745501 (MainThread): 09:37:25  
2022-02-11 09:37:25.745598 (MainThread): 09:37:25  Finished running 5 view models in 4.50s.
2022-02-11 09:37:25.745680 (MainThread): 09:37:25  Connection 'master' was properly closed.
2022-02-11 09:37:25.745774 (MainThread): 09:37:25  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 09:37:25.745839 (MainThread): 09:37:25  Connection 'model.my_new_project.fct_customers_orders' was properly closed.
2022-02-11 09:37:25.745902 (MainThread): 09:37:25  Connection 'model.my_new_project.stg_jaffle_shop__orders' was properly closed.
2022-02-11 09:37:25.745963 (MainThread): 09:37:25  Connection 'model.my_new_project.stg_stripe__payments' was properly closed.
2022-02-11 09:37:25.800999 (MainThread): 09:37:25  
2022-02-11 09:37:25.801196 (MainThread): 09:37:25  Completed with 1 error and 0 warnings:
2022-02-11 09:37:25.801286 (MainThread): 09:37:25  
2022-02-11 09:37:25.801375 (MainThread): 09:37:25  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
2022-02-11 09:37:25.801453 (MainThread): 09:37:25    Unrecognized name: ordersorder_id at [97:9]
2022-02-11 09:37:25.801521 (MainThread): 09:37:25    compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:37:25.801603 (MainThread): 09:37:25  
2022-02-11 09:37:25.801684 (MainThread): 09:37:25  Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
2022-02-11 09:37:27.177282 (Thread-390): handling poll request
2022-02-11 09:37:27.177614 (Thread-390): 09:37:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58900807c0>]}
2022-02-11 09:37:27.178968 (Thread-390): sending response (<Response 32550 bytes [200 OK]>) to 10.0.18.228
2022-02-11 09:37:28.311566 (Thread-391): handling status request
2022-02-11 09:37:28.311918 (Thread-391): 09:37:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890080a60>]}
2022-02-11 09:37:28.312472 (Thread-391): sending response (<Response 2023 bytes [200 OK]>) to 10.0.38.212
2022-02-11 09:37:28.385911 (Thread-392): handling status request
2022-02-11 09:37:28.386153 (Thread-392): 09:37:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5890134ac0>]}
2022-02-11 09:37:28.386577 (Thread-392): sending response (<Response 2023 bytes [200 OK]>) to 10.0.3.5
2022-02-11 09:37:45.930329 (Thread-393): 09:37:45  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:37:45.930719 (Thread-393): 09:37:45  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:37:45.935497 (Thread-393): 09:37:45  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:37:45.976936 (Thread-393): 09:37:45  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:37:45.981726 (Thread-393): 09:37:45  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c7b5a30>]}
2022-02-11 09:37:46.712836 (Thread-394): handling status request
2022-02-11 09:37:46.713183 (Thread-394): 09:37:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58900b8250>]}
2022-02-11 09:37:46.713740 (Thread-394): sending response (<Response 2023 bytes [200 OK]>) to 10.0.38.212
2022-02-11 09:37:46.831840 (Thread-395): handling status request
2022-02-11 09:37:46.832165 (Thread-395): 09:37:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58900543a0>]}
2022-02-11 09:37:46.832643 (Thread-395): sending response (<Response 2023 bytes [200 OK]>) to 10.0.13.131
2022-02-11 09:37:47.983260 (Thread-396): handling status request
2022-02-11 09:37:47.983620 (Thread-396): 09:37:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c79bca0>]}
2022-02-11 09:37:47.984129 (Thread-396): sending response (<Response 2023 bytes [200 OK]>) to 10.0.11.229
2022-02-11 09:37:48.334337 (Thread-397): handling status request
2022-02-11 09:37:48.334877 (Thread-397): 09:37:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58900542b0>]}
2022-02-11 09:37:48.353281 (Thread-398): handling cli_args request
2022-02-11 09:37:48.353796 (Thread-398): 09:37:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c79edf0>]}
2022-02-11 09:37:48.361564 (Thread-397): sending response (<Response 2023 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:37:50.455063 (Thread-398): sending response (<Response 138 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:37:50.542145 (MainThread): 09:37:50  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:37:50.542604 (MainThread): 09:37:50  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:37:50.543121 (MainThread): 09:37:50  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:37:50.548348 (MainThread): 09:37:50  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '48e80856-46a3-4f4a-b802-ff63ad31e91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b658c370>]}
2022-02-11 09:37:50.574325 (MainThread): 09:37:50  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '48e80856-46a3-4f4a-b802-ff63ad31e91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b65fec70>]}
2022-02-11 09:37:50.574826 (MainThread): 09:37:50  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:37:50.575875 (MainThread): 09:37:50  
2022-02-11 09:37:50.576141 (MainThread): 09:37:50  Acquiring new bigquery connection "master"
2022-02-11 09:37:50.577023 (ThreadPoolExecutor-0_0): 09:37:50  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 09:37:50.577295 (ThreadPoolExecutor-0_0): 09:37:50  Opening a new connection, currently in state init
2022-02-11 09:37:50.895099 (ThreadPoolExecutor-1_0): 09:37:50  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 09:37:50.895279 (ThreadPoolExecutor-1_0): 09:37:50  Opening a new connection, currently in state closed
2022-02-11 09:37:50.963449 (Thread-399): handling poll request
2022-02-11 09:37:50.963827 (Thread-399): 09:37:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c79ed00>]}
2022-02-11 09:37:50.964717 (Thread-399): sending response (<Response 4428 bytes [200 OK]>) to 10.0.46.184
2022-02-11 09:37:51.167793 (MainThread): 09:37:51  Concurrency: 4 threads (target='default')
2022-02-11 09:37:51.167960 (MainThread): 09:37:51  
2022-02-11 09:37:51.170650 (Thread-1): 09:37:51  Began running node model.my_new_project.customer_orders
2022-02-11 09:37:51.170943 (Thread-1): 09:37:51  1 of 5 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 09:37:51.171203 (Thread-1): 09:37:51  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 09:37:51.171299 (Thread-1): 09:37:51  Began compiling node model.my_new_project.customer_orders
2022-02-11 09:37:51.171391 (Thread-1): 09:37:51  Compiling model.my_new_project.customer_orders
2022-02-11 09:37:51.175387 (Thread-1): 09:37:51  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:37:51.175622 (Thread-2): 09:37:51  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:37:51.175858 (Thread-2): 09:37:51  2 of 5 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 09:37:51.176106 (Thread-2): 09:37:51  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:37:51.176195 (Thread-2): 09:37:51  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:37:51.176276 (Thread-2): 09:37:51  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:37:51.178365 (Thread-2): 09:37:51  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:37:51.178611 (Thread-3): 09:37:51  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:37:51.178831 (Thread-3): 09:37:51  3 of 5 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 09:37:51.179076 (Thread-3): 09:37:51  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:37:51.179162 (Thread-3): 09:37:51  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:37:51.179240 (Thread-3): 09:37:51  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:37:51.181287 (Thread-3): 09:37:51  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:37:51.181534 (Thread-4): 09:37:51  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 09:37:51.181804 (Thread-4): 09:37:51  4 of 5 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 09:37:51.182056 (Thread-4): 09:37:51  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 09:37:51.182145 (Thread-4): 09:37:51  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 09:37:51.182224 (Thread-4): 09:37:51  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 09:37:51.184241 (Thread-4): 09:37:51  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:37:51.192610 (Thread-1): 09:37:51  finished collecting timing info
2022-02-11 09:37:51.192756 (Thread-1): 09:37:51  Began executing node model.my_new_project.customer_orders
2022-02-11 09:37:51.197935 (Thread-4): 09:37:51  finished collecting timing info
2022-02-11 09:37:51.198070 (Thread-4): 09:37:51  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 09:37:51.203087 (Thread-2): 09:37:51  finished collecting timing info
2022-02-11 09:37:51.203220 (Thread-2): 09:37:51  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:37:51.231666 (Thread-3): 09:37:51  finished collecting timing info
2022-02-11 09:37:51.231815 (Thread-3): 09:37:51  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:37:51.245394 (Thread-2): 09:37:51  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:37:51.246184 (Thread-3): 09:37:51  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:37:51.249429 (Thread-1): 09:37:51  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:37:51.250553 (Thread-4): 09:37:51  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:37:51.270971 (Thread-3): 09:37:51  Opening a new connection, currently in state init
2022-02-11 09:37:51.272049 (Thread-2): 09:37:51  Opening a new connection, currently in state init
2022-02-11 09:37:51.273502 (Thread-1): 09:37:51  Opening a new connection, currently in state closed
2022-02-11 09:37:51.273762 (Thread-4): 09:37:51  Opening a new connection, currently in state init
2022-02-11 09:37:51.275384 (Thread-3): 09:37:51  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`orders`

),

transformed as (

    select 

        id as order_id,
        user_id as customer_id,
        order_date,
        status as order_status,
        row_number() over (
            partition  by user_id
            order by order_date, id
        ) as user_order_seq

    from source

)

select * from transformed;


2022-02-11 09:37:51.276770 (Thread-2): 09:37:51  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 09:37:51.278314 (Thread-1): 09:37:51  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 09:37:51.279194 (Thread-4): 09:37:51  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 09:37:52.244338 (Thread-3): 09:37:52  finished collecting timing info
2022-02-11 09:37:52.244766 (Thread-3): 09:37:52  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48e80856-46a3-4f4a-b802-ff63ad31e91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b43b1fa0>]}
2022-02-11 09:37:52.245101 (Thread-3): 09:37:52  3 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 1.07s]
2022-02-11 09:37:52.245219 (Thread-3): 09:37:52  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:37:52.264914 (Thread-4): 09:37:52  finished collecting timing info
2022-02-11 09:37:52.265263 (Thread-4): 09:37:52  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48e80856-46a3-4f4a-b802-ff63ad31e91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b4432460>]}
2022-02-11 09:37:52.265556 (Thread-4): 09:37:52  4 of 5 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 1.08s]
2022-02-11 09:37:52.265664 (Thread-4): 09:37:52  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 09:37:52.267384 (Thread-1): 09:37:52  finished collecting timing info
2022-02-11 09:37:52.267799 (Thread-1): 09:37:52  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48e80856-46a3-4f4a-b802-ff63ad31e91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b444f160>]}
2022-02-11 09:37:52.268081 (Thread-1): 09:37:52  1 of 5 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.10s]
2022-02-11 09:37:52.268187 (Thread-1): 09:37:52  Finished running node model.my_new_project.customer_orders
2022-02-11 09:37:52.273872 (Thread-2): 09:37:52  finished collecting timing info
2022-02-11 09:37:52.274203 (Thread-2): 09:37:52  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48e80856-46a3-4f4a-b802-ff63ad31e91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b44164c0>]}
2022-02-11 09:37:52.274480 (Thread-2): 09:37:52  2 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 1.10s]
2022-02-11 09:37:52.274592 (Thread-2): 09:37:52  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:37:52.276954 (Thread-400): handling poll request
2022-02-11 09:37:52.277222 (Thread-400): 09:37:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c7a8790>]}
2022-02-11 09:37:52.278354 (Thread-400): sending response (<Response 30947 bytes [200 OK]>) to 10.0.13.131
2022-02-11 09:37:52.275478 (Thread-3): 09:37:52  Began running node model.my_new_project.fct_customers_orders
2022-02-11 09:37:52.275696 (Thread-3): 09:37:52  5 of 5 START view model dbt_luisscabral.fct_customers_orders.................... [RUN]
2022-02-11 09:37:52.275928 (Thread-3): 09:37:52  Acquiring new bigquery connection "model.my_new_project.fct_customers_orders"
2022-02-11 09:37:52.276020 (Thread-3): 09:37:52  Began compiling node model.my_new_project.fct_customers_orders
2022-02-11 09:37:52.276104 (Thread-3): 09:37:52  Compiling model.my_new_project.fct_customers_orders
2022-02-11 09:37:52.278843 (Thread-3): 09:37:52  Writing injected SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:37:52.295679 (Thread-3): 09:37:52  finished collecting timing info
2022-02-11 09:37:52.295820 (Thread-3): 09:37:52  Began executing node model.my_new_project.fct_customers_orders
2022-02-11 09:37:52.298106 (Thread-3): 09:37:52  Writing runtime SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:37:52.312982 (Thread-3): 09:37:52  Opening a new connection, currently in state closed
2022-02-11 09:37:52.317319 (Thread-3): 09:37:52  On model.my_new_project.fct_customers_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customers_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customers_orders`
  OPTIONS()
  as with

-- Import CTEs
customers as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`

),

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`

),

customer_order_history as (

    select 

        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname,
        min(order_date) as first_order_date,

        min(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as first_non_returned_order_date,

        max(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as most_recent_non_returned_order_date,

        coalesce(max(user_order_seq),0) as order_count,

        coalesce(count(case 
            when orders.order_status != 'returned' 
            then 1 end),
            0
        ) as non_returned_order_count,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then payments.payment_amount 
            else 0 
        end) as total_lifetime_value,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then payments.payment_amount
            else 0 
        end)
        / nullif(count(case 
            when orders.order_status not in ('returned','return_pending') 
            then 1 end),
            0
        ) as avg_non_returned_order_value,

        array_agg(distinct orders.order_id) as order_ids

    from orders

    join customers
    on orders.customer_id = customers.customer_id

    left outer join payments as payments
    on orders.order_id = payments.order_id

    where orders.order_status not in ('pending') and payments.payment_status != 'fail'

    group by 
        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname

),

-- Final CTEs 
final as (

    select 

        orders.order_id,
        orders.customer_id,
        surname,
        givenname,
        first_order_date,
        order_count,
        total_lifetime_value,
        payment_amount as order_value_dollars,
        orders.order_status as order_status,
        payments.payment_status as payment_status

    from orders

    join customers
    on orders.customer_id = customers.customer_id

    join customer_order_history
    on orders.customer_id = customer_order_history.customer_id

    left outer join payments
    on orders.order_id = payments.order_id

    where payments.payment_status != 'fail'

)

-- Simple Select Statement
select * from final;


2022-02-11 09:37:53.154848 (Thread-3): 09:37:53  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Column name surname is ambiguous at [99:9]')
2022-02-11 09:37:53.607267 (Thread-401): handling poll request
2022-02-11 09:37:53.607610 (Thread-401): 09:37:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c7a8eb0>]}
2022-02-11 09:37:53.608230 (Thread-401): sending response (<Response 8473 bytes [200 OK]>) to 10.0.11.229
2022-02-11 09:37:54.042392 (Thread-3): 09:37:54  finished collecting timing info
2022-02-11 09:37:54.042828 (Thread-3): 09:37:54  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
  Column name surname is ambiguous at [99:9]
  compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:37:54.043196 (Thread-3): 09:37:54  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48e80856-46a3-4f4a-b802-ff63ad31e91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b436e4f0>]}
2022-02-11 09:37:54.043539 (Thread-3): 09:37:54  5 of 5 ERROR creating view model dbt_luisscabral.fct_customers_orders........... [ERROR in 1.77s]
2022-02-11 09:37:54.043651 (Thread-3): 09:37:54  Finished running node model.my_new_project.fct_customers_orders
2022-02-11 09:37:54.045155 (MainThread): 09:37:54  Acquiring new bigquery connection "master"
2022-02-11 09:37:54.045471 (MainThread): 09:37:54  
2022-02-11 09:37:54.045570 (MainThread): 09:37:54  Finished running 5 view models in 3.47s.
2022-02-11 09:37:54.045651 (MainThread): 09:37:54  Connection 'master' was properly closed.
2022-02-11 09:37:54.045744 (MainThread): 09:37:54  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 09:37:54.045810 (MainThread): 09:37:54  Connection 'model.my_new_project.stg_jaffle_shop__customers' was properly closed.
2022-02-11 09:37:54.045872 (MainThread): 09:37:54  Connection 'model.my_new_project.fct_customers_orders' was properly closed.
2022-02-11 09:37:54.045931 (MainThread): 09:37:54  Connection 'model.my_new_project.stg_stripe__payments' was properly closed.
2022-02-11 09:37:54.108920 (MainThread): 09:37:54  
2022-02-11 09:37:54.109081 (MainThread): 09:37:54  Completed with 1 error and 0 warnings:
2022-02-11 09:37:54.109172 (MainThread): 09:37:54  
2022-02-11 09:37:54.109261 (MainThread): 09:37:54  Database Error in model fct_customers_orders (models/marts/fct_customers_orders.sql)
2022-02-11 09:37:54.109338 (MainThread): 09:37:54    Column name surname is ambiguous at [99:9]
2022-02-11 09:37:54.109407 (MainThread): 09:37:54    compiled SQL at target/run/my_new_project/models/marts/fct_customers_orders.sql
2022-02-11 09:37:54.109488 (MainThread): 09:37:54  
2022-02-11 09:37:54.109570 (MainThread): 09:37:54  Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
2022-02-11 09:37:54.934147 (Thread-402): handling poll request
2022-02-11 09:37:54.934490 (Thread-402): 09:37:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c752a30>]}
2022-02-11 09:37:54.936072 (Thread-402): sending response (<Response 32555 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:37:55.824330 (Thread-403): handling status request
2022-02-11 09:37:55.824664 (Thread-403): 09:37:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c7a8370>]}
2022-02-11 09:37:55.825170 (Thread-403): sending response (<Response 2023 bytes [200 OK]>) to 10.0.44.113
2022-02-11 09:37:56.156023 (Thread-404): handling status request
2022-02-11 09:37:56.156365 (Thread-404): 09:37:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c7ab3a0>]}
2022-02-11 09:37:56.156877 (Thread-404): sending response (<Response 2023 bytes [200 OK]>) to 10.0.44.113
2022-02-11 09:38:27.450375 (Thread-405): 09:38:27  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:38:27.450751 (Thread-405): 09:38:27  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:38:27.455001 (Thread-405): 09:38:27  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:38:27.492760 (Thread-405): 09:38:27  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:38:27.497680 (Thread-405): 09:38:27  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c6a3f40>]}
2022-02-11 09:38:28.212971 (Thread-406): handling status request
2022-02-11 09:38:28.213322 (Thread-406): 09:38:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c679580>]}
2022-02-11 09:38:28.213869 (Thread-406): sending response (<Response 2023 bytes [200 OK]>) to 10.0.30.21
2022-02-11 09:38:28.389460 (Thread-407): handling status request
2022-02-11 09:38:28.389830 (Thread-407): 09:38:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c679df0>]}
2022-02-11 09:38:28.390327 (Thread-407): sending response (<Response 2023 bytes [200 OK]>) to 10.0.3.5
2022-02-11 09:38:38.215080 (Thread-408): 09:38:38  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 09:38:38.215418 (Thread-408): 09:38:38  Partial parsing: updated file: my_new_project://models/marts/fct_customers_orders.sql
2022-02-11 09:38:38.219421 (Thread-408): 09:38:38  1699: static parser successfully parsed marts/fct_customers_orders.sql
2022-02-11 09:38:38.264143 (Thread-408): 09:38:38  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:38:38.268733 (Thread-408): 09:38:38  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c612ca0>]}
2022-02-11 09:38:38.947209 (Thread-409): handling status request
2022-02-11 09:38:38.947539 (Thread-409): 09:38:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c6f87f0>]}
2022-02-11 09:38:38.948030 (Thread-409): sending response (<Response 2023 bytes [200 OK]>) to 10.0.19.224
2022-02-11 09:38:39.091674 (Thread-410): handling status request
2022-02-11 09:38:39.091928 (Thread-410): 09:38:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c6f8490>]}
2022-02-11 09:38:39.092351 (Thread-410): sending response (<Response 2023 bytes [200 OK]>) to 10.0.18.228
2022-02-11 09:38:40.346858 (Thread-411): handling status request
2022-02-11 09:38:40.347188 (Thread-411): 09:38:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c6f81f0>]}
2022-02-11 09:38:40.347676 (Thread-411): sending response (<Response 2023 bytes [200 OK]>) to 10.0.18.228
2022-02-11 09:38:40.627635 (Thread-412): handling status request
2022-02-11 09:38:40.627955 (Thread-412): 09:38:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c6f8070>]}
2022-02-11 09:38:40.628432 (Thread-412): sending response (<Response 2023 bytes [200 OK]>) to 10.0.46.184
2022-02-11 09:38:40.766848 (Thread-413): handling cli_args request
2022-02-11 09:38:40.767172 (Thread-413): 09:38:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c6f4d30>]}
2022-02-11 09:38:42.871025 (Thread-413): sending response (<Response 138 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:38:42.958502 (MainThread): 09:38:42  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 09:38:42.958974 (MainThread): 09:38:42  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 09:38:42.959503 (MainThread): 09:38:42  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 09:38:42.964828 (MainThread): 09:38:42  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8809eeb2-46c2-44ea-8311-28abedbcafb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2400abd2e0>]}
2022-02-11 09:38:42.995346 (MainThread): 09:38:42  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8809eeb2-46c2-44ea-8311-28abedbcafb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2400b3cb80>]}
2022-02-11 09:38:42.995627 (MainThread): 09:38:42  Found 5 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 09:38:42.996765 (MainThread): 09:38:42  
2022-02-11 09:38:42.997055 (MainThread): 09:38:42  Acquiring new bigquery connection "master"
2022-02-11 09:38:42.998047 (ThreadPoolExecutor-0_0): 09:38:42  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 09:38:42.998339 (ThreadPoolExecutor-0_0): 09:38:42  Opening a new connection, currently in state init
2022-02-11 09:38:43.189826 (Thread-414): handling poll request
2022-02-11 09:38:43.190226 (Thread-414): 09:38:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c7c9c70>]}
2022-02-11 09:38:43.191122 (Thread-414): sending response (<Response 3791 bytes [200 OK]>) to 10.0.43.23
2022-02-11 09:38:43.318138 (ThreadPoolExecutor-1_0): 09:38:43  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 09:38:43.318317 (ThreadPoolExecutor-1_0): 09:38:43  Opening a new connection, currently in state closed
2022-02-11 09:38:43.635478 (MainThread): 09:38:43  Concurrency: 4 threads (target='default')
2022-02-11 09:38:43.635640 (MainThread): 09:38:43  
2022-02-11 09:38:43.638337 (Thread-1): 09:38:43  Began running node model.my_new_project.customer_orders
2022-02-11 09:38:43.638663 (Thread-1): 09:38:43  1 of 5 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 09:38:43.638967 (Thread-1): 09:38:43  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 09:38:43.639084 (Thread-1): 09:38:43  Began compiling node model.my_new_project.customer_orders
2022-02-11 09:38:43.639185 (Thread-1): 09:38:43  Compiling model.my_new_project.customer_orders
2022-02-11 09:38:43.643409 (Thread-2): 09:38:43  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:38:43.643674 (Thread-2): 09:38:43  2 of 5 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 09:38:43.643971 (Thread-2): 09:38:43  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:38:43.644081 (Thread-2): 09:38:43  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:38:43.644178 (Thread-2): 09:38:43  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:38:43.646542 (Thread-2): 09:38:43  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:38:43.646785 (Thread-3): 09:38:43  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:38:43.647011 (Thread-3): 09:38:43  3 of 5 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 09:38:43.647259 (Thread-3): 09:38:43  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:38:43.647349 (Thread-3): 09:38:43  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:38:43.647430 (Thread-3): 09:38:43  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:38:43.649507 (Thread-3): 09:38:43  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:38:43.649778 (Thread-4): 09:38:43  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 09:38:43.649992 (Thread-4): 09:38:43  4 of 5 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 09:38:43.650233 (Thread-4): 09:38:43  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 09:38:43.650318 (Thread-4): 09:38:43  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 09:38:43.650397 (Thread-4): 09:38:43  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 09:38:43.652384 (Thread-4): 09:38:43  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:38:43.652767 (Thread-1): 09:38:43  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:38:43.665373 (Thread-2): 09:38:43  finished collecting timing info
2022-02-11 09:38:43.665519 (Thread-2): 09:38:43  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:38:43.670636 (Thread-4): 09:38:43  finished collecting timing info
2022-02-11 09:38:43.670768 (Thread-4): 09:38:43  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 09:38:43.685988 (Thread-1): 09:38:43  finished collecting timing info
2022-02-11 09:38:43.686121 (Thread-1): 09:38:43  Began executing node model.my_new_project.customer_orders
2022-02-11 09:38:43.691376 (Thread-3): 09:38:43  finished collecting timing info
2022-02-11 09:38:43.691506 (Thread-3): 09:38:43  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:38:43.721216 (Thread-2): 09:38:43  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 09:38:43.722122 (Thread-3): 09:38:43  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 09:38:43.722999 (Thread-1): 09:38:43  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 09:38:43.724320 (Thread-4): 09:38:43  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 09:38:43.739239 (Thread-2): 09:38:43  Opening a new connection, currently in state init
2022-02-11 09:38:43.740198 (Thread-1): 09:38:43  Opening a new connection, currently in state closed
2022-02-11 09:38:43.741073 (Thread-3): 09:38:43  Opening a new connection, currently in state init
2022-02-11 09:38:43.743144 (Thread-4): 09:38:43  Opening a new connection, currently in state init
2022-02-11 09:38:43.744548 (Thread-1): 09:38:43  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 09:38:43.745841 (Thread-3): 09:38:43  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`orders`

),

transformed as (

    select 

        id as order_id,
        user_id as customer_id,
        order_date,
        status as order_status,
        row_number() over (
            partition  by user_id
            order by order_date, id
        ) as user_order_seq

    from source

)

select * from transformed;


2022-02-11 09:38:43.748057 (Thread-2): 09:38:43  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 09:38:43.749042 (Thread-4): 09:38:43  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 09:38:44.545652 (Thread-415): handling poll request
2022-02-11 09:38:44.546019 (Thread-415): 09:38:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c65fd00>]}
2022-02-11 09:38:44.547079 (Thread-415): sending response (<Response 24255 bytes [200 OK]>) to 10.0.18.228
2022-02-11 09:38:44.651049 (Thread-2): 09:38:44  finished collecting timing info
2022-02-11 09:38:44.651469 (Thread-2): 09:38:44  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8809eeb2-46c2-44ea-8311-28abedbcafb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2400159d60>]}
2022-02-11 09:38:44.651809 (Thread-2): 09:38:44  2 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 1.01s]
2022-02-11 09:38:44.651927 (Thread-2): 09:38:44  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 09:38:44.679249 (Thread-4): 09:38:44  finished collecting timing info
2022-02-11 09:38:44.679594 (Thread-4): 09:38:44  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8809eeb2-46c2-44ea-8311-28abedbcafb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f240013ee80>]}
2022-02-11 09:38:44.679883 (Thread-4): 09:38:44  4 of 5 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 1.03s]
2022-02-11 09:38:44.679993 (Thread-4): 09:38:44  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 09:38:44.751643 (Thread-3): 09:38:44  finished collecting timing info
2022-02-11 09:38:44.751988 (Thread-3): 09:38:44  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8809eeb2-46c2-44ea-8311-28abedbcafb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f24000f3310>]}
2022-02-11 09:38:44.752275 (Thread-3): 09:38:44  3 of 5 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 1.10s]
2022-02-11 09:38:44.752382 (Thread-3): 09:38:44  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 09:38:44.753043 (Thread-2): 09:38:44  Began running node model.my_new_project.fct_customers_orders
2022-02-11 09:38:44.753293 (Thread-2): 09:38:44  5 of 5 START view model dbt_luisscabral.fct_customers_orders.................... [RUN]
2022-02-11 09:38:44.753532 (Thread-2): 09:38:44  Acquiring new bigquery connection "model.my_new_project.fct_customers_orders"
2022-02-11 09:38:44.753625 (Thread-2): 09:38:44  Began compiling node model.my_new_project.fct_customers_orders
2022-02-11 09:38:44.753738 (Thread-2): 09:38:44  Compiling model.my_new_project.fct_customers_orders
2022-02-11 09:38:44.756456 (Thread-2): 09:38:44  Writing injected SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:38:44.774172 (Thread-2): 09:38:44  finished collecting timing info
2022-02-11 09:38:44.774314 (Thread-2): 09:38:44  Began executing node model.my_new_project.fct_customers_orders
2022-02-11 09:38:44.776415 (Thread-2): 09:38:44  Writing runtime SQL for node "model.my_new_project.fct_customers_orders"
2022-02-11 09:38:44.791035 (Thread-2): 09:38:44  Opening a new connection, currently in state closed
2022-02-11 09:38:44.795545 (Thread-2): 09:38:44  On model.my_new_project.fct_customers_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customers_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customers_orders`
  OPTIONS()
  as with

-- Import CTEs
customers as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`

),

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`

),

customer_order_history as (

    select 

        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname,
        min(order_date) as first_order_date,

        min(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as first_non_returned_order_date,

        max(case 
            when orders.order_status not in ('returned','return_pending') 
            then order_date 
        end) as most_recent_non_returned_order_date,

        coalesce(max(user_order_seq),0) as order_count,

        coalesce(count(case 
            when orders.order_status != 'returned' 
            then 1 end),
            0
        ) as non_returned_order_count,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then payments.payment_amount 
            else 0 
        end) as total_lifetime_value,

        sum(case 
            when orders.order_status not in ('returned','return_pending') 
            then payments.payment_amount
            else 0 
        end)
        / nullif(count(case 
            when orders.order_status not in ('returned','return_pending') 
            then 1 end),
            0
        ) as avg_non_returned_order_value,

        array_agg(distinct orders.order_id) as order_ids

    from orders

    join customers
    on orders.customer_id = customers.customer_id

    left outer join payments as payments
    on orders.order_id = payments.order_id

    where orders.order_status not in ('pending') and payments.payment_status != 'fail'

    group by 
        customers.customer_id,
        customers.full_name,
        customers.surname,
        customers.givenname

),

-- Final CTEs 
final as (

    select 

        orders.order_id,
        orders.customer_id,
        customers.surname,
        customers.givenname,
        first_order_date,
        order_count,
        total_lifetime_value,
        payment_amount as order_value_dollars,
        orders.order_status as order_status,
        payments.payment_status as payment_status

    from orders

    join customers
    on orders.customer_id = customers.customer_id

    join customer_order_history
    on orders.customer_id = customer_order_history.customer_id

    left outer join payments
    on orders.order_id = payments.order_id

    where payments.payment_status != 'fail'

)

-- Simple Select Statement
select * from final;


2022-02-11 09:38:44.813270 (Thread-1): 09:38:44  finished collecting timing info
2022-02-11 09:38:44.813639 (Thread-1): 09:38:44  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8809eeb2-46c2-44ea-8311-28abedbcafb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2400155ca0>]}
2022-02-11 09:38:44.813983 (Thread-1): 09:38:44  1 of 5 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.17s]
2022-02-11 09:38:44.814099 (Thread-1): 09:38:44  Finished running node model.my_new_project.customer_orders
2022-02-11 09:38:45.755015 (Thread-2): 09:38:45  finished collecting timing info
2022-02-11 09:38:45.755617 (Thread-2): 09:38:45  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8809eeb2-46c2-44ea-8311-28abedbcafb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f240016f7c0>]}
2022-02-11 09:38:45.755962 (Thread-2): 09:38:45  5 of 5 OK created view model dbt_luisscabral.fct_customers_orders............... [OK in 1.00s]
2022-02-11 09:38:45.756076 (Thread-2): 09:38:45  Finished running node model.my_new_project.fct_customers_orders
2022-02-11 09:38:45.757662 (MainThread): 09:38:45  Acquiring new bigquery connection "master"
2022-02-11 09:38:45.757998 (MainThread): 09:38:45  
2022-02-11 09:38:45.758100 (MainThread): 09:38:45  Finished running 5 view models in 2.76s.
2022-02-11 09:38:45.758182 (MainThread): 09:38:45  Connection 'master' was properly closed.
2022-02-11 09:38:45.758251 (MainThread): 09:38:45  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 09:38:45.758315 (MainThread): 09:38:45  Connection 'model.my_new_project.fct_customers_orders' was properly closed.
2022-02-11 09:38:45.758378 (MainThread): 09:38:45  Connection 'model.my_new_project.stg_jaffle_shop__orders' was properly closed.
2022-02-11 09:38:45.758440 (MainThread): 09:38:45  Connection 'model.my_new_project.stg_stripe__payments' was properly closed.
2022-02-11 09:38:45.819320 (MainThread): 09:38:45  
2022-02-11 09:38:45.819686 (MainThread): 09:38:45  Completed successfully
2022-02-11 09:38:45.819851 (MainThread): 09:38:45  
2022-02-11 09:38:45.819940 (MainThread): 09:38:45  Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
2022-02-11 09:38:45.946217 (Thread-416): handling poll request
2022-02-11 09:38:45.946558 (Thread-416): 09:38:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c6241f0>]}
2022-02-11 09:38:45.947731 (Thread-416): sending response (<Response 21288 bytes [200 OK]>) to 10.0.13.131
2022-02-11 09:38:47.289166 (Thread-417): handling poll request
2022-02-11 09:38:47.289503 (Thread-417): 09:38:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c6f4d00>]}
2022-02-11 09:38:47.290722 (Thread-417): sending response (<Response 24260 bytes [200 OK]>) to 10.0.46.69
2022-02-11 09:38:48.529207 (Thread-418): handling status request
2022-02-11 09:38:48.529774 (Thread-418): 09:38:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c62ce80>]}
2022-02-11 09:38:48.530283 (Thread-418): sending response (<Response 2023 bytes [200 OK]>) to 10.0.5.155
2022-02-11 09:38:48.589264 (Thread-419): handling status request
2022-02-11 09:38:48.589488 (Thread-419): 09:38:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c62c790>]}
2022-02-11 09:38:48.589908 (Thread-419): sending response (<Response 2023 bytes [200 OK]>) to 10.0.30.21
2022-02-11 09:53:43.160656 (Thread-420): handling status request
2022-02-11 09:53:43.160992 (Thread-420): 09:53:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c624340>]}
2022-02-11 09:53:43.161470 (Thread-420): sending response (<Response 2023 bytes [200 OK]>) to 10.0.19.158
2022-02-11 09:53:43.180977 (Thread-421): handling status request
2022-02-11 09:53:43.181193 (Thread-421): 09:53:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '31046812-c9f6-455d-b370-961e6e7fd3d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f586c624610>]}
2022-02-11 09:53:43.181552 (Thread-421): sending response (<Response 2023 bytes [200 OK]>) to 10.0.5.155
2022-02-11 10:04:41.325591 (MainThread): Running with dbt=1.0.1
2022-02-11 10:04:41.487225 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt_rpc.task.server.RPCServerTask'>, debug=None, defer=None, exclude=None, fail_fast=None, host='0.0.0.0', log_cache_events=False, log_format=None, models=None, partial_parse=True, port=8580, printer_width=None, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='rpc', write_json=None)
2022-02-11 10:04:41.492297 (MainThread): Tracking: tracking
2022-02-11 10:04:41.512377 (Thread-12): 10:04:41  Partial parse save file not found. Starting full parse.
2022-02-11 10:04:41.512822 (Thread-12): 10:04:41  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565f4cb5e0>]}
2022-02-11 10:04:41.514725 (MainThread): 10:04:41  Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565b579ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565f4cbca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565f4cbb50>]}
2022-02-11 10:04:41.514990 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=21
2022-02-11 10:04:41.515180 (MainThread): Supported methods: ['build', 'cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'list', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'source-freshness', 'status', 'test']
2022-02-11 10:04:41.515311 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-02-11 10:04:41.583102 (Thread-12): 10:04:41  Parsing macros/adapters.sql
2022-02-11 10:04:41.611961 (Thread-12): 10:04:41  Parsing macros/etc.sql
2022-02-11 10:04:41.614380 (Thread-12): 10:04:41  Parsing macros/catalog.sql
2022-02-11 10:04:41.619933 (Thread-12): 10:04:41  Parsing macros/materializations/table.sql
2022-02-11 10:04:41.623733 (Thread-12): 10:04:41  Parsing macros/materializations/seed.sql
2022-02-11 10:04:41.626163 (Thread-12): 10:04:41  Parsing macros/materializations/incremental.sql
2022-02-11 10:04:41.640949 (Thread-12): 10:04:41  Parsing macros/materializations/copy.sql
2022-02-11 10:04:41.643498 (Thread-12): 10:04:41  Parsing macros/materializations/snapshot.sql
2022-02-11 10:04:41.645134 (Thread-12): 10:04:41  Parsing macros/materializations/view.sql
2022-02-11 10:04:41.647650 (Thread-12): 10:04:41  Parsing macros/adapters/metadata.sql
2022-02-11 10:04:41.654456 (Thread-12): 10:04:41  Parsing macros/adapters/columns.sql
2022-02-11 10:04:41.663930 (Thread-12): 10:04:41  Parsing macros/adapters/freshness.sql
2022-02-11 10:04:41.666748 (Thread-12): 10:04:41  Parsing macros/adapters/persist_docs.sql
2022-02-11 10:04:41.671007 (Thread-12): 10:04:41  Parsing macros/adapters/relation.sql
2022-02-11 10:04:41.680245 (Thread-12): 10:04:41  Parsing macros/adapters/schema.sql
2022-02-11 10:04:41.682390 (Thread-12): 10:04:41  Parsing macros/adapters/indexes.sql
2022-02-11 10:04:41.685051 (Thread-12): 10:04:41  Parsing macros/get_custom_name/get_custom_schema.sql
2022-02-11 10:04:41.687609 (Thread-12): 10:04:41  Parsing macros/get_custom_name/get_custom_alias.sql
2022-02-11 10:04:41.689066 (Thread-12): 10:04:41  Parsing macros/get_custom_name/get_custom_database.sql
2022-02-11 10:04:41.690607 (Thread-12): 10:04:41  Parsing macros/etc/datetime.sql
2022-02-11 10:04:41.699447 (Thread-12): 10:04:41  Parsing macros/etc/statement.sql
2022-02-11 10:04:41.705108 (Thread-12): 10:04:41  Parsing macros/generic_test_sql/unique.sql
2022-02-11 10:04:41.706120 (Thread-12): 10:04:41  Parsing macros/generic_test_sql/not_null.sql
2022-02-11 10:04:41.706919 (Thread-12): 10:04:41  Parsing macros/generic_test_sql/accepted_values.sql
2022-02-11 10:04:41.708290 (Thread-12): 10:04:41  Parsing macros/generic_test_sql/relationships.sql
2022-02-11 10:04:41.709166 (Thread-12): 10:04:41  Parsing macros/materializations/configs.sql
2022-02-11 10:04:41.711470 (Thread-12): 10:04:41  Parsing macros/materializations/hooks.sql
2022-02-11 10:04:41.715282 (Thread-12): 10:04:41  Parsing macros/materializations/models/table/table.sql
2022-02-11 10:04:41.722348 (Thread-12): 10:04:41  Parsing macros/materializations/models/table/create_table_as.sql
2022-02-11 10:04:41.725194 (Thread-12): 10:04:41  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-02-11 10:04:41.727813 (Thread-12): 10:04:41  Parsing macros/materializations/models/view/helpers.sql
2022-02-11 10:04:41.729101 (Thread-12): 10:04:41  Parsing macros/materializations/models/view/create_view_as.sql
2022-02-11 10:04:41.731371 (Thread-12): 10:04:41  Parsing macros/materializations/models/view/view.sql
2022-02-11 10:04:41.738159 (Thread-12): 10:04:41  Parsing macros/materializations/models/incremental/incremental.sql
2022-02-11 10:04:41.747851 (Thread-12): 10:04:41  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-02-11 10:04:41.762533 (Thread-12): 10:04:41  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-02-11 10:04:41.764029 (Thread-12): 10:04:41  Parsing macros/materializations/models/incremental/merge.sql
2022-02-11 10:04:41.774736 (Thread-12): 10:04:41  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-02-11 10:04:41.779085 (Thread-12): 10:04:41  Parsing macros/materializations/seeds/helpers.sql
2022-02-11 10:04:41.794677 (Thread-12): 10:04:41  Parsing macros/materializations/seeds/seed.sql
2022-02-11 10:04:41.800466 (Thread-12): 10:04:41  Parsing macros/materializations/tests/helpers.sql
2022-02-11 10:04:41.802191 (Thread-12): 10:04:41  Parsing macros/materializations/tests/test.sql
2022-02-11 10:04:41.806453 (Thread-12): 10:04:41  Parsing macros/materializations/tests/where_subquery.sql
2022-02-11 10:04:41.808235 (Thread-12): 10:04:41  Parsing macros/materializations/snapshots/helpers.sql
2022-02-11 10:04:41.819412 (Thread-12): 10:04:41  Parsing macros/materializations/snapshots/strategies.sql
2022-02-11 10:04:41.835474 (Thread-12): 10:04:41  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-02-11 10:04:41.837079 (Thread-12): 10:04:41  Parsing macros/materializations/snapshots/snapshot.sql
2022-02-11 10:04:41.848095 (Thread-12): 10:04:41  Parsing tests/generic/builtin.sql
2022-02-11 10:04:42.044980 (Thread-12): 10:04:42  1699: static parser successfully parsed legacy/customer_orders.sql
2022-02-11 10:04:42.057086 (Thread-12): 10:04:42  1699: static parser successfully parsed staging/jaffle_shop/stg_jaffle_shop__orders.sql
2022-02-11 10:04:42.059110 (Thread-12): 10:04:42  1699: static parser successfully parsed staging/jaffle_shop/stg_jaffle_shop__customers.sql
2022-02-11 10:04:42.061060 (Thread-12): 10:04:42  1699: static parser successfully parsed staging/stripe/stg_stripe__payments.sql
2022-02-11 10:04:42.063187 (Thread-12): 10:04:42  1699: static parser successfully parsed marts/fct_customer_orders.sql
2022-02-11 10:04:42.065319 (Thread-12): 10:04:42  1699: static parser successfully parsed marts/int_orders.sql
2022-02-11 10:04:42.142402 (Thread-12): 10:04:42  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 10:04:42.147914 (Thread-12): 10:04:42  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500fa400>]}
2022-02-11 10:06:35.426430 (Thread-13): handling status request
2022-02-11 10:06:35.426831 (Thread-13): 10:06:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500fbf10>]}
2022-02-11 10:06:35.427877 (Thread-13): sending response (<Response 17499 bytes [200 OK]>) to 10.0.20.79
2022-02-11 10:06:35.667514 (Thread-14): handling status request
2022-02-11 10:06:35.667893 (Thread-14): 10:06:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565f4d3ca0>]}
2022-02-11 10:06:35.668756 (Thread-14): sending response (<Response 17499 bytes [200 OK]>) to 10.0.44.113
2022-02-11 10:06:35.770616 (Thread-15): handling ps request
2022-02-11 10:06:35.771041 (Thread-15): 10:06:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500faac0>]}
2022-02-11 10:06:35.771520 (Thread-15): sending response (<Response 105 bytes [200 OK]>) to 10.0.46.184
2022-02-11 10:06:35.786986 (Thread-16): handling status request
2022-02-11 10:06:35.787288 (Thread-16): 10:06:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500fa490>]}
2022-02-11 10:06:35.788116 (Thread-16): sending response (<Response 17499 bytes [200 OK]>) to 10.0.44.113
2022-02-11 10:06:37.243484 (Thread-17): handling status request
2022-02-11 10:06:37.243857 (Thread-17): 10:06:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500fac70>]}
2022-02-11 10:06:37.244711 (Thread-17): sending response (<Response 17477 bytes [200 OK]>) to 10.0.44.250
2022-02-11 10:06:37.256997 (Thread-18): handling list request
2022-02-11 10:06:37.257263 (Thread-18): 10:06:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500fa160>]}
2022-02-11 10:06:37.292307 (Thread-18): 10:06:37  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500fac40>]}
2022-02-11 10:06:37.292815 (Thread-18): 10:06:37  Found 6 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 10:06:37.297145 (Thread-18): 10:06:37  The selection criterion '+1644573996200/__unsaved/Statement' does not match any nodes
2022-02-11 10:06:37.297399 (Thread-18): 10:06:37  The selection criterion '1.sql+' does not match any nodes
2022-02-11 10:06:37.297528 (Thread-18): 10:06:37  No nodes selected!
2022-02-11 10:06:37.299224 (Thread-18): sending response (<Response 2348 bytes [200 OK]>) to 10.0.44.250
2022-02-11 10:06:37.775647 (Thread-19): handling status request
2022-02-11 10:06:37.776051 (Thread-19): 10:06:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5650105b50>]}
2022-02-11 10:06:37.776979 (Thread-19): sending response (<Response 17499 bytes [200 OK]>) to 10.0.31.57
2022-02-11 10:06:39.889215 (Thread-20): handling status request
2022-02-11 10:06:39.889591 (Thread-20): 10:06:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500ee1f0>]}
2022-02-11 10:06:39.890460 (Thread-20): sending response (<Response 17477 bytes [200 OK]>) to 10.0.44.250
2022-02-11 10:06:39.897506 (Thread-21): handling list request
2022-02-11 10:06:39.897764 (Thread-21): 10:06:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500ee460>]}
2022-02-11 10:06:39.926084 (Thread-21): 10:06:39  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5650105be0>]}
2022-02-11 10:06:39.926399 (Thread-21): 10:06:39  Found 6 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 10:06:39.927735 (Thread-21): 10:06:39  The selection criterion '+1644573996200/__unsaved/Statement' does not match any nodes
2022-02-11 10:06:39.927946 (Thread-21): 10:06:39  The selection criterion '1.sql+' does not match any nodes
2022-02-11 10:06:39.928060 (Thread-21): 10:06:39  No nodes selected!
2022-02-11 10:06:39.929524 (Thread-21): sending response (<Response 2348 bytes [200 OK]>) to 10.0.44.250
2022-02-11 10:06:46.224910 (Thread-22): handling status request
2022-02-11 10:06:46.225284 (Thread-22): 10:06:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565039ebb0>]}
2022-02-11 10:06:46.226163 (Thread-22): sending response (<Response 17499 bytes [200 OK]>) to 10.0.31.57
2022-02-11 10:06:46.521661 (Thread-23): handling status request
2022-02-11 10:06:46.523667 (Thread-23): 10:06:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565039ea90>]}
2022-02-11 10:06:46.524606 (Thread-23): sending response (<Response 17499 bytes [200 OK]>) to 10.0.43.23
2022-02-11 10:06:46.557651 (Thread-24): handling cli_args request
2022-02-11 10:06:46.557966 (Thread-24): 10:06:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565039e400>]}
2022-02-11 10:06:48.753568 (Thread-24): sending response (<Response 138 bytes [200 OK]>) to 10.0.44.113
2022-02-11 10:06:48.868833 (MainThread): 10:06:48  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 10:06:48.869295 (MainThread): 10:06:48  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 10:06:48.869838 (MainThread): 10:06:48  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 10:06:48.875196 (MainThread): 10:06:48  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'df3276e3-6a1a-4a95-9f31-3e6852c6ab6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f76bda0a9d0>]}
2022-02-11 10:06:48.907440 (MainThread): 10:06:48  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'df3276e3-6a1a-4a95-9f31-3e6852c6ab6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f76be29e3a0>]}
2022-02-11 10:06:48.907688 (MainThread): 10:06:48  Found 6 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 10:06:48.908787 (MainThread): 10:06:48  
2022-02-11 10:06:48.909065 (MainThread): 10:06:48  Acquiring new bigquery connection "master"
2022-02-11 10:06:48.910227 (ThreadPoolExecutor-0_0): 10:06:48  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 10:06:48.910373 (ThreadPoolExecutor-0_0): 10:06:48  Opening a new connection, currently in state init
2022-02-11 10:06:49.087821 (Thread-25): handling poll request
2022-02-11 10:06:49.088226 (Thread-25): 10:06:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56503882b0>]}
2022-02-11 10:06:49.089064 (Thread-25): sending response (<Response 3780 bytes [200 OK]>) to 10.0.18.228
2022-02-11 10:06:50.209639 (ThreadPoolExecutor-1_0): 10:06:50  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 10:06:50.209924 (ThreadPoolExecutor-1_0): 10:06:50  Opening a new connection, currently in state closed
2022-02-11 10:06:50.439104 (Thread-26): handling poll request
2022-02-11 10:06:50.439475 (Thread-26): 10:06:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56503880a0>]}
2022-02-11 10:06:50.439982 (Thread-26): sending response (<Response 919 bytes [200 OK]>) to 10.0.13.131
2022-02-11 10:06:50.456147 (MainThread): 10:06:50  Concurrency: 4 threads (target='default')
2022-02-11 10:06:50.456331 (MainThread): 10:06:50  
2022-02-11 10:06:50.459167 (Thread-1): 10:06:50  Began running node model.my_new_project.customer_orders
2022-02-11 10:06:50.459464 (Thread-1): 10:06:50  1 of 6 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 10:06:50.459739 (Thread-1): 10:06:50  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 10:06:50.459835 (Thread-1): 10:06:50  Began compiling node model.my_new_project.customer_orders
2022-02-11 10:06:50.459926 (Thread-1): 10:06:50  Compiling model.my_new_project.customer_orders
2022-02-11 10:06:50.464250 (Thread-2): 10:06:50  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:06:50.464484 (Thread-2): 10:06:50  2 of 6 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 10:06:50.464752 (Thread-2): 10:06:50  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:06:50.464840 (Thread-2): 10:06:50  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:06:50.464921 (Thread-2): 10:06:50  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:06:50.467039 (Thread-2): 10:06:50  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:06:50.464071 (Thread-1): 10:06:50  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 10:06:50.467377 (Thread-3): 10:06:50  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:06:50.467591 (Thread-3): 10:06:50  3 of 6 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 10:06:50.467836 (Thread-3): 10:06:50  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:06:50.467921 (Thread-3): 10:06:50  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:06:50.467998 (Thread-3): 10:06:50  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:06:50.470102 (Thread-3): 10:06:50  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:06:50.470374 (Thread-4): 10:06:50  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 10:06:50.470640 (Thread-4): 10:06:50  4 of 6 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 10:06:50.470999 (Thread-4): 10:06:50  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 10:06:50.471119 (Thread-4): 10:06:50  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 10:06:50.471228 (Thread-4): 10:06:50  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 10:06:50.473495 (Thread-4): 10:06:50  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 10:06:50.514163 (Thread-1): 10:06:50  finished collecting timing info
2022-02-11 10:06:50.514391 (Thread-1): 10:06:50  Began executing node model.my_new_project.customer_orders
2022-02-11 10:06:50.519546 (Thread-2): 10:06:50  finished collecting timing info
2022-02-11 10:06:50.519724 (Thread-2): 10:06:50  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:06:50.524764 (Thread-4): 10:06:50  finished collecting timing info
2022-02-11 10:06:50.524914 (Thread-4): 10:06:50  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 10:06:50.540396 (Thread-3): 10:06:50  finished collecting timing info
2022-02-11 10:06:50.540550 (Thread-3): 10:06:50  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:06:50.581425 (Thread-1): 10:06:50  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 10:06:50.583418 (Thread-4): 10:06:50  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 10:06:50.584288 (Thread-3): 10:06:50  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:06:50.587683 (Thread-2): 10:06:50  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:06:50.631497 (Thread-2): 10:06:50  Opening a new connection, currently in state init
2022-02-11 10:06:50.635994 (Thread-2): 10:06:50  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 10:06:50.638176 (Thread-1): 10:06:50  Opening a new connection, currently in state closed
2022-02-11 10:06:50.640644 (Thread-4): 10:06:50  Opening a new connection, currently in state init
2022-02-11 10:06:50.640888 (Thread-3): 10:06:50  Opening a new connection, currently in state init
2022-02-11 10:06:50.642757 (Thread-1): 10:06:50  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 10:06:50.645299 (Thread-3): 10:06:50  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (
    
    select * from `dbt-tutorial`.`jaffle_shop`.`orders`
    
),

transformed as (
        
      select 
      
        id as order_id,
        user_id as customer_id,
        status as order_status,
        order_date,
        
        case 
            when order_status not in ('returned','return_pending') 
            then order_date 
        end as valid_order_date,
        
        row_number() over (
            partition by user_id 
            order by order_date, id
        ) as user_order_seq
        
      from source
    
)

select * from transformed;


2022-02-11 10:06:50.646359 (Thread-4): 10:06:50  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 10:06:51.601947 (Thread-3): 10:06:51  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: order_status at [24:18]')
2022-02-11 10:06:51.615235 (Thread-2): 10:06:51  finished collecting timing info
2022-02-11 10:06:51.615642 (Thread-2): 10:06:51  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df3276e3-6a1a-4a95-9f31-3e6852c6ab6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f76bc09d970>]}
2022-02-11 10:06:51.616119 (Thread-2): 10:06:51  2 of 6 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 1.15s]
2022-02-11 10:06:51.616239 (Thread-2): 10:06:51  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:06:51.660327 (Thread-4): 10:06:51  finished collecting timing info
2022-02-11 10:06:51.660707 (Thread-4): 10:06:51  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df3276e3-6a1a-4a95-9f31-3e6852c6ab6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f76bc140b20>]}
2022-02-11 10:06:51.661142 (Thread-4): 10:06:51  4 of 6 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 1.19s]
2022-02-11 10:06:51.661252 (Thread-4): 10:06:51  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 10:06:51.684309 (Thread-1): 10:06:51  finished collecting timing info
2022-02-11 10:06:51.684804 (Thread-1): 10:06:51  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df3276e3-6a1a-4a95-9f31-3e6852c6ab6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f76bc0f8ca0>]}
2022-02-11 10:06:51.685109 (Thread-1): 10:06:51  1 of 6 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.23s]
2022-02-11 10:06:51.685212 (Thread-1): 10:06:51  Finished running node model.my_new_project.customer_orders
2022-02-11 10:06:51.792491 (Thread-27): handling poll request
2022-02-11 10:06:51.792848 (Thread-27): 10:06:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56503ed5e0>]}
2022-02-11 10:06:51.794018 (Thread-27): sending response (<Response 29663 bytes [200 OK]>) to 10.0.40.216
2022-02-11 10:06:53.113178 (Thread-28): handling poll request
2022-02-11 10:06:53.113547 (Thread-28): 10:06:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56503e5610>]}
2022-02-11 10:06:53.114037 (Thread-28): sending response (<Response 286 bytes [200 OK]>) to 10.0.11.229
2022-02-11 10:06:53.164660 (Thread-3): 10:06:53  finished collecting timing info
2022-02-11 10:06:53.165255 (Thread-3): 10:06:53  Database Error in model stg_jaffle_shop__orders (models/staging/jaffle_shop/stg_jaffle_shop__orders.sql)
  Unrecognized name: order_status at [24:18]
  compiled SQL at target/run/my_new_project/models/staging/jaffle_shop/stg_jaffle_shop__orders.sql
2022-02-11 10:06:53.165512 (Thread-3): 10:06:53  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df3276e3-6a1a-4a95-9f31-3e6852c6ab6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f76bc112cd0>]}
2022-02-11 10:06:53.165955 (Thread-3): 10:06:53  3 of 6 ERROR creating view model dbt_luisscabral.stg_jaffle_shop__orders........ [ERROR in 2.70s]
2022-02-11 10:06:53.166110 (Thread-3): 10:06:53  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:06:53.167194 (Thread-2): 10:06:53  Began running node model.my_new_project.int_orders
2022-02-11 10:06:53.167363 (Thread-2): 10:06:53  5 of 6 SKIP relation dbt_luisscabral.int_orders................................. [SKIP]
2022-02-11 10:06:53.167472 (Thread-2): 10:06:53  Finished running node model.my_new_project.int_orders
2022-02-11 10:06:53.168450 (Thread-1): 10:06:53  Began running node model.my_new_project.fct_customer_orders
2022-02-11 10:06:53.168594 (Thread-1): 10:06:53  6 of 6 SKIP relation dbt_luisscabral.fct_customer_orders........................ [SKIP]
2022-02-11 10:06:53.168687 (Thread-1): 10:06:53  Finished running node model.my_new_project.fct_customer_orders
2022-02-11 10:06:53.170041 (MainThread): 10:06:53  Acquiring new bigquery connection "master"
2022-02-11 10:06:53.170385 (MainThread): 10:06:53  
2022-02-11 10:06:53.170481 (MainThread): 10:06:53  Finished running 6 view models in 4.26s.
2022-02-11 10:06:53.170562 (MainThread): 10:06:53  Connection 'master' was properly closed.
2022-02-11 10:06:53.170629 (MainThread): 10:06:53  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 10:06:53.170692 (MainThread): 10:06:53  Connection 'model.my_new_project.stg_jaffle_shop__customers' was properly closed.
2022-02-11 10:06:53.170753 (MainThread): 10:06:53  Connection 'model.my_new_project.stg_jaffle_shop__orders' was properly closed.
2022-02-11 10:06:53.170812 (MainThread): 10:06:53  Connection 'model.my_new_project.stg_stripe__payments' was properly closed.
2022-02-11 10:06:53.216943 (MainThread): 10:06:53  
2022-02-11 10:06:53.217148 (MainThread): 10:06:53  Completed with 1 error and 0 warnings:
2022-02-11 10:06:53.217239 (MainThread): 10:06:53  
2022-02-11 10:06:53.217328 (MainThread): 10:06:53  Database Error in model stg_jaffle_shop__orders (models/staging/jaffle_shop/stg_jaffle_shop__orders.sql)
2022-02-11 10:06:53.217404 (MainThread): 10:06:53    Unrecognized name: order_status at [24:18]
2022-02-11 10:06:53.217474 (MainThread): 10:06:53    compiled SQL at target/run/my_new_project/models/staging/jaffle_shop/stg_jaffle_shop__orders.sql
2022-02-11 10:06:53.217559 (MainThread): 10:06:53  
2022-02-11 10:06:53.217640 (MainThread): 10:06:53  Done. PASS=3 WARN=0 ERROR=1 SKIP=2 TOTAL=6
2022-02-11 10:06:54.470453 (Thread-29): handling poll request
2022-02-11 10:06:54.470998 (Thread-29): 10:06:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500feeb0>]}
2022-02-11 10:06:54.472804 (Thread-29): sending response (<Response 32942 bytes [200 OK]>) to 10.0.43.23
2022-02-11 10:06:55.194233 (Thread-30): handling status request
2022-02-11 10:06:55.194605 (Thread-30): 10:06:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500fe280>]}
2022-02-11 10:06:55.195660 (Thread-30): sending response (<Response 17499 bytes [200 OK]>) to 10.0.10.236
2022-02-11 10:06:55.414794 (Thread-31): handling status request
2022-02-11 10:06:55.415202 (Thread-31): 10:06:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500febb0>]}
2022-02-11 10:06:55.416109 (Thread-31): sending response (<Response 17499 bytes [200 OK]>) to 10.0.10.236
2022-02-11 10:06:56.050283 (Thread-32): handling status request
2022-02-11 10:06:56.050676 (Thread-32): 10:06:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500feb80>]}
2022-02-11 10:06:56.051806 (Thread-32): sending response (<Response 17477 bytes [200 OK]>) to 10.0.44.250
2022-02-11 10:06:56.057710 (Thread-33): handling list request
2022-02-11 10:06:56.058027 (Thread-33): 10:06:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56500fe5e0>]}
2022-02-11 10:06:56.094842 (Thread-33): 10:06:56  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565016b550>]}
2022-02-11 10:06:56.095276 (Thread-33): 10:06:56  Found 6 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 10:06:56.096472 (Thread-33): 10:06:56  The selection criterion '+1644573996200/__unsaved/Statement' does not match any nodes
2022-02-11 10:06:56.096688 (Thread-33): 10:06:56  The selection criterion '1.sql+' does not match any nodes
2022-02-11 10:06:56.096803 (Thread-33): 10:06:56  No nodes selected!
2022-02-11 10:06:56.098422 (Thread-33): sending response (<Response 2348 bytes [200 OK]>) to 10.0.44.250
2022-02-11 10:07:20.448665 (Thread-34): handling status request
2022-02-11 10:07:20.451071 (Thread-34): 10:07:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565015bee0>]}
2022-02-11 10:07:20.451987 (Thread-34): sending response (<Response 17477 bytes [200 OK]>) to 10.0.44.250
2022-02-11 10:07:20.461363 (Thread-35): handling list request
2022-02-11 10:07:20.461648 (Thread-35): 10:07:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565015b910>]}
2022-02-11 10:07:20.488813 (Thread-35): 10:07:20  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565016b190>]}
2022-02-11 10:07:20.512204 (Thread-35): 10:07:20  Found 6 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 10:07:20.517458 (Thread-35): sending response (<Response 3328 bytes [200 OK]>) to 10.0.44.250
2022-02-11 10:07:35.227110 (Thread-36): handling status request
2022-02-11 10:07:35.227501 (Thread-36): 10:07:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565016e880>]}
2022-02-11 10:07:35.228433 (Thread-36): sending response (<Response 17499 bytes [200 OK]>) to 10.0.40.216
2022-02-11 10:07:35.563478 (Thread-37): handling compile_sql request
2022-02-11 10:07:35.563876 (Thread-37): 10:07:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565016e310>]}
2022-02-11 10:07:37.741611 (Thread-37): sending response (<Response 138 bytes [200 OK]>) to 10.0.3.5
2022-02-11 10:07:37.768950 (MainThread): 10:07:37  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e01c8dbb-33ee-4eb8-a6d7-e7f5e3e0a0a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1af14c6ee0>]}
2022-02-11 10:07:37.769499 (MainThread): 10:07:37  Found 6 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 10:07:37.770082 (Thread-1): 10:07:37  Acquiring new bigquery connection "rpc.my_new_project.request"
2022-02-11 10:07:37.770351 (Thread-1): 10:07:37  Began compiling node rpc.my_new_project.request
2022-02-11 10:07:37.770467 (Thread-1): 10:07:37  Compiling rpc.my_new_project.request
2022-02-11 10:07:37.772535 (Thread-1): 10:07:37  finished collecting timing info
2022-02-11 10:07:37.772664 (Thread-1): 10:07:37  Began executing node rpc.my_new_project.request
2022-02-11 10:07:37.772763 (Thread-1): 10:07:37  finished collecting timing info
2022-02-11 10:07:38.086004 (Thread-38): handling poll request
2022-02-11 10:07:38.086448 (Thread-38): 10:07:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5650156a90>]}
2022-02-11 10:07:38.088230 (Thread-38): sending response (<Response 7671 bytes [200 OK]>) to 10.0.43.23
2022-02-11 10:08:11.192502 (Thread-39): 10:08:11  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 10:08:11.194918 (Thread-39): 10:08:11  Partial parsing: updated file: my_new_project://models/staging/jaffle_shop/stg_jaffle_shop__orders.sql
2022-02-11 10:08:11.199460 (Thread-39): 10:08:11  1699: static parser successfully parsed staging/jaffle_shop/stg_jaffle_shop__orders.sql
2022-02-11 10:08:11.241198 (Thread-39): 10:08:11  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 10:08:11.246901 (Thread-39): 10:08:11  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f562c050400>]}
2022-02-11 10:08:11.843386 (Thread-40): handling status request
2022-02-11 10:08:11.843846 (Thread-40): 10:08:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56503da730>]}
2022-02-11 10:08:11.844379 (Thread-40): sending response (<Response 2052 bytes [200 OK]>) to 10.0.5.75
2022-02-11 10:08:12.055434 (Thread-41): handling status request
2022-02-11 10:08:12.055817 (Thread-41): 10:08:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f562c0a1a30>]}
2022-02-11 10:08:12.056322 (Thread-41): sending response (<Response 2052 bytes [200 OK]>) to 10.0.13.131
2022-02-11 10:08:14.492463 (Thread-42): handling status request
2022-02-11 10:08:14.492881 (Thread-42): 10:08:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f562c0a18e0>]}
2022-02-11 10:08:14.493388 (Thread-42): sending response (<Response 2052 bytes [200 OK]>) to 10.0.46.69
2022-02-11 10:08:14.665155 (Thread-43): handling status request
2022-02-11 10:08:14.665553 (Thread-43): 10:08:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f562c0a16a0>]}
2022-02-11 10:08:14.666085 (Thread-43): sending response (<Response 2052 bytes [200 OK]>) to 10.0.31.57
2022-02-11 10:08:14.862917 (Thread-44): handling cli_args request
2022-02-11 10:08:14.863417 (Thread-44): 10:08:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56503e5be0>]}
2022-02-11 10:08:17.115154 (Thread-44): sending response (<Response 138 bytes [200 OK]>) to 10.0.46.69
2022-02-11 10:08:17.218578 (MainThread): 10:08:17  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 10:08:17.219117 (MainThread): 10:08:17  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 10:08:17.219769 (MainThread): 10:08:17  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 10:08:17.225643 (MainThread): 10:08:17  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f91b4a7d-ada2-467e-832d-9e2eab3c9c46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c0b32ea60>]}
2022-02-11 10:08:17.253021 (MainThread): 10:08:17  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f91b4a7d-ada2-467e-832d-9e2eab3c9c46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c0b39c400>]}
2022-02-11 10:08:17.253333 (MainThread): 10:08:17  Found 6 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 10:08:17.254591 (MainThread): 10:08:17  
2022-02-11 10:08:17.255086 (MainThread): 10:08:17  Acquiring new bigquery connection "master"
2022-02-11 10:08:17.256292 (ThreadPoolExecutor-0_0): 10:08:17  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 10:08:17.256443 (ThreadPoolExecutor-0_0): 10:08:17  Opening a new connection, currently in state init
2022-02-11 10:08:17.425144 (Thread-45): handling poll request
2022-02-11 10:08:17.425631 (Thread-45): 10:08:17  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565f4cb7c0>]}
2022-02-11 10:08:17.426559 (Thread-45): sending response (<Response 3781 bytes [200 OK]>) to 10.0.5.155
2022-02-11 10:08:17.589843 (ThreadPoolExecutor-1_0): 10:08:17  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 10:08:17.590038 (ThreadPoolExecutor-1_0): 10:08:17  Opening a new connection, currently in state closed
2022-02-11 10:08:17.896214 (MainThread): 10:08:17  Concurrency: 4 threads (target='default')
2022-02-11 10:08:17.896401 (MainThread): 10:08:17  
2022-02-11 10:08:17.899096 (Thread-1): 10:08:17  Began running node model.my_new_project.customer_orders
2022-02-11 10:08:17.899388 (Thread-1): 10:08:17  1 of 6 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 10:08:17.899673 (Thread-1): 10:08:17  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 10:08:17.899770 (Thread-1): 10:08:17  Began compiling node model.my_new_project.customer_orders
2022-02-11 10:08:17.899865 (Thread-1): 10:08:17  Compiling model.my_new_project.customer_orders
2022-02-11 10:08:17.904212 (Thread-2): 10:08:17  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:08:17.904467 (Thread-2): 10:08:17  2 of 6 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 10:08:17.904749 (Thread-2): 10:08:17  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:08:17.904854 (Thread-2): 10:08:17  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:08:17.904939 (Thread-2): 10:08:17  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:08:17.907293 (Thread-2): 10:08:17  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:08:17.903981 (Thread-1): 10:08:17  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 10:08:17.907620 (Thread-3): 10:08:17  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:08:17.907888 (Thread-3): 10:08:17  3 of 6 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 10:08:17.908173 (Thread-3): 10:08:17  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:08:17.908262 (Thread-3): 10:08:17  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:08:17.908343 (Thread-3): 10:08:17  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:08:17.910477 (Thread-3): 10:08:17  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:08:17.910707 (Thread-4): 10:08:17  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 10:08:17.910920 (Thread-4): 10:08:17  4 of 6 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 10:08:17.911182 (Thread-4): 10:08:17  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 10:08:17.911274 (Thread-4): 10:08:17  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 10:08:17.911351 (Thread-4): 10:08:17  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 10:08:17.913365 (Thread-4): 10:08:17  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 10:08:17.932222 (Thread-1): 10:08:17  finished collecting timing info
2022-02-11 10:08:17.932396 (Thread-1): 10:08:17  Began executing node model.my_new_project.customer_orders
2022-02-11 10:08:17.937357 (Thread-2): 10:08:17  finished collecting timing info
2022-02-11 10:08:17.937522 (Thread-2): 10:08:17  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:08:17.947717 (Thread-3): 10:08:17  finished collecting timing info
2022-02-11 10:08:17.947934 (Thread-3): 10:08:17  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:08:17.987941 (Thread-1): 10:08:17  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 10:08:17.991618 (Thread-3): 10:08:17  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:08:17.991930 (Thread-4): 10:08:17  finished collecting timing info
2022-02-11 10:08:17.992083 (Thread-4): 10:08:17  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 10:08:17.994178 (Thread-4): 10:08:17  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 10:08:17.995765 (Thread-2): 10:08:17  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:08:18.006052 (Thread-1): 10:08:18  Opening a new connection, currently in state closed
2022-02-11 10:08:18.010601 (Thread-1): 10:08:18  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 10:08:18.011447 (Thread-2): 10:08:18  Opening a new connection, currently in state init
2022-02-11 10:08:18.011692 (Thread-4): 10:08:18  Opening a new connection, currently in state init
2022-02-11 10:08:18.012298 (Thread-3): 10:08:18  Opening a new connection, currently in state init
2022-02-11 10:08:18.016206 (Thread-4): 10:08:18  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 10:08:18.018419 (Thread-2): 10:08:18  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 10:08:18.021203 (Thread-3): 10:08:18  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (
    
    select * from `dbt-tutorial`.`jaffle_shop`.`orders`
    
),

transformed as (
        
      select 
      
        id as order_id,
        user_id as customer_id,
        status as order_status,
        order_date,
        
        case 
            when status not in ('returned','return_pending') 
            then order_date 
        end as valid_order_date,
        
        row_number() over (
            partition by user_id 
            order by order_date, id
        ) as user_order_seq
        
      from source
    
)

select * from transformed;


2022-02-11 10:08:18.893090 (Thread-4): 10:08:18  finished collecting timing info
2022-02-11 10:08:18.893745 (Thread-4): 10:08:18  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f91b4a7d-ada2-467e-832d-9e2eab3c9c46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c08176550>]}
2022-02-11 10:08:18.894413 (Thread-4): 10:08:18  4 of 6 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 0.98s]
2022-02-11 10:08:18.894616 (Thread-4): 10:08:18  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 10:08:18.898794 (Thread-46): handling poll request
2022-02-11 10:08:18.899139 (Thread-46): 10:08:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565006e1c0>]}
2022-02-11 10:08:18.900218 (Thread-46): sending response (<Response 26231 bytes [200 OK]>) to 10.0.46.69
2022-02-11 10:08:18.930110 (Thread-3): 10:08:18  finished collecting timing info
2022-02-11 10:08:18.930546 (Thread-3): 10:08:18  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f91b4a7d-ada2-467e-832d-9e2eab3c9c46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c081df130>]}
2022-02-11 10:08:18.930921 (Thread-3): 10:08:18  3 of 6 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 1.02s]
2022-02-11 10:08:18.931043 (Thread-3): 10:08:18  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:08:18.931863 (Thread-4): 10:08:18  Began running node model.my_new_project.int_orders
2022-02-11 10:08:18.932108 (Thread-4): 10:08:18  5 of 6 START view model dbt_luisscabral.int_orders.............................. [RUN]
2022-02-11 10:08:18.932349 (Thread-4): 10:08:18  Acquiring new bigquery connection "model.my_new_project.int_orders"
2022-02-11 10:08:18.932442 (Thread-4): 10:08:18  Began compiling node model.my_new_project.int_orders
2022-02-11 10:08:18.932529 (Thread-4): 10:08:18  Compiling model.my_new_project.int_orders
2022-02-11 10:08:18.935038 (Thread-4): 10:08:18  Writing injected SQL for node "model.my_new_project.int_orders"
2022-02-11 10:08:18.952789 (Thread-4): 10:08:18  finished collecting timing info
2022-02-11 10:08:18.952968 (Thread-4): 10:08:18  Began executing node model.my_new_project.int_orders
2022-02-11 10:08:18.955318 (Thread-4): 10:08:18  Writing runtime SQL for node "model.my_new_project.int_orders"
2022-02-11 10:08:18.974693 (Thread-4): 10:08:18  Opening a new connection, currently in state closed
2022-02-11 10:08:18.979505 (Thread-4): 10:08:18  On model.my_new_project.int_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.int_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`int_orders`
  OPTIONS()
  as with

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
    where payment_status != 'fail'

),

order_totals as (

    select

        order_id,
        payment_status,
        sum(payment_amount_usd) as order_value_dollars

    from payments
    group by 1, 2

),

joined as (

    select

        orders.*,
        order_totals.payment_status,
        order_totals.order_value_dollars

    from orders 
    left join order_totals
        on orders.order_id = order_totals.order_id

)

select * from joined;


2022-02-11 10:08:19.036586 (Thread-2): 10:08:19  finished collecting timing info
2022-02-11 10:08:19.037117 (Thread-2): 10:08:19  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f91b4a7d-ada2-467e-832d-9e2eab3c9c46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c0816b490>]}
2022-02-11 10:08:19.037507 (Thread-2): 10:08:19  2 of 6 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 1.13s]
2022-02-11 10:08:19.037656 (Thread-2): 10:08:19  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:08:19.145330 (Thread-1): 10:08:19  finished collecting timing info
2022-02-11 10:08:19.145829 (Thread-1): 10:08:19  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f91b4a7d-ada2-467e-832d-9e2eab3c9c46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c081df5b0>]}
2022-02-11 10:08:19.146205 (Thread-1): 10:08:19  1 of 6 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.25s]
2022-02-11 10:08:19.146328 (Thread-1): 10:08:19  Finished running node model.my_new_project.customer_orders
2022-02-11 10:08:19.957676 (Thread-4): 10:08:19  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: payment_amount_usd; Did you mean payment_amount? at [27:13]')
2022-02-11 10:08:20.237703 (Thread-47): handling poll request
2022-02-11 10:08:20.238086 (Thread-47): 10:08:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f562c033a60>]}
2022-02-11 10:08:20.238815 (Thread-47): sending response (<Response 11472 bytes [200 OK]>) to 10.0.18.228
2022-02-11 10:08:21.566752 (Thread-48): handling poll request
2022-02-11 10:08:21.567157 (Thread-48): 10:08:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f562c033c10>]}
2022-02-11 10:08:21.567645 (Thread-48): sending response (<Response 286 bytes [200 OK]>) to 10.0.31.57
2022-02-11 10:08:21.829746 (Thread-4): 10:08:21  finished collecting timing info
2022-02-11 10:08:21.830210 (Thread-4): 10:08:21  Database Error in model int_orders (models/marts/int_orders.sql)
  Unrecognized name: payment_amount_usd; Did you mean payment_amount? at [27:13]
  compiled SQL at target/run/my_new_project/models/marts/int_orders.sql
2022-02-11 10:08:21.830432 (Thread-4): 10:08:21  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f91b4a7d-ada2-467e-832d-9e2eab3c9c46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c0817c880>]}
2022-02-11 10:08:21.830815 (Thread-4): 10:08:21  5 of 6 ERROR creating view model dbt_luisscabral.int_orders..................... [ERROR in 2.90s]
2022-02-11 10:08:21.830976 (Thread-4): 10:08:21  Finished running node model.my_new_project.int_orders
2022-02-11 10:08:21.832066 (Thread-3): 10:08:21  Began running node model.my_new_project.fct_customer_orders
2022-02-11 10:08:21.832246 (Thread-3): 10:08:21  6 of 6 SKIP relation dbt_luisscabral.fct_customer_orders........................ [SKIP]
2022-02-11 10:08:21.832353 (Thread-3): 10:08:21  Finished running node model.my_new_project.fct_customer_orders
2022-02-11 10:08:21.833879 (MainThread): 10:08:21  Acquiring new bigquery connection "master"
2022-02-11 10:08:21.834326 (MainThread): 10:08:21  
2022-02-11 10:08:21.834470 (MainThread): 10:08:21  Finished running 6 view models in 4.58s.
2022-02-11 10:08:21.834593 (MainThread): 10:08:21  Connection 'master' was properly closed.
2022-02-11 10:08:21.834713 (MainThread): 10:08:21  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 10:08:21.834816 (MainThread): 10:08:21  Connection 'model.my_new_project.stg_jaffle_shop__customers' was properly closed.
2022-02-11 10:08:21.834947 (MainThread): 10:08:21  Connection 'model.my_new_project.stg_jaffle_shop__orders' was properly closed.
2022-02-11 10:08:21.835051 (MainThread): 10:08:21  Connection 'model.my_new_project.int_orders' was properly closed.
2022-02-11 10:08:21.893099 (MainThread): 10:08:21  
2022-02-11 10:08:21.893334 (MainThread): 10:08:21  Completed with 1 error and 0 warnings:
2022-02-11 10:08:21.893431 (MainThread): 10:08:21  
2022-02-11 10:08:21.893524 (MainThread): 10:08:21  Database Error in model int_orders (models/marts/int_orders.sql)
2022-02-11 10:08:21.893602 (MainThread): 10:08:21    Unrecognized name: payment_amount_usd; Did you mean payment_amount? at [27:13]
2022-02-11 10:08:21.893673 (MainThread): 10:08:21    compiled SQL at target/run/my_new_project/models/marts/int_orders.sql
2022-02-11 10:08:21.893756 (MainThread): 10:08:21  
2022-02-11 10:08:21.893840 (MainThread): 10:08:21  Done. PASS=4 WARN=0 ERROR=1 SKIP=1 TOTAL=6
2022-02-11 10:08:22.920148 (Thread-49): handling poll request
2022-02-11 10:08:22.920602 (Thread-49): 10:08:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f562c068280>]}
2022-02-11 10:08:22.922095 (Thread-49): sending response (<Response 32458 bytes [200 OK]>) to 10.0.31.57
2022-02-11 10:08:23.869393 (Thread-50): handling status request
2022-02-11 10:08:23.869780 (Thread-50): 10:08:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565005bee0>]}
2022-02-11 10:08:23.870308 (Thread-50): sending response (<Response 2052 bytes [200 OK]>) to 10.0.5.75
2022-02-11 10:08:23.901052 (Thread-51): handling status request
2022-02-11 10:08:23.901397 (Thread-51): 10:08:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f565005b880>]}
2022-02-11 10:08:23.901860 (Thread-51): sending response (<Response 2052 bytes [200 OK]>) to 10.0.10.236
2022-02-11 10:09:00.321978 (Thread-52): 10:09:00  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 10:09:00.322661 (Thread-52): 10:09:00  Partial parsing: updated file: my_new_project://models/marts/int_orders.sql
2022-02-11 10:09:00.329922 (Thread-52): 10:09:00  1699: static parser successfully parsed marts/int_orders.sql
2022-02-11 10:09:00.379117 (Thread-52): 10:09:00  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 10:09:00.384594 (Thread-52): 10:09:00  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f562c0a9a90>]}
2022-02-11 10:09:01.157898 (Thread-53): handling status request
2022-02-11 10:09:01.158307 (Thread-53): 10:09:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56503d59d0>]}
2022-02-11 10:09:01.158835 (Thread-53): sending response (<Response 1998 bytes [200 OK]>) to 10.0.40.216
2022-02-11 10:09:01.237303 (Thread-54): handling status request
2022-02-11 10:09:01.237795 (Thread-54): 10:09:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e53b62e0>]}
2022-02-11 10:09:01.238478 (Thread-54): sending response (<Response 1998 bytes [200 OK]>) to 10.0.31.57
2022-02-11 10:09:11.258236 (Thread-55): handling status request
2022-02-11 10:09:11.258619 (Thread-55): 10:09:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e53b60a0>]}
2022-02-11 10:09:11.259147 (Thread-55): sending response (<Response 1998 bytes [200 OK]>) to 10.0.18.228
2022-02-11 10:09:11.532839 (Thread-56): handling status request
2022-02-11 10:09:11.533211 (Thread-56): 10:09:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f562c04ce50>]}
2022-02-11 10:09:11.533700 (Thread-56): sending response (<Response 1998 bytes [200 OK]>) to 10.0.18.228
2022-02-11 10:09:11.590977 (Thread-57): handling cli_args request
2022-02-11 10:09:11.591278 (Thread-57): 10:09:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e53b9a00>]}
2022-02-11 10:09:13.774737 (Thread-57): sending response (<Response 138 bytes [200 OK]>) to 10.0.3.5
2022-02-11 10:09:13.885595 (MainThread): 10:09:13  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 10:09:13.886119 (MainThread): 10:09:13  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 10:09:13.886751 (MainThread): 10:09:13  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 10:09:13.893148 (MainThread): 10:09:13  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '522091ab-9262-4cb5-8f18-1b2acbbffa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c779df9d0>]}
2022-02-11 10:09:13.927895 (MainThread): 10:09:13  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '522091ab-9262-4cb5-8f18-1b2acbbffa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c77a483a0>]}
2022-02-11 10:09:13.928182 (MainThread): 10:09:13  Found 6 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 10:09:13.929368 (MainThread): 10:09:13  
2022-02-11 10:09:13.929677 (MainThread): 10:09:13  Acquiring new bigquery connection "master"
2022-02-11 10:09:13.930902 (ThreadPoolExecutor-0_0): 10:09:13  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 10:09:13.931062 (ThreadPoolExecutor-0_0): 10:09:13  Opening a new connection, currently in state init
2022-02-11 10:09:14.155050 (Thread-58): handling poll request
2022-02-11 10:09:14.155504 (Thread-58): 10:09:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f562c0a9820>]}
2022-02-11 10:09:14.156382 (Thread-58): sending response (<Response 3781 bytes [200 OK]>) to 10.0.38.212
2022-02-11 10:09:14.209672 (ThreadPoolExecutor-1_0): 10:09:14  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 10:09:14.209866 (ThreadPoolExecutor-1_0): 10:09:14  Opening a new connection, currently in state closed
2022-02-11 10:09:14.398021 (MainThread): 10:09:14  Concurrency: 4 threads (target='default')
2022-02-11 10:09:14.398189 (MainThread): 10:09:14  
2022-02-11 10:09:14.400953 (Thread-1): 10:09:14  Began running node model.my_new_project.customer_orders
2022-02-11 10:09:14.401264 (Thread-1): 10:09:14  1 of 6 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 10:09:14.401537 (Thread-1): 10:09:14  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 10:09:14.401639 (Thread-1): 10:09:14  Began compiling node model.my_new_project.customer_orders
2022-02-11 10:09:14.401737 (Thread-1): 10:09:14  Compiling model.my_new_project.customer_orders
2022-02-11 10:09:14.406025 (Thread-2): 10:09:14  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:09:14.406283 (Thread-2): 10:09:14  2 of 6 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 10:09:14.406553 (Thread-2): 10:09:14  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:09:14.406645 (Thread-2): 10:09:14  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:09:14.406745 (Thread-2): 10:09:14  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:09:14.408920 (Thread-2): 10:09:14  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:09:14.409021 (Thread-1): 10:09:14  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 10:09:14.409250 (Thread-3): 10:09:14  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:09:14.409453 (Thread-3): 10:09:14  3 of 6 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 10:09:14.409718 (Thread-3): 10:09:14  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:09:14.409817 (Thread-3): 10:09:14  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:09:14.409926 (Thread-3): 10:09:14  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:09:14.412037 (Thread-3): 10:09:14  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:09:14.412317 (Thread-4): 10:09:14  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 10:09:14.412531 (Thread-4): 10:09:14  4 of 6 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 10:09:14.412776 (Thread-4): 10:09:14  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 10:09:14.412863 (Thread-4): 10:09:14  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 10:09:14.412942 (Thread-4): 10:09:14  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 10:09:14.414979 (Thread-4): 10:09:14  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 10:09:14.428045 (Thread-2): 10:09:14  finished collecting timing info
2022-02-11 10:09:14.428192 (Thread-2): 10:09:14  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:09:14.433143 (Thread-1): 10:09:14  finished collecting timing info
2022-02-11 10:09:14.433271 (Thread-1): 10:09:14  Began executing node model.my_new_project.customer_orders
2022-02-11 10:09:14.448641 (Thread-4): 10:09:14  finished collecting timing info
2022-02-11 10:09:14.448777 (Thread-4): 10:09:14  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 10:09:14.477370 (Thread-1): 10:09:14  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 10:09:14.477797 (Thread-4): 10:09:14  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 10:09:14.478017 (Thread-3): 10:09:14  finished collecting timing info
2022-02-11 10:09:14.478158 (Thread-3): 10:09:14  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:09:14.481232 (Thread-3): 10:09:14  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:09:14.483165 (Thread-2): 10:09:14  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:09:14.499416 (Thread-4): 10:09:14  Opening a new connection, currently in state init
2022-02-11 10:09:14.499714 (Thread-1): 10:09:14  Opening a new connection, currently in state closed
2022-02-11 10:09:14.499929 (Thread-3): 10:09:14  Opening a new connection, currently in state init
2022-02-11 10:09:14.500359 (Thread-2): 10:09:14  Opening a new connection, currently in state init
2022-02-11 10:09:14.504809 (Thread-2): 10:09:14  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 10:09:14.505884 (Thread-4): 10:09:14  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 10:09:14.508636 (Thread-3): 10:09:14  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (
    
    select * from `dbt-tutorial`.`jaffle_shop`.`orders`
    
),

transformed as (
        
      select 
      
        id as order_id,
        user_id as customer_id,
        status as order_status,
        order_date,
        
        case 
            when status not in ('returned','return_pending') 
            then order_date 
        end as valid_order_date,
        
        row_number() over (
            partition by user_id 
            order by order_date, id
        ) as user_order_seq
        
      from source
    
)

select * from transformed;


2022-02-11 10:09:14.509900 (Thread-1): 10:09:14  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 10:09:15.386954 (Thread-2): 10:09:15  finished collecting timing info
2022-02-11 10:09:15.387397 (Thread-2): 10:09:15  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '522091ab-9262-4cb5-8f18-1b2acbbffa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c74090220>]}
2022-02-11 10:09:15.387742 (Thread-2): 10:09:15  2 of 6 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 0.98s]
2022-02-11 10:09:15.387860 (Thread-2): 10:09:15  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:09:15.436667 (Thread-1): 10:09:15  finished collecting timing info
2022-02-11 10:09:15.437213 (Thread-1): 10:09:15  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '522091ab-9262-4cb5-8f18-1b2acbbffa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c7405a070>]}
2022-02-11 10:09:15.437547 (Thread-1): 10:09:15  1 of 6 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.04s]
2022-02-11 10:09:15.437658 (Thread-1): 10:09:15  Finished running node model.my_new_project.customer_orders
2022-02-11 10:09:15.440431 (Thread-4): 10:09:15  finished collecting timing info
2022-02-11 10:09:15.440769 (Thread-4): 10:09:15  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '522091ab-9262-4cb5-8f18-1b2acbbffa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c768c7f40>]}
2022-02-11 10:09:15.441056 (Thread-4): 10:09:15  4 of 6 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 1.03s]
2022-02-11 10:09:15.441164 (Thread-4): 10:09:15  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 10:09:15.482977 (Thread-59): handling poll request
2022-02-11 10:09:15.483304 (Thread-59): 10:09:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e53b79a0>]}
2022-02-11 10:09:15.484386 (Thread-59): sending response (<Response 29882 bytes [200 OK]>) to 10.0.10.236
2022-02-11 10:09:15.486487 (Thread-3): 10:09:15  finished collecting timing info
2022-02-11 10:09:15.486881 (Thread-3): 10:09:15  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '522091ab-9262-4cb5-8f18-1b2acbbffa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c577c3ee0>]}
2022-02-11 10:09:15.487184 (Thread-3): 10:09:15  3 of 6 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 1.08s]
2022-02-11 10:09:15.487294 (Thread-3): 10:09:15  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:09:15.488189 (Thread-2): 10:09:15  Began running node model.my_new_project.int_orders
2022-02-11 10:09:15.488406 (Thread-2): 10:09:15  5 of 6 START view model dbt_luisscabral.int_orders.............................. [RUN]
2022-02-11 10:09:15.488643 (Thread-2): 10:09:15  Acquiring new bigquery connection "model.my_new_project.int_orders"
2022-02-11 10:09:15.488736 (Thread-2): 10:09:15  Began compiling node model.my_new_project.int_orders
2022-02-11 10:09:15.488823 (Thread-2): 10:09:15  Compiling model.my_new_project.int_orders
2022-02-11 10:09:15.491721 (Thread-2): 10:09:15  Writing injected SQL for node "model.my_new_project.int_orders"
2022-02-11 10:09:15.509637 (Thread-2): 10:09:15  finished collecting timing info
2022-02-11 10:09:15.509786 (Thread-2): 10:09:15  Began executing node model.my_new_project.int_orders
2022-02-11 10:09:15.511811 (Thread-2): 10:09:15  Writing runtime SQL for node "model.my_new_project.int_orders"
2022-02-11 10:09:15.529710 (Thread-2): 10:09:15  Opening a new connection, currently in state closed
2022-02-11 10:09:15.534014 (Thread-2): 10:09:15  On model.my_new_project.int_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.int_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`int_orders`
  OPTIONS()
  as with

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
    where payment_status != 'fail'

),

order_totals as (

    select

        order_id,
        payment_status,
        sum(payment_amount) as order_value_dollars

    from payments
    group by 1, 2

),

joined as (

    select

        orders.*,
        order_totals.payment_status,
        order_totals.order_value_dollars

    from orders 
    left join order_totals
        on orders.order_id = order_totals.order_id

)

select * from joined;


2022-02-11 10:09:16.241465 (Thread-2): 10:09:16  finished collecting timing info
2022-02-11 10:09:16.241924 (Thread-2): 10:09:16  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '522091ab-9262-4cb5-8f18-1b2acbbffa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c577dbe80>]}
2022-02-11 10:09:16.242427 (Thread-2): 10:09:16  5 of 6 OK created view model dbt_luisscabral.int_orders......................... [OK in 0.75s]
2022-02-11 10:09:16.242550 (Thread-2): 10:09:16  Finished running node model.my_new_project.int_orders
2022-02-11 10:09:16.243446 (Thread-4): 10:09:16  Began running node model.my_new_project.fct_customer_orders
2022-02-11 10:09:16.243703 (Thread-4): 10:09:16  6 of 6 START view model dbt_luisscabral.fct_customer_orders..................... [RUN]
2022-02-11 10:09:16.243948 (Thread-4): 10:09:16  Acquiring new bigquery connection "model.my_new_project.fct_customer_orders"
2022-02-11 10:09:16.244049 (Thread-4): 10:09:16  Began compiling node model.my_new_project.fct_customer_orders
2022-02-11 10:09:16.244140 (Thread-4): 10:09:16  Compiling model.my_new_project.fct_customer_orders
2022-02-11 10:09:16.247084 (Thread-4): 10:09:16  Writing injected SQL for node "model.my_new_project.fct_customer_orders"
2022-02-11 10:09:16.258940 (Thread-4): 10:09:16  finished collecting timing info
2022-02-11 10:09:16.259096 (Thread-4): 10:09:16  Began executing node model.my_new_project.fct_customer_orders
2022-02-11 10:09:16.261202 (Thread-4): 10:09:16  Writing runtime SQL for node "model.my_new_project.fct_customer_orders"
2022-02-11 10:09:16.272461 (Thread-4): 10:09:16  Opening a new connection, currently in state closed
2022-02-11 10:09:16.276797 (Thread-4): 10:09:16  On model.my_new_project.fct_customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customer_orders`
  OPTIONS()
  as with

customers as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`

),

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`int_orders`

),

final as (

    select

        orders.*,

        customers.surname,
        customers.givenname,

        -- Customer-level aggregations
        min(orders.order_date) over(
            partition by orders.customer_id
        ) as first_order_date,

        min(orders.valid_order_date) over(
            partition by orders.customer_id
        ) as first_non_returned_order_date,

        max(orders.valid_order_date) over(
            partition by orders.customer_id
        ) as most_recent_non_returned_order_date,

        count(*) over(
            partition by orders.customer_id
        ) as order_count,

        sum(nvl2(orders.valid_order_date, 1, 0)) over(
            partition by orders.customer_id
        ) as non_returned_order_count,

        array_agg(distinct orders.order_id) over(
            partition by orders.customer_id
        ) as order_ids,

        sum(nvl2(orders.valid_order_date, orders.order_value_dollars, 0)) over(
            partition by orders.customer_id
        ) as total_lifetime_value

    from orders
    inner join customers
        on orders.customer_id = customers.customer_id

)

select * from final;


2022-02-11 10:09:16.809162 (Thread-60): handling poll request
2022-02-11 10:09:16.809587 (Thread-60): 10:09:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e53587f0>]}
2022-02-11 10:09:16.810377 (Thread-60): sending response (<Response 15347 bytes [200 OK]>) to 10.0.5.155
2022-02-11 10:09:17.129311 (Thread-4): 10:09:17  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Function not found: nvl2 at [46:13]')
2022-02-11 10:09:17.879734 (Thread-4): 10:09:17  finished collecting timing info
2022-02-11 10:09:17.880190 (Thread-4): 10:09:17  Database Error in model fct_customer_orders (models/marts/fct_customer_orders.sql)
  Function not found: nvl2 at [46:13]
  compiled SQL at target/run/my_new_project/models/marts/fct_customer_orders.sql
2022-02-11 10:09:17.880388 (Thread-4): 10:09:17  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '522091ab-9262-4cb5-8f18-1b2acbbffa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c577a5640>]}
2022-02-11 10:09:17.880884 (Thread-4): 10:09:17  6 of 6 ERROR creating view model dbt_luisscabral.fct_customer_orders............ [ERROR in 1.64s]
2022-02-11 10:09:17.881007 (Thread-4): 10:09:17  Finished running node model.my_new_project.fct_customer_orders
2022-02-11 10:09:17.882630 (MainThread): 10:09:17  Acquiring new bigquery connection "master"
2022-02-11 10:09:17.882998 (MainThread): 10:09:17  
2022-02-11 10:09:17.883105 (MainThread): 10:09:17  Finished running 6 view models in 3.95s.
2022-02-11 10:09:17.883232 (MainThread): 10:09:17  Connection 'master' was properly closed.
2022-02-11 10:09:17.883307 (MainThread): 10:09:17  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 10:09:17.883375 (MainThread): 10:09:17  Connection 'model.my_new_project.int_orders' was properly closed.
2022-02-11 10:09:17.883440 (MainThread): 10:09:17  Connection 'model.my_new_project.stg_jaffle_shop__orders' was properly closed.
2022-02-11 10:09:17.883504 (MainThread): 10:09:17  Connection 'model.my_new_project.fct_customer_orders' was properly closed.
2022-02-11 10:09:17.938564 (MainThread): 10:09:17  
2022-02-11 10:09:17.938771 (MainThread): 10:09:17  Completed with 1 error and 0 warnings:
2022-02-11 10:09:17.938894 (MainThread): 10:09:17  
2022-02-11 10:09:17.938995 (MainThread): 10:09:17  Database Error in model fct_customer_orders (models/marts/fct_customer_orders.sql)
2022-02-11 10:09:17.939078 (MainThread): 10:09:17    Function not found: nvl2 at [46:13]
2022-02-11 10:09:17.939150 (MainThread): 10:09:17    compiled SQL at target/run/my_new_project/models/marts/fct_customer_orders.sql
2022-02-11 10:09:17.939236 (MainThread): 10:09:17  
2022-02-11 10:09:17.939320 (MainThread): 10:09:17  Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
2022-02-11 10:09:18.140401 (Thread-61): handling poll request
2022-02-11 10:09:18.140790 (Thread-61): 10:09:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e537d610>]}
2022-02-11 10:09:18.142222 (Thread-61): sending response (<Response 33249 bytes [200 OK]>) to 10.0.31.57
2022-02-11 10:09:19.155169 (Thread-62): handling status request
2022-02-11 10:09:19.155552 (Thread-62): 10:09:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e533d280>]}
2022-02-11 10:09:19.156079 (Thread-62): sending response (<Response 1998 bytes [200 OK]>) to 10.0.5.155
2022-02-11 10:09:19.423836 (Thread-63): handling status request
2022-02-11 10:09:19.424216 (Thread-63): 10:09:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e533dfd0>]}
2022-02-11 10:09:19.424714 (Thread-63): sending response (<Response 1998 bytes [200 OK]>) to 10.0.30.21
2022-02-11 10:14:24.695653 (Thread-64): 10:14:24  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 10:14:24.697941 (Thread-64): 10:14:24  Partial parsing: updated file: my_new_project://models/marts/fct_customer_orders.sql
2022-02-11 10:14:24.702487 (Thread-64): 10:14:24  1699: static parser successfully parsed marts/fct_customer_orders.sql
2022-02-11 10:14:24.745413 (Thread-64): 10:14:24  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 10:14:24.750771 (Thread-64): 10:14:24  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e529c640>]}
2022-02-11 10:14:25.202450 (Thread-65): handling status request
2022-02-11 10:14:25.202828 (Thread-65): 10:14:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f562c0a9250>]}
2022-02-11 10:14:25.225344 (Thread-65): sending response (<Response 2016 bytes [200 OK]>) to 10.0.43.23
2022-02-11 10:14:25.419106 (Thread-66): handling status request
2022-02-11 10:14:25.419527 (Thread-66): 10:14:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f562c0a9d90>]}
2022-02-11 10:14:25.420046 (Thread-66): sending response (<Response 2016 bytes [200 OK]>) to 10.0.31.57
2022-02-11 10:14:40.701516 (Thread-67): 10:14:40  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 10:14:40.701932 (Thread-67): 10:14:40  Partial parsing: updated file: my_new_project://models/marts/fct_customer_orders.sql
2022-02-11 10:14:40.706105 (Thread-67): 10:14:40  1699: static parser successfully parsed marts/fct_customer_orders.sql
2022-02-11 10:14:40.744029 (Thread-67): 10:14:40  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 10:14:40.749620 (Thread-67): 10:14:40  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e522ba30>]}
2022-02-11 10:14:41.258047 (Thread-68): handling status request
2022-02-11 10:14:41.258443 (Thread-68): 10:14:41  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e53b80d0>]}
2022-02-11 10:14:41.258974 (Thread-68): sending response (<Response 2016 bytes [200 OK]>) to 10.0.13.131
2022-02-11 10:14:41.432281 (Thread-69): handling status request
2022-02-11 10:14:41.432686 (Thread-69): 10:14:41  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e53b8160>]}
2022-02-11 10:14:41.433192 (Thread-69): sending response (<Response 2016 bytes [200 OK]>) to 10.0.44.113
2022-02-11 10:14:48.767920 (Thread-70): handling status request
2022-02-11 10:14:48.768318 (Thread-70): 10:14:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e537d7c0>]}
2022-02-11 10:14:48.768849 (Thread-70): sending response (<Response 2016 bytes [200 OK]>) to 10.0.11.229
2022-02-11 10:14:49.076165 (Thread-71): handling status request
2022-02-11 10:14:49.076562 (Thread-71): 10:14:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e537d310>]}
2022-02-11 10:14:49.077189 (Thread-71): sending response (<Response 2016 bytes [200 OK]>) to 10.0.38.212
2022-02-11 10:14:49.078294 (Thread-72): handling cli_args request
2022-02-11 10:14:49.078616 (Thread-72): 10:14:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e537d730>]}
2022-02-11 10:14:51.219837 (Thread-72): sending response (<Response 138 bytes [200 OK]>) to 10.0.10.236
2022-02-11 10:14:51.319341 (MainThread): 10:14:51  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 10:14:51.319836 (MainThread): 10:14:51  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 10:14:51.320430 (MainThread): 10:14:51  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 10:14:51.325962 (MainThread): 10:14:51  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7cb97608-3b8a-4e69-b425-aaa8547fdd3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa545a7a8b0>]}
2022-02-11 10:14:51.353197 (MainThread): 10:14:51  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7cb97608-3b8a-4e69-b425-aaa8547fdd3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa545b0cfd0>]}
2022-02-11 10:14:51.353462 (MainThread): 10:14:51  Found 6 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 10:14:51.354646 (MainThread): 10:14:51  
2022-02-11 10:14:51.354993 (MainThread): 10:14:51  Acquiring new bigquery connection "master"
2022-02-11 10:14:51.356158 (ThreadPoolExecutor-0_0): 10:14:51  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 10:14:51.356309 (ThreadPoolExecutor-0_0): 10:14:51  Opening a new connection, currently in state init
2022-02-11 10:14:51.512701 (Thread-73): handling poll request
2022-02-11 10:14:51.513163 (Thread-73): 10:14:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e537d490>]}
2022-02-11 10:14:51.514058 (Thread-73): sending response (<Response 3781 bytes [200 OK]>) to 10.0.5.155
2022-02-11 10:14:51.680737 (ThreadPoolExecutor-1_0): 10:14:51  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 10:14:51.680926 (ThreadPoolExecutor-1_0): 10:14:51  Opening a new connection, currently in state closed
2022-02-11 10:14:51.935637 (MainThread): 10:14:51  Concurrency: 4 threads (target='default')
2022-02-11 10:14:51.935805 (MainThread): 10:14:51  
2022-02-11 10:14:51.938486 (Thread-1): 10:14:51  Began running node model.my_new_project.customer_orders
2022-02-11 10:14:51.938775 (Thread-1): 10:14:51  1 of 6 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 10:14:51.939079 (Thread-1): 10:14:51  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 10:14:51.939179 (Thread-1): 10:14:51  Began compiling node model.my_new_project.customer_orders
2022-02-11 10:14:51.939276 (Thread-1): 10:14:51  Compiling model.my_new_project.customer_orders
2022-02-11 10:14:51.943329 (Thread-1): 10:14:51  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 10:14:51.943675 (Thread-2): 10:14:51  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:14:51.943918 (Thread-2): 10:14:51  2 of 6 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 10:14:51.944173 (Thread-2): 10:14:51  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:14:51.944257 (Thread-2): 10:14:51  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:14:51.944381 (Thread-2): 10:14:51  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:14:51.946705 (Thread-2): 10:14:51  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:14:51.947452 (Thread-3): 10:14:51  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:14:51.947683 (Thread-3): 10:14:51  3 of 6 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 10:14:51.947934 (Thread-3): 10:14:51  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:14:51.948023 (Thread-3): 10:14:51  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:14:51.948106 (Thread-3): 10:14:51  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:14:51.950277 (Thread-3): 10:14:51  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:14:51.950535 (Thread-4): 10:14:51  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 10:14:51.950762 (Thread-4): 10:14:51  4 of 6 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 10:14:51.951051 (Thread-4): 10:14:51  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 10:14:51.951140 (Thread-4): 10:14:51  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 10:14:51.951218 (Thread-4): 10:14:51  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 10:14:51.953252 (Thread-4): 10:14:51  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 10:14:51.962448 (Thread-2): 10:14:51  finished collecting timing info
2022-02-11 10:14:51.962598 (Thread-2): 10:14:51  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:14:51.967795 (Thread-1): 10:14:51  finished collecting timing info
2022-02-11 10:14:51.967930 (Thread-1): 10:14:51  Began executing node model.my_new_project.customer_orders
2022-02-11 10:14:51.972951 (Thread-4): 10:14:51  finished collecting timing info
2022-02-11 10:14:51.973096 (Thread-4): 10:14:51  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 10:14:51.999266 (Thread-3): 10:14:51  finished collecting timing info
2022-02-11 10:14:51.999450 (Thread-3): 10:14:51  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:14:52.008594 (Thread-2): 10:14:52  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:14:52.009313 (Thread-1): 10:14:52  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 10:14:52.011848 (Thread-4): 10:14:52  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 10:14:52.013196 (Thread-3): 10:14:52  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:14:52.027739 (Thread-2): 10:14:52  Opening a new connection, currently in state init
2022-02-11 10:14:52.029342 (Thread-1): 10:14:52  Opening a new connection, currently in state closed
2022-02-11 10:14:52.029623 (Thread-4): 10:14:52  Opening a new connection, currently in state init
2022-02-11 10:14:52.029998 (Thread-3): 10:14:52  Opening a new connection, currently in state init
2022-02-11 10:14:52.032282 (Thread-2): 10:14:52  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 10:14:52.034607 (Thread-4): 10:14:52  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 10:14:52.038324 (Thread-1): 10:14:52  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 10:14:52.039098 (Thread-3): 10:14:52  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (
    
    select * from `dbt-tutorial`.`jaffle_shop`.`orders`
    
),

transformed as (
        
      select 
      
        id as order_id,
        user_id as customer_id,
        status as order_status,
        order_date,
        
        case 
            when status not in ('returned','return_pending') 
            then order_date 
        end as valid_order_date,
        
        row_number() over (
            partition by user_id 
            order by order_date, id
        ) as user_order_seq
        
      from source
    
)

select * from transformed;


2022-02-11 10:14:52.841867 (Thread-74): handling poll request
2022-02-11 10:14:52.842250 (Thread-74): 10:14:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e5348190>]}
2022-02-11 10:14:52.843338 (Thread-74): sending response (<Response 24408 bytes [200 OK]>) to 10.0.18.228
2022-02-11 10:14:52.906552 (Thread-1): 10:14:52  finished collecting timing info
2022-02-11 10:14:52.907220 (Thread-1): 10:14:52  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cb97608-3b8a-4e69-b425-aaa8547fdd3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa54414b070>]}
2022-02-11 10:14:52.907627 (Thread-1): 10:14:52  1 of 6 OK created view model dbt_luisscabral.customer_orders.................... [OK in 0.97s]
2022-02-11 10:14:52.907759 (Thread-1): 10:14:52  Finished running node model.my_new_project.customer_orders
2022-02-11 10:14:52.964427 (Thread-3): 10:14:52  finished collecting timing info
2022-02-11 10:14:52.964871 (Thread-3): 10:14:52  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cb97608-3b8a-4e69-b425-aaa8547fdd3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5440d2580>]}
2022-02-11 10:14:52.965197 (Thread-3): 10:14:52  3 of 6 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 1.02s]
2022-02-11 10:14:52.965307 (Thread-3): 10:14:52  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:14:53.038585 (Thread-4): 10:14:53  finished collecting timing info
2022-02-11 10:14:53.039048 (Thread-4): 10:14:53  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cb97608-3b8a-4e69-b425-aaa8547fdd3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5440ecee0>]}
2022-02-11 10:14:53.039379 (Thread-4): 10:14:53  4 of 6 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 1.09s]
2022-02-11 10:14:53.039491 (Thread-4): 10:14:53  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 10:14:53.040261 (Thread-1): 10:14:53  Began running node model.my_new_project.int_orders
2022-02-11 10:14:53.040504 (Thread-1): 10:14:53  5 of 6 START view model dbt_luisscabral.int_orders.............................. [RUN]
2022-02-11 10:14:53.040740 (Thread-1): 10:14:53  Acquiring new bigquery connection "model.my_new_project.int_orders"
2022-02-11 10:14:53.040830 (Thread-1): 10:14:53  Began compiling node model.my_new_project.int_orders
2022-02-11 10:14:53.040918 (Thread-1): 10:14:53  Compiling model.my_new_project.int_orders
2022-02-11 10:14:53.043452 (Thread-1): 10:14:53  Writing injected SQL for node "model.my_new_project.int_orders"
2022-02-11 10:14:53.052350 (Thread-2): 10:14:53  finished collecting timing info
2022-02-11 10:14:53.052708 (Thread-2): 10:14:53  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cb97608-3b8a-4e69-b425-aaa8547fdd3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa54414b0d0>]}
2022-02-11 10:14:53.053017 (Thread-2): 10:14:53  2 of 6 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 1.11s]
2022-02-11 10:14:53.053129 (Thread-2): 10:14:53  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:14:53.059732 (Thread-1): 10:14:53  finished collecting timing info
2022-02-11 10:14:53.059881 (Thread-1): 10:14:53  Began executing node model.my_new_project.int_orders
2022-02-11 10:14:53.062086 (Thread-1): 10:14:53  Writing runtime SQL for node "model.my_new_project.int_orders"
2022-02-11 10:14:53.085753 (Thread-1): 10:14:53  Opening a new connection, currently in state closed
2022-02-11 10:14:53.090165 (Thread-1): 10:14:53  On model.my_new_project.int_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.int_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`int_orders`
  OPTIONS()
  as with

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
    where payment_status != 'fail'

),

order_totals as (

    select

        order_id,
        payment_status,
        sum(payment_amount) as order_value_dollars

    from payments
    group by 1, 2

),

joined as (

    select

        orders.*,
        order_totals.payment_status,
        order_totals.order_value_dollars

    from orders 
    left join order_totals
        on orders.order_id = order_totals.order_id

)

select * from joined;


2022-02-11 10:14:54.068915 (Thread-1): 10:14:54  finished collecting timing info
2022-02-11 10:14:54.069358 (Thread-1): 10:14:54  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cb97608-3b8a-4e69-b425-aaa8547fdd3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5441245b0>]}
2022-02-11 10:14:54.069685 (Thread-1): 10:14:54  5 of 6 OK created view model dbt_luisscabral.int_orders......................... [OK in 1.03s]
2022-02-11 10:14:54.069798 (Thread-1): 10:14:54  Finished running node model.my_new_project.int_orders
2022-02-11 10:14:54.071003 (Thread-4): 10:14:54  Began running node model.my_new_project.fct_customer_orders
2022-02-11 10:14:54.071253 (Thread-4): 10:14:54  6 of 6 START view model dbt_luisscabral.fct_customer_orders..................... [RUN]
2022-02-11 10:14:54.071487 (Thread-4): 10:14:54  Acquiring new bigquery connection "model.my_new_project.fct_customer_orders"
2022-02-11 10:14:54.071576 (Thread-4): 10:14:54  Began compiling node model.my_new_project.fct_customer_orders
2022-02-11 10:14:54.071663 (Thread-4): 10:14:54  Compiling model.my_new_project.fct_customer_orders
2022-02-11 10:14:54.074452 (Thread-4): 10:14:54  Writing injected SQL for node "model.my_new_project.fct_customer_orders"
2022-02-11 10:14:54.091591 (Thread-4): 10:14:54  finished collecting timing info
2022-02-11 10:14:54.091830 (Thread-4): 10:14:54  Began executing node model.my_new_project.fct_customer_orders
2022-02-11 10:14:54.095118 (Thread-4): 10:14:54  Writing runtime SQL for node "model.my_new_project.fct_customer_orders"
2022-02-11 10:14:54.110411 (Thread-4): 10:14:54  Opening a new connection, currently in state closed
2022-02-11 10:14:54.115064 (Thread-4): 10:14:54  On model.my_new_project.fct_customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customer_orders`
  OPTIONS()
  as with

customers as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`

),

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`int_orders`

),

final as (

    select

        orders.*,

        customers.surname,
        customers.givenname,

        -- Customer-level aggregations
        min(orders.order_date) over(
            partition by orders.customer_id
        ) as first_order_date,

        min(orders.valid_order_date) over(
            partition by orders.customer_id
        ) as first_non_returned_order_date,

        max(orders.valid_order_date) over(
            partition by orders.customer_id
        ) as most_recent_non_returned_order_date,

        count(*) over(
            partition by orders.customer_id
        ) as order_count,

        sum(case when orders.valid_order_date is not null
                then 1
                else 0
                end)) over(
            partition by orders.customer_id
        ) as non_returned_order_count,

        array_agg(distinct orders.order_id) over(
            partition by orders.customer_id
        ) as order_ids,

        sum(case when orders.valid_order_date is not null
                then orders.order_value_dollars
                else 0
                end)) over(
            partition by orders.customer_id
        ) as total_lifetime_value

    from orders
    inner join customers
        on orders.customer_id = customers.customer_id

)

select * from final;


2022-02-11 10:14:54.142101 (Thread-75): handling poll request
2022-02-11 10:14:54.142461 (Thread-75): 10:14:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e522c3a0>]}
2022-02-11 10:14:54.143444 (Thread-75): sending response (<Response 20981 bytes [200 OK]>) to 10.0.3.5
2022-02-11 10:14:54.441848 (Thread-4): 10:14:54  BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: OVER keyword must follow a function call at [49:23]')
2022-02-11 10:14:55.470092 (Thread-76): handling poll request
2022-02-11 10:14:55.470465 (Thread-76): 10:14:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e522c9d0>]}
2022-02-11 10:14:55.471009 (Thread-76): sending response (<Response 713 bytes [200 OK]>) to 10.0.20.79
2022-02-11 10:14:55.476897 (Thread-4): 10:14:55  finished collecting timing info
2022-02-11 10:14:55.477347 (Thread-4): 10:14:55  Database Error in model fct_customer_orders (models/marts/fct_customer_orders.sql)
  Syntax error: OVER keyword must follow a function call at [49:23]
  compiled SQL at target/run/my_new_project/models/marts/fct_customer_orders.sql
2022-02-11 10:14:55.477543 (Thread-4): 10:14:55  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cb97608-3b8a-4e69-b425-aaa8547fdd3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa544080220>]}
2022-02-11 10:14:55.477870 (Thread-4): 10:14:55  6 of 6 ERROR creating view model dbt_luisscabral.fct_customer_orders............ [ERROR in 1.41s]
2022-02-11 10:14:55.477982 (Thread-4): 10:14:55  Finished running node model.my_new_project.fct_customer_orders
2022-02-11 10:14:55.479678 (MainThread): 10:14:55  Acquiring new bigquery connection "master"
2022-02-11 10:14:55.479980 (MainThread): 10:14:55  
2022-02-11 10:14:55.480076 (MainThread): 10:14:55  Finished running 6 view models in 4.13s.
2022-02-11 10:14:55.480156 (MainThread): 10:14:55  Connection 'master' was properly closed.
2022-02-11 10:14:55.480223 (MainThread): 10:14:55  Connection 'model.my_new_project.int_orders' was properly closed.
2022-02-11 10:14:55.480286 (MainThread): 10:14:55  Connection 'model.my_new_project.stg_jaffle_shop__customers' was properly closed.
2022-02-11 10:14:55.480346 (MainThread): 10:14:55  Connection 'model.my_new_project.stg_jaffle_shop__orders' was properly closed.
2022-02-11 10:14:55.480407 (MainThread): 10:14:55  Connection 'model.my_new_project.fct_customer_orders' was properly closed.
2022-02-11 10:14:55.532504 (MainThread): 10:14:55  
2022-02-11 10:14:55.532675 (MainThread): 10:14:55  Completed with 1 error and 0 warnings:
2022-02-11 10:14:55.532766 (MainThread): 10:14:55  
2022-02-11 10:14:55.532857 (MainThread): 10:14:55  Database Error in model fct_customer_orders (models/marts/fct_customer_orders.sql)
2022-02-11 10:14:55.532934 (MainThread): 10:14:55    Syntax error: OVER keyword must follow a function call at [49:23]
2022-02-11 10:14:55.533002 (MainThread): 10:14:55    compiled SQL at target/run/my_new_project/models/marts/fct_customer_orders.sql
2022-02-11 10:14:55.533086 (MainThread): 10:14:55  
2022-02-11 10:14:55.533168 (MainThread): 10:14:55  Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
2022-02-11 10:14:56.796485 (Thread-77): handling poll request
2022-02-11 10:14:56.796879 (Thread-77): 10:14:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e52148e0>]}
2022-02-11 10:14:56.798361 (Thread-77): sending response (<Response 33299 bytes [200 OK]>) to 10.0.5.75
2022-02-11 10:14:57.511997 (Thread-78): handling status request
2022-02-11 10:14:57.512366 (Thread-78): 10:14:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e53b6b80>]}
2022-02-11 10:14:57.512893 (Thread-78): sending response (<Response 2016 bytes [200 OK]>) to 10.0.31.57
2022-02-11 10:14:57.524492 (Thread-79): handling status request
2022-02-11 10:14:57.524760 (Thread-79): 10:14:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e536ee50>]}
2022-02-11 10:14:57.525149 (Thread-79): sending response (<Response 2016 bytes [200 OK]>) to 10.0.3.5
2022-02-11 10:15:25.049061 (Thread-80): 10:15:25  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-02-11 10:15:25.049521 (Thread-80): 10:15:25  Partial parsing: updated file: my_new_project://models/marts/fct_customer_orders.sql
2022-02-11 10:15:25.054045 (Thread-80): 10:15:25  1699: static parser successfully parsed marts/fct_customer_orders.sql
2022-02-11 10:15:25.099983 (Thread-80): 10:15:25  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 10:15:25.105827 (Thread-80): 10:15:25  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e51aea60>]}
2022-02-11 10:15:25.568668 (Thread-81): handling status request
2022-02-11 10:15:25.569046 (Thread-81): 10:15:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e519ba30>]}
2022-02-11 10:15:25.569552 (Thread-81): sending response (<Response 2016 bytes [200 OK]>) to 10.0.5.75
2022-02-11 10:15:25.738885 (Thread-82): handling status request
2022-02-11 10:15:25.739282 (Thread-82): 10:15:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e5291910>]}
2022-02-11 10:15:25.739773 (Thread-82): sending response (<Response 2016 bytes [200 OK]>) to 10.0.5.155
2022-02-11 10:15:27.255561 (Thread-83): handling status request
2022-02-11 10:15:27.255992 (Thread-83): 10:15:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e51b1670>]}
2022-02-11 10:15:27.256494 (Thread-83): sending response (<Response 2016 bytes [200 OK]>) to 10.0.18.228
2022-02-11 10:15:27.481827 (Thread-84): handling status request
2022-02-11 10:15:27.482259 (Thread-84): 10:15:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e5345a60>]}
2022-02-11 10:15:27.482758 (Thread-84): sending response (<Response 2016 bytes [200 OK]>) to 10.0.19.158
2022-02-11 10:15:27.575252 (Thread-85): handling cli_args request
2022-02-11 10:15:27.575602 (Thread-85): 10:15:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e53f6f70>]}
2022-02-11 10:15:29.731062 (Thread-85): sending response (<Response 138 bytes [200 OK]>) to 10.0.18.228
2022-02-11 10:15:29.842594 (MainThread): 10:15:29  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-02-11 10:15:29.843133 (MainThread): 10:15:29  Partial parsing enabled, no changes found, skipping parsing
2022-02-11 10:15:29.843712 (MainThread): 10:15:29  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-02-11 10:15:29.849216 (MainThread): 10:15:29  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0727d2a0-31a5-4bef-b78e-93098fd73104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde84edd940>]}
2022-02-11 10:15:29.876211 (MainThread): 10:15:29  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0727d2a0-31a5-4bef-b78e-93098fd73104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde84f3d370>]}
2022-02-11 10:15:29.876472 (MainThread): 10:15:29  Found 6 models, 0 tests, 0 snapshots, 0 analyses, 188 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics
2022-02-11 10:15:29.877657 (MainThread): 10:15:29  
2022-02-11 10:15:29.877958 (MainThread): 10:15:29  Acquiring new bigquery connection "master"
2022-02-11 10:15:29.879151 (ThreadPoolExecutor-0_0): 10:15:29  Acquiring new bigquery connection "list_dbtmodularity"
2022-02-11 10:15:29.879304 (ThreadPoolExecutor-0_0): 10:15:29  Opening a new connection, currently in state init
2022-02-11 10:15:30.053017 (Thread-86): handling poll request
2022-02-11 10:15:30.053488 (Thread-86): 10:15:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e51aedc0>]}
2022-02-11 10:15:30.054461 (Thread-86): sending response (<Response 3781 bytes [200 OK]>) to 10.0.20.79
2022-02-11 10:15:30.197280 (ThreadPoolExecutor-1_0): 10:15:30  Acquiring new bigquery connection "list_dbtmodularity_dbt_luisscabral"
2022-02-11 10:15:30.197453 (ThreadPoolExecutor-1_0): 10:15:30  Opening a new connection, currently in state closed
2022-02-11 10:15:30.483473 (MainThread): 10:15:30  Concurrency: 4 threads (target='default')
2022-02-11 10:15:30.483647 (MainThread): 10:15:30  
2022-02-11 10:15:30.486543 (Thread-1): 10:15:30  Began running node model.my_new_project.customer_orders
2022-02-11 10:15:30.486849 (Thread-1): 10:15:30  1 of 6 START view model dbt_luisscabral.customer_orders......................... [RUN]
2022-02-11 10:15:30.487165 (Thread-1): 10:15:30  Acquiring new bigquery connection "model.my_new_project.customer_orders"
2022-02-11 10:15:30.487262 (Thread-1): 10:15:30  Began compiling node model.my_new_project.customer_orders
2022-02-11 10:15:30.487357 (Thread-1): 10:15:30  Compiling model.my_new_project.customer_orders
2022-02-11 10:15:30.491686 (Thread-2): 10:15:30  Began running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:15:30.492026 (Thread-2): 10:15:30  2 of 6 START view model dbt_luisscabral.stg_jaffle_shop__customers.............. [RUN]
2022-02-11 10:15:30.492426 (Thread-2): 10:15:30  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:15:30.492569 (Thread-2): 10:15:30  Began compiling node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:15:30.492711 (Thread-2): 10:15:30  Compiling model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:15:30.496032 (Thread-2): 10:15:30  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:15:30.496310 (Thread-3): 10:15:30  Began running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:15:30.496530 (Thread-3): 10:15:30  3 of 6 START view model dbt_luisscabral.stg_jaffle_shop__orders................. [RUN]
2022-02-11 10:15:30.496803 (Thread-3): 10:15:30  Acquiring new bigquery connection "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:15:30.496893 (Thread-3): 10:15:30  Began compiling node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:15:30.496985 (Thread-3): 10:15:30  Compiling model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:15:30.499329 (Thread-3): 10:15:30  Writing injected SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:15:30.499593 (Thread-4): 10:15:30  Began running node model.my_new_project.stg_stripe__payments
2022-02-11 10:15:30.499811 (Thread-4): 10:15:30  4 of 6 START view model dbt_luisscabral.stg_stripe__payments.................... [RUN]
2022-02-11 10:15:30.500064 (Thread-4): 10:15:30  Acquiring new bigquery connection "model.my_new_project.stg_stripe__payments"
2022-02-11 10:15:30.500152 (Thread-4): 10:15:30  Began compiling node model.my_new_project.stg_stripe__payments
2022-02-11 10:15:30.500233 (Thread-4): 10:15:30  Compiling model.my_new_project.stg_stripe__payments
2022-02-11 10:15:30.502350 (Thread-4): 10:15:30  Writing injected SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 10:15:30.503001 (Thread-1): 10:15:30  Writing injected SQL for node "model.my_new_project.customer_orders"
2022-02-11 10:15:30.518985 (Thread-3): 10:15:30  finished collecting timing info
2022-02-11 10:15:30.519148 (Thread-3): 10:15:30  Began executing node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:15:30.524146 (Thread-2): 10:15:30  finished collecting timing info
2022-02-11 10:15:30.524365 (Thread-2): 10:15:30  Began executing node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:15:30.529191 (Thread-4): 10:15:30  finished collecting timing info
2022-02-11 10:15:30.529333 (Thread-4): 10:15:30  Began executing node model.my_new_project.stg_stripe__payments
2022-02-11 10:15:30.575799 (Thread-4): 10:15:30  Writing runtime SQL for node "model.my_new_project.stg_stripe__payments"
2022-02-11 10:15:30.578115 (Thread-2): 10:15:30  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__customers"
2022-02-11 10:15:30.583581 (Thread-1): 10:15:30  finished collecting timing info
2022-02-11 10:15:30.583756 (Thread-1): 10:15:30  Began executing node model.my_new_project.customer_orders
2022-02-11 10:15:30.585999 (Thread-1): 10:15:30  Writing runtime SQL for node "model.my_new_project.customer_orders"
2022-02-11 10:15:30.587036 (Thread-3): 10:15:30  Writing runtime SQL for node "model.my_new_project.stg_jaffle_shop__orders"
2022-02-11 10:15:30.598566 (Thread-2): 10:15:30  Opening a new connection, currently in state init
2022-02-11 10:15:30.602220 (Thread-4): 10:15:30  Opening a new connection, currently in state init
2022-02-11 10:15:30.603554 (Thread-3): 10:15:30  Opening a new connection, currently in state init
2022-02-11 10:15:30.603806 (Thread-1): 10:15:30  Opening a new connection, currently in state closed
2022-02-11 10:15:30.606280 (Thread-2): 10:15:30  On model.my_new_project.stg_jaffle_shop__customers: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__customers"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`jaffle_shop`.`customers`

),

transformed as (

    select 

        id as customer_id,
        last_name as surname,
        first_name as givenname,
        first_name || ' ' || last_name as full_name

    from source

)

select * from transformed;


2022-02-11 10:15:30.606777 (Thread-4): 10:15:30  On model.my_new_project.stg_stripe__payments: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_stripe__payments"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
  OPTIONS()
  as with

source as (

    select * from `dbt-tutorial`.`stripe`.`payment`

),

transformed as (

    select 

        id as payment_id,
        orderid as order_id,
        status as payment_status,
        round(amount/100.0, 2) as payment_amount

    from source

)

select * from transformed;


2022-02-11 10:15:30.608702 (Thread-3): 10:15:30  On model.my_new_project.stg_jaffle_shop__orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_jaffle_shop__orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`
  OPTIONS()
  as with

source as (
    
    select * from `dbt-tutorial`.`jaffle_shop`.`orders`
    
),

transformed as (
        
      select 
      
        id as order_id,
        user_id as customer_id,
        status as order_status,
        order_date,
        
        case 
            when status not in ('returned','return_pending') 
            then order_date 
        end as valid_order_date,
        
        row_number() over (
            partition by user_id 
            order by order_date, id
        ) as user_order_seq
        
      from source
    
)

select * from transformed;


2022-02-11 10:15:30.611521 (Thread-1): 10:15:30  On model.my_new_project.customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`customer_orders`
  OPTIONS()
  as select 
    orders.id as order_id,
    orders.user_id as customer_id,
    last_name as surname,
    first_name as givenname,
    first_order_date,
    order_count,
    total_lifetime_value,
    round(amount/100.0,2) as order_value_dollars,
    orders.status as order_status,
    payments.status as payment_status
from `dbt-tutorial`.`jaffle_shop`.`orders` as orders

join (
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
) customers
on orders.user_id = customers.id

join (

    select 
        b.id as customer_id,
        b.name as full_name,
        b.last_name as surname,
        b.first_name as givenname,
        min(order_date) as first_order_date,
        min(case when a.status NOT IN ('returned','return_pending') then order_date end) as first_non_returned_order_date,
        max(case when a.status NOT IN ('returned','return_pending') then order_date end) as most_recent_non_returned_order_date,
        COALESCE(max(user_order_seq),0) as order_count,
        COALESCE(count(case when a.status != 'returned' then 1 end),0) as non_returned_order_count,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end) as total_lifetime_value,
        sum(case when a.status NOT IN ('returned','return_pending') then ROUND(c.amount/100.0,2) else 0 end)/NULLIF(count(case when a.status NOT IN ('returned','return_pending') then 1 end),0) as avg_non_returned_order_value,
        array_agg(distinct a.id) as order_ids

    from (
      select 
        row_number() over (partition by user_id order by order_date, id) as user_order_seq,
        *
      from `dbt-tutorial`.`jaffle_shop`.`orders`
    ) a

    join ( 
      select 
        first_name || ' ' || last_name as name, 
        * 
      from `dbt-tutorial`.`jaffle_shop`.`customers`
    ) b
    on a.user_id = b.id

    left outer join `dbt-tutorial`.`stripe`.`payment` c
    on a.id = c.orderid

    where a.status NOT IN ('pending') and c.status != 'fail'

    group by b.id, b.name, b.last_name, b.first_name

) customer_order_history
on orders.user_id = customer_order_history.customer_id

left outer join `dbt-tutorial`.`stripe`.`payment` payments
on orders.id = payments.orderid

where payments.status != 'fail';


2022-02-11 10:15:31.356081 (Thread-87): handling poll request
2022-02-11 10:15:31.356482 (Thread-87): 10:15:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e51b84c0>]}
2022-02-11 10:15:31.357546 (Thread-87): sending response (<Response 24408 bytes [200 OK]>) to 10.0.31.57
2022-02-11 10:15:31.541324 (Thread-2): 10:15:31  finished collecting timing info
2022-02-11 10:15:31.541758 (Thread-2): 10:15:31  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0727d2a0-31a5-4bef-b78e-93098fd73104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde8457c160>]}
2022-02-11 10:15:31.542487 (Thread-2): 10:15:31  2 of 6 OK created view model dbt_luisscabral.stg_jaffle_shop__customers......... [OK in 1.05s]
2022-02-11 10:15:31.542648 (Thread-2): 10:15:31  Finished running node model.my_new_project.stg_jaffle_shop__customers
2022-02-11 10:15:31.544548 (Thread-4): 10:15:31  finished collecting timing info
2022-02-11 10:15:31.544922 (Thread-4): 10:15:31  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0727d2a0-31a5-4bef-b78e-93098fd73104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde84555280>]}
2022-02-11 10:15:31.545216 (Thread-4): 10:15:31  4 of 6 OK created view model dbt_luisscabral.stg_stripe__payments............... [OK in 1.04s]
2022-02-11 10:15:31.545325 (Thread-4): 10:15:31  Finished running node model.my_new_project.stg_stripe__payments
2022-02-11 10:15:31.580497 (Thread-3): 10:15:31  finished collecting timing info
2022-02-11 10:15:31.580873 (Thread-3): 10:15:31  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0727d2a0-31a5-4bef-b78e-93098fd73104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde845a3ee0>]}
2022-02-11 10:15:31.581171 (Thread-3): 10:15:31  3 of 6 OK created view model dbt_luisscabral.stg_jaffle_shop__orders............ [OK in 1.08s]
2022-02-11 10:15:31.581278 (Thread-3): 10:15:31  Finished running node model.my_new_project.stg_jaffle_shop__orders
2022-02-11 10:15:31.582505 (Thread-2): 10:15:31  Began running node model.my_new_project.int_orders
2022-02-11 10:15:31.582740 (Thread-2): 10:15:31  5 of 6 START view model dbt_luisscabral.int_orders.............................. [RUN]
2022-02-11 10:15:31.583015 (Thread-2): 10:15:31  Acquiring new bigquery connection "model.my_new_project.int_orders"
2022-02-11 10:15:31.583111 (Thread-2): 10:15:31  Began compiling node model.my_new_project.int_orders
2022-02-11 10:15:31.583198 (Thread-2): 10:15:31  Compiling model.my_new_project.int_orders
2022-02-11 10:15:31.585611 (Thread-2): 10:15:31  Writing injected SQL for node "model.my_new_project.int_orders"
2022-02-11 10:15:31.587279 (Thread-1): 10:15:31  finished collecting timing info
2022-02-11 10:15:31.587720 (Thread-1): 10:15:31  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0727d2a0-31a5-4bef-b78e-93098fd73104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde8465dee0>]}
2022-02-11 10:15:31.588017 (Thread-1): 10:15:31  1 of 6 OK created view model dbt_luisscabral.customer_orders.................... [OK in 1.10s]
2022-02-11 10:15:31.588127 (Thread-1): 10:15:31  Finished running node model.my_new_project.customer_orders
2022-02-11 10:15:31.601451 (Thread-2): 10:15:31  finished collecting timing info
2022-02-11 10:15:31.601600 (Thread-2): 10:15:31  Began executing node model.my_new_project.int_orders
2022-02-11 10:15:31.603821 (Thread-2): 10:15:31  Writing runtime SQL for node "model.my_new_project.int_orders"
2022-02-11 10:15:31.620888 (Thread-2): 10:15:31  Opening a new connection, currently in state closed
2022-02-11 10:15:31.625333 (Thread-2): 10:15:31  On model.my_new_project.int_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.int_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`int_orders`
  OPTIONS()
  as with

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__orders`

),

payments as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_stripe__payments`
    where payment_status != 'fail'

),

order_totals as (

    select

        order_id,
        payment_status,
        sum(payment_amount) as order_value_dollars

    from payments
    group by 1, 2

),

joined as (

    select

        orders.*,
        order_totals.payment_status,
        order_totals.order_value_dollars

    from orders 
    left join order_totals
        on orders.order_id = order_totals.order_id

)

select * from joined;


2022-02-11 10:15:32.539192 (Thread-2): 10:15:32  finished collecting timing info
2022-02-11 10:15:32.539671 (Thread-2): 10:15:32  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0727d2a0-31a5-4bef-b78e-93098fd73104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde8456b070>]}
2022-02-11 10:15:32.540196 (Thread-2): 10:15:32  5 of 6 OK created view model dbt_luisscabral.int_orders......................... [OK in 0.96s]
2022-02-11 10:15:32.540318 (Thread-2): 10:15:32  Finished running node model.my_new_project.int_orders
2022-02-11 10:15:32.541090 (Thread-3): 10:15:32  Began running node model.my_new_project.fct_customer_orders
2022-02-11 10:15:32.541312 (Thread-3): 10:15:32  6 of 6 START view model dbt_luisscabral.fct_customer_orders..................... [RUN]
2022-02-11 10:15:32.541546 (Thread-3): 10:15:32  Acquiring new bigquery connection "model.my_new_project.fct_customer_orders"
2022-02-11 10:15:32.541637 (Thread-3): 10:15:32  Began compiling node model.my_new_project.fct_customer_orders
2022-02-11 10:15:32.541724 (Thread-3): 10:15:32  Compiling model.my_new_project.fct_customer_orders
2022-02-11 10:15:32.544738 (Thread-3): 10:15:32  Writing injected SQL for node "model.my_new_project.fct_customer_orders"
2022-02-11 10:15:32.562648 (Thread-3): 10:15:32  finished collecting timing info
2022-02-11 10:15:32.562895 (Thread-3): 10:15:32  Began executing node model.my_new_project.fct_customer_orders
2022-02-11 10:15:32.565286 (Thread-3): 10:15:32  Writing runtime SQL for node "model.my_new_project.fct_customer_orders"
2022-02-11 10:15:32.581525 (Thread-3): 10:15:32  Opening a new connection, currently in state closed
2022-02-11 10:15:32.587121 (Thread-3): 10:15:32  On model.my_new_project.fct_customer_orders: /* {"app": "dbt", "dbt_version": "1.0.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_customer_orders"} */


  create or replace view `dbtmodularity`.`dbt_luisscabral`.`fct_customer_orders`
  OPTIONS()
  as with

customers as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`stg_jaffle_shop__customers`

),

orders as (

    select * from `dbtmodularity`.`dbt_luisscabral`.`int_orders`

),

final as (

    select

        orders.*,

        customers.surname,
        customers.givenname,

        -- Customer-level aggregations
        min(orders.order_date) over(
            partition by orders.customer_id
        ) as first_order_date,

        min(orders.valid_order_date) over(
            partition by orders.customer_id
        ) as first_non_returned_order_date,

        max(orders.valid_order_date) over(
            partition by orders.customer_id
        ) as most_recent_non_returned_order_date,

        count(*) over(
            partition by orders.customer_id
        ) as order_count,

        sum(case when orders.valid_order_date is not null
                then 1
                else 0
                end) over(
            partition by orders.customer_id
        ) as non_returned_order_count,

        array_agg(distinct orders.order_id) over(
            partition by orders.customer_id
        ) as order_ids,

        sum(case when orders.valid_order_date is not null
                then orders.order_value_dollars
                else 0
                end) over(
            partition by orders.customer_id
        ) as total_lifetime_value

    from orders
    inner join customers
        on orders.customer_id = customers.customer_id

)

select * from final;


2022-02-11 10:15:32.700581 (Thread-88): handling poll request
2022-02-11 10:15:32.700983 (Thread-88): 10:15:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e51394c0>]}
2022-02-11 10:15:32.701970 (Thread-88): sending response (<Response 20979 bytes [200 OK]>) to 10.0.38.212
2022-02-11 10:15:33.673949 (Thread-3): 10:15:33  finished collecting timing info
2022-02-11 10:15:33.674415 (Thread-3): 10:15:33  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0727d2a0-31a5-4bef-b78e-93098fd73104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde84536e20>]}
2022-02-11 10:15:33.674762 (Thread-3): 10:15:33  6 of 6 OK created view model dbt_luisscabral.fct_customer_orders................ [OK in 1.13s]
2022-02-11 10:15:33.674926 (Thread-3): 10:15:33  Finished running node model.my_new_project.fct_customer_orders
2022-02-11 10:15:33.676664 (MainThread): 10:15:33  Acquiring new bigquery connection "master"
2022-02-11 10:15:33.676971 (MainThread): 10:15:33  
2022-02-11 10:15:33.677066 (MainThread): 10:15:33  Finished running 6 view models in 3.80s.
2022-02-11 10:15:33.677148 (MainThread): 10:15:33  Connection 'master' was properly closed.
2022-02-11 10:15:33.677214 (MainThread): 10:15:33  Connection 'model.my_new_project.customer_orders' was properly closed.
2022-02-11 10:15:33.677276 (MainThread): 10:15:33  Connection 'model.my_new_project.int_orders' was properly closed.
2022-02-11 10:15:33.677335 (MainThread): 10:15:33  Connection 'model.my_new_project.fct_customer_orders' was properly closed.
2022-02-11 10:15:33.677394 (MainThread): 10:15:33  Connection 'model.my_new_project.stg_stripe__payments' was properly closed.
2022-02-11 10:15:33.736036 (MainThread): 10:15:33  
2022-02-11 10:15:33.736240 (MainThread): 10:15:33  Completed successfully
2022-02-11 10:15:33.736344 (MainThread): 10:15:33  
2022-02-11 10:15:33.736433 (MainThread): 10:15:33  Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
2022-02-11 10:15:34.016926 (Thread-89): handling poll request
2022-02-11 10:15:34.017303 (Thread-89): 10:15:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e51d3b80>]}
2022-02-11 10:15:34.018677 (Thread-89): sending response (<Response 30749 bytes [200 OK]>) to 10.0.46.69
2022-02-11 10:15:34.654271 (Thread-90): handling status request
2022-02-11 10:15:34.654660 (Thread-90): 10:15:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e51d3490>]}
2022-02-11 10:15:34.655229 (Thread-90): sending response (<Response 2016 bytes [200 OK]>) to 10.0.30.21
2022-02-11 10:15:34.725326 (Thread-91): handling status request
2022-02-11 10:15:34.725721 (Thread-91): 10:15:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e519d760>]}
2022-02-11 10:15:34.726234 (Thread-91): sending response (<Response 2016 bytes [200 OK]>) to 10.0.20.79
2022-02-11 10:57:40.294694 (Thread-92): handling status request
2022-02-11 10:57:40.296883 (Thread-92): 10:57:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '776b97c0-dab5-4f2b-b955-83eb46580688', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e5146a00>]}
2022-02-11 10:57:40.297395 (Thread-92): sending response (<Response 2016 bytes [200 OK]>) to 10.0.13.131
